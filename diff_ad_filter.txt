diff --git a/src/app/play/page.tsx b/src/app/play/page.tsx
index 8a8f2e2..b15ffbd 100644
--- a/src/app/play/page.tsx
+++ b/src/app/play/page.tsx
@@ -2,8 +2,7 @@
 
 'use client';
 
-import { Suspense, useCallback, useEffect, useRef, useState } from 'react';
-import { createPortal } from 'react-dom';
+import { Suspense, useEffect, useRef, useState } from 'react';
 import Hls from 'hls.js';
 import { Heart, ChevronUp } from 'lucide-react';
 import { useRouter, useSearchParams } from 'next/navigation';
@@ -91,7 +90,7 @@ function PlayPageClient() {
   // 杩涘害鏉℃嫋鎷界姸鎬佺鐞?   const isDraggingProgressRef = useRef(false);
   const seekResetTimeoutRef = useRef<NodeJS.Timeout | null>(null);
-
+  
   // resize浜嬩欢闃叉姈绠＄悊
   const resizeResetTimeoutRef = useRef<NodeJS.Timeout | null>(null);
 
@@ -199,7 +198,7 @@ function PlayPageClient() {
         if (loadingBangumiDetails || bangumiDetails) {
           return;
         }
-
+        
         setLoadingBangumiDetails(true);
         try {
           const bangumiData = await fetchBangumiDetails(videoDoubanId);
@@ -216,7 +215,7 @@ function PlayPageClient() {
         if (loadingMovieDetails || movieDetails) {
           return;
         }
-
+        
         setLoadingMovieDetails(true);
         try {
           const response = await getDoubanDetails(videoDoubanId.toString());
@@ -302,29 +301,10 @@ function PlayPageClient() {
     Map<string, { quality: string; loadSpeed: string; pingTime: number }>
   >(new Map());
 
-  // 娴嬮€熻繘搴︾姸鎬?-  const [speedTestProgress, setSpeedTestProgress] = useState<{
-    current: number;
-    total: number;
-    currentSourceName: string;
-    results: Array<{
-      sourceName: string;
-      quality: string;
-      loadSpeed: string;
-      pingTime: number;
-      status: 'testing' | 'success' | 'failed';
-    }>;
-  }>({
-    current: 0,
-    total: 0,
-    currentSourceName: '',
-    results: [],
-  });
-
   // 寮瑰箷缂撳瓨锛氶伩鍏嶉噸澶嶈姹傜浉鍚岀殑寮瑰箷鏁版嵁锛屾敮鎸侀〉闈㈠埛鏂版寔涔呭寲锛堢粺涓€瀛樺偍锛?   const DANMU_CACHE_DURATION = 30 * 60; // 30鍒嗛挓缂撳瓨锛堢锛?   const DANMU_CACHE_KEY_PREFIX = 'danmu-cache';
-
+  
   // 鑾峰彇鍗曚釜寮瑰箷缂撳瓨
   const getDanmuCacheItem = async (key: string): Promise<{ data: any[]; timestamp: number } | null> => {
     try {
@@ -332,7 +312,7 @@ function PlayPageClient() {
       // 浼樺厛浠庣粺涓€瀛樺偍鑾峰彇
       const cached = await ClientCache.get(cacheKey);
       if (cached) return cached;
-
+      
       // 鍏滃簳锛氫粠localStorage鑾峰彇锛堝吋瀹规€э級
       if (typeof localStorage !== 'undefined') {
         const oldCacheKey = 'lunatv_danmu_cache';
@@ -346,43 +326,43 @@ function PlayPageClient() {
           }
         }
       }
-
+      
       return null;
     } catch (error) {
       console.warn('璇诲彇寮瑰箷缂撳瓨澶辫触:', error);
       return null;
     }
   };
-
+  
   // 淇濆瓨鍗曚釜寮瑰箷缂撳瓨
   const setDanmuCacheItem = async (key: string, data: any[]): Promise<void> => {
     try {
       const cacheKey = `${DANMU_CACHE_KEY_PREFIX}-${key}`;
       const cacheData = { data, timestamp: Date.now() };
-
+      
       // 涓昏瀛樺偍锛氱粺涓€瀛樺偍
       await ClientCache.set(cacheKey, cacheData, DANMU_CACHE_DURATION);
-
+      
       // 鍏滃簳瀛樺偍锛歭ocalStorage锛堝吋瀹规€э紝浣嗗彧瀛樺偍鏈€杩戝嚑涓級
       if (typeof localStorage !== 'undefined') {
         try {
           const oldCacheKey = 'lunatv_danmu_cache';
           let localCache: Map<string, { data: any[]; timestamp: number }> = new Map();
-
+          
           const existing = localStorage.getItem(oldCacheKey);
           if (existing) {
             const parsed = JSON.parse(existing);
             localCache = new Map(Object.entries(parsed)) as Map<string, { data: any[]; timestamp: number }>;
           }
-
+          
           // 娓呯悊杩囨湡椤瑰苟闄愬埗鏁伴噺锛堟渶澶氫繚鐣?0涓級
           const now = Date.now();
           const validEntries = Array.from(localCache.entries())
             .filter(([, item]) => typeof item.timestamp === 'number' && now - item.timestamp < DANMU_CACHE_DURATION * 1000)
             .slice(-9); // 淇濈暀9涓紝鍔犱笂鏂扮殑鍏?0涓?-
+            
           validEntries.push([key, cacheData]);
-
+          
           const obj = Object.fromEntries(validEntries);
           localStorage.setItem(oldCacheKey, JSON.stringify(obj));
         } catch (e) {
@@ -398,11 +378,6 @@ function PlayPageClient() {
   const [isEpisodeSelectorCollapsed, setIsEpisodeSelectorCollapsed] =
     useState(false);
 
-  // 閫夐泦娴眰鐘舵€侊紙鐢ㄤ簬搴曟爮蹇嵎璁块棶锛?-  const [showEpisodePopup, setShowEpisodePopup] = useState(false);
-  const [isFullscreen, setIsFullscreen] = useState(false);
-  const [portalContainer, setPortalContainer] = useState<HTMLElement | null>(null);
-
   // 鎹㈡簮鍔犺浇鐘舵€?   const [isVideoLoading, setIsVideoLoading] = useState(true);
   const [videoLoadingStage, setVideoLoadingStage] = useState<
@@ -412,7 +387,7 @@ function PlayPageClient() {
   // 鎾斁杩涘害淇濆瓨鐩稿叧
   const saveIntervalRef = useRef<NodeJS.Timeout | null>(null);
   const lastSaveTimeRef = useRef<number>(0);
-
+  
   // 寮瑰箷鍔犺浇鐘舵€佺鐞嗭紝闃叉閲嶅鍔犺浇
   const danmuLoadingRef = useRef<boolean>(false);
   const lastDanmuLoadKeyRef = useRef<string>('');
@@ -457,7 +432,7 @@ function PlayPageClient() {
       // 浼樺厛浠庣粺涓€瀛樺偍鑾峰彇
       const cached = await ClientCache.get(cacheKey);
       if (cached) return cached;
-
+      
       // 鍏滃簳锛氫粠localStorage鑾峰彇锛堝吋瀹规€э級
       if (typeof localStorage !== 'undefined') {
         const localCached = localStorage.getItem(cacheKey);
@@ -469,7 +444,7 @@ function PlayPageClient() {
           localStorage.removeItem(cacheKey);
         }
       }
-
+      
       return null;
     } catch (e) {
       console.warn('鑾峰彇Bangumi缂撳瓨澶辫触:', e);
@@ -481,10 +456,10 @@ function PlayPageClient() {
     try {
       const cacheKey = `bangumi-details-${id}`;
       const expireSeconds = Math.floor(BANGUMI_CACHE_EXPIRE / 1000); // 杞崲涓虹
-
+      
       // 涓昏瀛樺偍锛氱粺涓€瀛樺偍
       await ClientCache.set(cacheKey, data, expireSeconds);
-
+      
       // 鍏滃簳瀛樺偍锛歭ocalStorage锛堝吋瀹规€э級
       if (typeof localStorage !== 'undefined') {
         try {
@@ -516,11 +491,11 @@ function PlayPageClient() {
       const response = await fetch(`https://api.bgm.tv/v0/subjects/${bangumiId}`);
       if (response.ok) {
         const bangumiData = await response.json();
-
+        
         // 淇濆瓨鍒扮紦瀛?         await setBangumiCache(bangumiId, bangumiData);
         console.log(`Bangumi璇︽儏宸茬紦瀛? ${bangumiId}`);
-
+        
         return bangumiData;
       }
     } catch (error) {
@@ -595,8 +570,8 @@ function PlayPageClient() {
         // 浠呬娇鐢ㄤ富鍏抽敭璇嶆悳绱紙杩囨护鏃犳剰涔夌殑璇嶏級
         const meaninglessWords = ['the', 'a', 'an', 'and', 'or', 'of', 'in', 'on', 'at', 'to', 'for', 'with', 'by'];
         if (!variants.includes(mainKeyword) &&
-          !meaninglessWords.includes(mainKeyword.toLowerCase()) &&
-          mainKeyword.length > 2) {
+            !meaninglessWords.includes(mainKeyword.toLowerCase()) &&
+            mainKeyword.length > 2) {
           variants.push(mainKeyword);
         }
       }
@@ -733,20 +708,20 @@ function PlayPageClient() {
     // 濡傛灉鏄痠Pad鎴杋OS13+锛堝寘鎷柊iPad鍦ㄦ闈㈡ā寮忎笅锛夛紝浣跨敤鏋佺畝绛栫暐閬垮厤宕╂簝
     if (isIOS13) {
       console.log('妫€娴嬪埌iPad/iOS13+璁惧锛屼娇鐢ㄦ棤娴嬮€熶紭閫夌瓥鐣ラ伩鍏嶅穿婧?);
-
+      
       // 绠€鍗曠殑婧愬悕绉颁紭鍏堢骇鎺掑簭锛屼笉杩涜瀹為檯娴嬮€?       const sourcePreference = [
         'ok', 'niuhu', 'ying', 'wasu', 'mgtv', 'iqiyi', 'youku', 'qq'
       ];
-
+      
       const sortedSources = sources.sort((a, b) => {
-        const aIndex = sourcePreference.findIndex(name =>
+        const aIndex = sourcePreference.findIndex(name => 
           a.source_name?.toLowerCase().includes(name)
         );
-        const bIndex = sourcePreference.findIndex(name =>
+        const bIndex = sourcePreference.findIndex(name => 
           b.source_name?.toLowerCase().includes(name)
         );
-
+        
         // 濡傛灉閮藉湪浼樺厛绾у垪琛ㄤ腑锛屾寜浼樺厛绾ф帓搴?         if (aIndex !== -1 && bIndex !== -1) {
           return aIndex - bIndex;
@@ -754,11 +729,11 @@ function PlayPageClient() {
         // 濡傛灉鍙湁涓€涓湪浼樺厛绾у垪琛ㄤ腑锛屼紭鍏堥€夋嫨瀹?         if (aIndex !== -1) return -1;
         if (bIndex !== -1) return 1;
-
+        
         // 閮戒笉鍦ㄤ紭鍏堢骇鍒楄〃涓紝淇濇寔鍘熷椤哄簭
         return 0;
       });
-
+      
       console.log('iPad/iOS13+浼橀€夌粨鏋?', sortedSources.map(s => s.source_name));
       return sortedSources[0];
     }
@@ -776,106 +751,38 @@ function PlayPageClient() {
   // 杞婚噺绾т紭閫夛細浠呮祴璇曡繛閫氭€э紝涓嶅垱寤簐ideo鍜孒LS
   const lightweightPreference = async (sources: SearchResult[]): Promise<SearchResult> => {
     console.log('寮€濮嬭交閲忕骇娴嬮€燂紝浠呮祴璇曡繛閫氭€?);
+    
+    const results = await Promise.all(
+      sources.map(async (source) => {
+        try {
+          if (!source.episodes || source.episodes.length === 0) {
+            return { source, pingTime: 9999, available: false };
+          }
 
-    // 鍒濆鍖栨祴閫熻繘搴?-    setSpeedTestProgress({
-      current: 0,
-      total: sources.length,
-      currentSourceName: '',
-      results: [],
-    });
-
-    const results: Array<{
-      source: SearchResult;
-      pingTime: number;
-      available: boolean;
-    }> = [];
-
-    // 閫愪釜娴嬮€熶互瀹炴椂鏇存柊杩涘害
-    for (let i = 0; i < sources.length; i++) {
-      const source = sources[i];
-
-      // 鏇存柊褰撳墠娴嬮€熸簮
-      setSpeedTestProgress(prev => ({
-        ...prev,
-        current: i + 1,
-        currentSourceName: source.source_name || '鏈煡婧?,
-      }));
-
-      try {
-        if (!source.episodes || source.episodes.length === 0) {
-          results.push({ source, pingTime: 9999, available: false });
-
-          // 鏇存柊缁撴灉鍒楄〃
-          setSpeedTestProgress(prev => ({
-            ...prev,
-            results: [
-              ...prev.results,
-              {
-                sourceName: source.source_name || '鏈煡婧?,
-                quality: '鏈煡',
-                loadSpeed: '鏈煡',
-                pingTime: 9999,
-                status: 'failed',
-              },
-            ],
-          }));
-          continue;
+          const episodeUrl = source.episodes.length > 1 
+            ? source.episodes[1] 
+            : source.episodes[0];
+          
+          // 浠呮祴璇曡繛閫氭€у拰鍝嶅簲鏃堕棿
+          const startTime = performance.now();
+          await fetch(episodeUrl, { 
+            method: 'HEAD', 
+            mode: 'no-cors',
+            signal: AbortSignal.timeout(3000) // 3绉掕秴鏃?+          });
+          const pingTime = performance.now() - startTime;
+          
+          return { 
+            source, 
+            pingTime: Math.round(pingTime), 
+            available: true 
+          };
+        } catch (error) {
+          console.warn(`杞婚噺绾ф祴閫熷け璐? ${source.source_name}`, error);
+          return { source, pingTime: 9999, available: false };
         }
-
-        const episodeUrl = source.episodes.length > 1
-          ? source.episodes[1]
-          : source.episodes[0];
-
-        // 浠呮祴璇曡繛閫氭€у拰鍝嶅簲鏃堕棿
-        const startTime = performance.now();
-        await fetch(episodeUrl, {
-          method: 'HEAD',
-          mode: 'no-cors',
-          signal: AbortSignal.timeout(3000) // 3绉掕秴鏃?-        });
-        const pingTime = Math.round(performance.now() - startTime);
-
-        results.push({
-          source,
-          pingTime,
-          available: true
-        });
-
-        // 鏇存柊缁撴灉鍒楄〃
-        setSpeedTestProgress(prev => ({
-          ...prev,
-          results: [
-            ...prev.results,
-            {
-              sourceName: source.source_name || '鏈煡婧?,
-              quality: '鏈煡',
-              loadSpeed: '鏈煡',
-              pingTime,
-              status: 'success',
-            },
-          ],
-        }));
-      } catch (error) {
-        console.warn(`杞婚噺绾ф祴閫熷け璐? ${source.source_name}`, error);
-        results.push({ source, pingTime: 9999, available: false });
-
-        // 鏇存柊缁撴灉鍒楄〃
-        setSpeedTestProgress(prev => ({
-          ...prev,
-          results: [
-            ...prev.results,
-            {
-              sourceName: source.source_name || '鏈煡婧?,
-              quality: '鏈煡',
-              loadSpeed: '鏈煡',
-              pingTime: 9999,
-              status: 'failed',
-            },
-          ],
-        }));
-      }
-    }
+      })
+    );
 
     // 鎸夊彲鐢ㄦ€у拰鍝嶅簲鏃堕棿鎺掑簭
     const sortedResults = results
@@ -887,23 +794,15 @@ function PlayPageClient() {
       return sources[0];
     }
 
-    console.log('杞婚噺绾т紭閫夌粨鏋?', sortedResults.map(r =>
+    console.log('杞婚噺绾т紭閫夌粨鏋?', sortedResults.map(r => 
       `${r.source.source_name}: ${r.pingTime}ms`
     ));
-
+    
     return sortedResults[0].source;
   };
 
   // 瀹屾暣娴嬮€燂紙妗岄潰璁惧锛?   const fullSpeedTest = async (sources: SearchResult[]): Promise<SearchResult> => {
-    // 鍒濆鍖栨祴閫熻繘搴?-    setSpeedTestProgress({
-      current: 0,
-      total: sources.length,
-      currentSourceName: '',
-      results: [],
-    });
-
     // 妗岄潰璁惧浣跨敤灏忔壒閲忓苟鍙戯紝閬垮厤鍒涘缓杩囧瀹炰緥
     const concurrency = 2;
     const allResults: Array<{
@@ -911,89 +810,32 @@ function PlayPageClient() {
       testResult: { quality: string; loadSpeed: string; pingTime: number };
     } | null> = [];
 
-    let completedCount = 0;
-
     for (let i = 0; i < sources.length; i += concurrency) {
       const batch = sources.slice(i, i + concurrency);
-      console.log(`娴嬮€熸壒娆?${Math.floor(i / concurrency) + 1}/${Math.ceil(sources.length / concurrency)}: ${batch.length} 涓簮`);
-
+      console.log(`娴嬮€熸壒娆?${Math.floor(i/concurrency) + 1}/${Math.ceil(sources.length/concurrency)}: ${batch.length} 涓簮`);
+      
       const batchResults = await Promise.all(
-        batch.map(async (source, batchIndex) => {
-          const globalIndex = i + batchIndex;
-
-          // 鏇存柊褰撳墠娴嬮€熸簮
-          setSpeedTestProgress(prev => ({
-            ...prev,
-            current: globalIndex + 1,
-            currentSourceName: source.source_name || '鏈煡婧?,
-          }));
-
+        batch.map(async (source) => {
           try {
             if (!source.episodes || source.episodes.length === 0) {
-              // 鏇存柊澶辫触缁撴灉
-              setSpeedTestProgress(prev => ({
-                ...prev,
-                results: [
-                  ...prev.results,
-                  {
-                    sourceName: source.source_name || '鏈煡婧?,
-                    quality: '鏈煡',
-                    loadSpeed: '鏈煡',
-                    pingTime: 9999,
-                    status: 'failed',
-                  },
-                ],
-              }));
               return null;
             }
 
             const episodeUrl = source.episodes.length > 1
               ? source.episodes[1]
               : source.episodes[0];
-
+            
             const testResult = await getVideoResolutionFromM3u8(episodeUrl);
-
-            // 鏇存柊鎴愬姛缁撴灉
-            setSpeedTestProgress(prev => ({
-              ...prev,
-              results: [
-                ...prev.results,
-                {
-                  sourceName: source.source_name || '鏈煡婧?,
-                  quality: testResult.quality,
-                  loadSpeed: testResult.loadSpeed,
-                  pingTime: testResult.pingTime,
-                  status: 'success',
-                },
-              ],
-            }));
-
             return { source, testResult };
           } catch (error) {
             console.warn(`娴嬮€熷け璐? ${source.source_name}`, error);
-
-            // 鏇存柊澶辫触缁撴灉
-            setSpeedTestProgress(prev => ({
-              ...prev,
-              results: [
-                ...prev.results,
-                {
-                  sourceName: source.source_name || '鏈煡婧?,
-                  quality: '鏈煡',
-                  loadSpeed: '鏈煡',
-                  pingTime: 9999,
-                  status: 'failed',
-                },
-              ],
-            }));
             return null;
           }
         })
       );
-
+      
       allResults.push(...batchResults);
-      completedCount += batch.length;
-
+      
       // 鎵规闂村欢杩燂紝璁╄祫婧愭湁鏃堕棿娓呯悊
       if (i + concurrency < sources.length) {
         await new Promise(resolve => setTimeout(resolve, 500));
@@ -1237,21 +1079,21 @@ function PlayPageClient() {
         const memInfo = (performance as any).memory;
         const usedJSHeapSize = memInfo.usedJSHeapSize;
         const heapLimit = memInfo.jsHeapSizeLimit;
-
+        
         // 璁＄畻鍐呭瓨浣跨敤鐜?         const memoryUsageRatio = usedJSHeapSize / heapLimit;
-
+        
         console.log(`鍐呭瓨浣跨敤鎯呭喌: ${(memoryUsageRatio * 100).toFixed(2)}% (${(usedJSHeapSize / 1024 / 1024).toFixed(2)}MB / ${(heapLimit / 1024 / 1024).toFixed(2)}MB)`);
-
+        
         // 濡傛灉鍐呭瓨浣跨敤瓒呰繃75%锛岃Е鍙戞竻鐞?         if (memoryUsageRatio > 0.75) {
           console.warn('鍐呭瓨浣跨敤杩囬珮锛屾竻鐞嗙紦瀛?..');
-
+          
           // 娓呯悊寮瑰箷缂撳瓨
           try {
             // 娓呯悊缁熶竴瀛樺偍涓殑寮瑰箷缂撳瓨
             await ClientCache.clearExpired('danmu-cache');
-
+            
             // 鍏滃簳娓呯悊localStorage涓殑寮瑰箷缂撳瓨锛堝吋瀹规€э級
             const oldCacheKey = 'lunatv_danmu_cache';
             localStorage.removeItem(oldCacheKey);
@@ -1259,13 +1101,13 @@ function PlayPageClient() {
           } catch (e) {
             console.warn('娓呯悊寮瑰箷缂撳瓨澶辫触:', e);
           }
-
+          
           // 灏濊瘯寮哄埗鍨冨溇鍥炴敹锛堝鏋滃彲鐢級
           if (typeof (window as any).gc === 'function') {
             (window as any).gc();
             console.log('宸茶Е鍙戝瀮鍦惧洖鏀?);
           }
-
+          
           return true; // 杩斿洖鐪熻〃绀洪珮鍐呭瓨鍘嬪姏
         }
       } catch (error) {
@@ -1278,22 +1120,16 @@ function PlayPageClient() {
   // 瀹氭湡鍐呭瓨妫€鏌ワ紙浠呭湪绉诲姩璁惧涓婏級
   useEffect(() => {
     if (!isMobileGlobal) return;
-
+    
     const memoryCheckInterval = setInterval(() => {
       // 寮傛璋冪敤鍐呭瓨妫€鏌ワ紝涓嶉樆濉炲畾鏃跺櫒
       checkMemoryPressure().catch(console.error);
     }, 30000); // 姣?0绉掓鏌ヤ竴娆?-
+    
     return () => {
       clearInterval(memoryCheckInterval);
     };
   }, [isMobileGlobal]);
-
-  // 鍒濆鍖?Portal 瀹瑰櫒
-  useEffect(() => {
-    setPortalContainer(document.body);
-  }, []);
-
   const requestWakeLock = async () => {
     try {
       if ('wakeLock' in navigator) {
@@ -1326,27 +1162,27 @@ function PlayPageClient() {
       clearTimeout(danmuOperationTimeoutRef.current);
       danmuOperationTimeoutRef.current = null;
     }
-
+    
     if (episodeSwitchTimeoutRef.current) {
       clearTimeout(episodeSwitchTimeoutRef.current);
       episodeSwitchTimeoutRef.current = null;
     }
-
+    
     // 娓呯悊寮瑰箷鐘舵€佸紩鐢?     danmuPluginStateRef.current = null;
-
+    
     if (artPlayerRef.current) {
       try {
         // 1. 娓呯悊寮瑰箷鎻掍欢鐨刉ebWorker
         if (artPlayerRef.current.plugins?.artplayerPluginDanmuku) {
           const danmukuPlugin = artPlayerRef.current.plugins.artplayerPluginDanmuku;
-
+          
           // 灏濊瘯鑾峰彇骞舵竻鐞哤ebWorker
           if (danmukuPlugin.worker && typeof danmukuPlugin.worker.terminate === 'function') {
             danmukuPlugin.worker.terminate();
             console.log('寮瑰箷WebWorker宸叉竻鐞?);
           }
-
+          
           // 娓呯┖寮瑰箷鏁版嵁
           if (typeof danmukuPlugin.reset === 'function') {
             danmukuPlugin.reset();
@@ -1372,156 +1208,50 @@ function PlayPageClient() {
     }
   };
 
-  // ============================================================================
-  // 鏅鸿兘骞垮憡杩囨护绯荤粺 - Smart Ad Filtering System
-  // 鍩轰簬琛屼笟鏍囧噯骞垮憡鏍囪鍜孶RL妯″紡妫€娴?-  // ============================================================================
-
-  /**
-   * 妫€鏌?URL 鏄惁鍖呭惈骞垮憡鍏抽敭璇?-   */
-  function isAdUrl(url: string): boolean {
-    const adKeywords = [
-      '/ad/', '/ads/', '/advert/', '/commercial/',
-      'doubleclick', 'googlesyndication', 'advertising',
-      'ad-', 'ads-', '-ad-', '-ads-',
-      'adserver', 'adservice'
-    ];
-
-    const lowerUrl = url.toLowerCase();
-    return adKeywords.some(keyword => lowerUrl.includes(keyword));
-  }
-
-  /**
-   * 妫€娴嬪父瑙佸箍鍛婃椂闀挎ā寮忥紙15绉掋€?0绉掋€?0绉掔瓑锛?-   */
-  function isAdDuration(duration: number): boolean {
-    const commonAdDurations = [15, 30, 60];
-    const tolerance = 1; // 鍏佽1绉掕宸?-
-    return commonAdDurations.some(
-      adDuration => Math.abs(duration - adDuration) < tolerance
-    );
-  }
-
-  /**
-   * 鏅鸿兘骞垮憡杩囨护 - 缁煎悎澶氱妫€娴嬫柟娉?-   * 1. 妫€娴嬭涓氭爣鍑嗗箍鍛婃爣璁帮紙EXT-X-CUE-OUT/IN, DATERANGE, SCTE35锛?-   * 2. 妫€娴?DISCONTINUITY + 骞垮憡鏃堕暱妯″紡
-   * 3. 妫€娴?URL 涓殑骞垮憡鍏抽敭璇?-   */
+  // 鍘诲箍鍛婄浉鍏冲嚱鏁?   function filterAdsFromM3U8(m3u8Content: string): string {
     if (!m3u8Content) return '';
 
+    // 鎸夎鍒嗗壊M3U8鍐呭
     const lines = m3u8Content.split('\n');
-    const filteredLines: string[] = [];
-
+    const filteredLines = [];
     let inAdBlock = false; // 鏄惁鍦ㄥ箍鍛婂尯鍧楀唴
-    let skipNextUrl = false; // 鏄惁璺宠繃涓嬩竴涓?URL 琛?-    let adSegmentCount = 0; // 绉婚櫎鐨勫箍鍛婄墖娈垫暟閲?+    let adSegmentCount = 0; // 缁熻绉婚櫎鐨勫箍鍛婄墖娈垫暟閲? 
     for (let i = 0; i < lines.length; i++) {
       const line = lines[i];
-      const trimmedLine = line.trim();
 
-      // 1. 妫€娴嬫槑纭殑骞垮憡鏍囪鏍囩锛堣涓氭爣鍑嗭級
-      if (
-        trimmedLine.includes('#EXT-X-CUE-OUT') ||
-        trimmedLine.includes('#EXT-X-CUE') ||
-        trimmedLine.startsWith('#EXT-X-DATERANGE') ||
-        trimmedLine.includes('SCTE35') ||
-        trimmedLine.includes('#EXT-OATCLS-SCTE35')
-      ) {
+      // 馃幆 澧炲己鍔熻兘1: 妫€娴嬭涓氭爣鍑嗗箍鍛婃爣璁帮紙SCTE-35绯诲垪锛?+      // 浣跨敤 line.includes() 淇濇寔涓庡師閫昏緫涓€鑷达紝鍏煎鍚勭鏍煎紡
+      if (line.includes('#EXT-X-CUE-OUT') ||
+          (line.includes('#EXT-X-DATERANGE') && line.includes('SCTE35')) ||
+          line.includes('#EXT-X-SCTE35') ||
+          line.includes('#EXT-OATCLS-SCTE35')) {
         inAdBlock = true;
         adSegmentCount++;
-        continue; // 璺宠繃骞垮憡鏍囪琛?+        continue; // 璺宠繃骞垮憡寮€濮嬫爣璁?       }
 
-      // 2. 妫€娴嬪箍鍛婄粨鏉熸爣璁?-      if (trimmedLine.includes('#EXT-X-CUE-IN')) {
+      // 馃幆 澧炲己鍔熻兘2: 妫€娴嬪箍鍛婄粨鏉熸爣璁?+      if (line.includes('#EXT-X-CUE-IN')) {
         inAdBlock = false;
-        continue;
+        continue; // 璺宠繃骞垮憡缁撴潫鏍囪
       }
 
-      // 3. 濡傛灉鍦ㄥ箍鍛婂尯鍧楀唴锛岃烦杩囨墍鏈夊唴瀹?+      // 馃幆 澧炲己鍔熻兘3: 濡傛灉鍦ㄥ箍鍛婂尯鍧楀唴锛岃烦杩囨墍鏈夊唴瀹?       if (inAdBlock) {
-        // 缁熻璺宠繃鐨勭墖娈?-        if (trimmedLine.startsWith('#EXTINF:')) {
-          adSegmentCount++;
-        }
         continue;
       }
 
-      // 4. 妫€娴?DISCONTINUITY 鏍囪锛堝彲鑳芥槸骞垮憡鎻掑叆鐐癸級
-      if (trimmedLine.includes('#EXT-X-DISCONTINUITY')) {
-        // 妫€鏌ユ帴涓嬫潵鐨勭墖娈垫槸鍚︽湁骞垮憡鐗瑰緛
-        let hasAdCharacteristics = false;
-
-        // 鍚戝墠鐪嬫渶澶?琛岋紝妫€娴嬪箍鍛婄壒寰?-        for (let j = i + 1; j < Math.min(i + 4, lines.length); j++) {
-          const nextLine = lines[j].trim();
-
-          // 妫€鏌?EXTINF 琛岀殑鏃堕暱
-          if (nextLine.startsWith('#EXTINF:')) {
-            const durationMatch = nextLine.match(/#EXTINF:([\d.]+)/);
-            if (durationMatch) {
-              const duration = parseFloat(durationMatch[1]);
-              if (isAdDuration(duration)) {
-                hasAdCharacteristics = true;
-                break;
-              }
-            }
-          }
-
-          // 妫€鏌?URL 鏄惁鍖呭惈骞垮憡鍏抽敭璇?-          if (!nextLine.startsWith('#') && nextLine.length > 0) {
-            if (isAdUrl(nextLine)) {
-              hasAdCharacteristics = true;
-              break;
-            }
-            break; // 鎵惧埌 URL 鍚庡氨鍋滄
-          }
-        }
-
-        if (hasAdCharacteristics) {
-          skipNextUrl = true;
-          adSegmentCount++;
-          continue; // 璺宠繃 DISCONTINUITY
-        }
-      }
-
-      // 5. 妫€鏌?URL 琛屾槸鍚﹀寘鍚箍鍛婂叧閿瘝
-      if (!trimmedLine.startsWith('#') && trimmedLine.length > 0) {
-        if (isAdUrl(trimmedLine)) {
-          // 鍚屾椂绉婚櫎鍓嶄竴琛岀殑 #EXTINF锛堝鏋滃瓨鍦級
-          if (filteredLines.length > 0 &&
-            filteredLines[filteredLines.length - 1].trim().startsWith('#EXTINF:')) {
-            filteredLines.pop();
-          }
-          skipNextUrl = false;
-          adSegmentCount++;
-          continue;
-        }
-
-        // 濡傛灉鏍囪涓鸿烦杩囷紝鍒欒烦杩囨 URL
-        if (skipNextUrl) {
-          // 鍚屾椂绉婚櫎鍓嶄竴琛岀殑 #EXTINF锛堝鏋滃瓨鍦級
-          if (filteredLines.length > 0 &&
-            filteredLines[filteredLines.length - 1].trim().startsWith('#EXTINF:')) {
-            filteredLines.pop();
-          }
-          skipNextUrl = false;
-          continue;
-        }
+      // 鉁?鍘熷閫昏緫淇濈暀: 杩囨护#EXT-X-DISCONTINUITY鏍囪瘑
+      if (!line.includes('#EXT-X-DISCONTINUITY')) {
+        filteredLines.push(line);
       }
-
-      // 6. 淇濈暀闈炲箍鍛婂唴瀹?-      filteredLines.push(line);
     }
 
-    // 杈撳嚭杩囨护缁熻
+    // 杈撳嚭缁熻淇℃伅
     if (adSegmentCount > 0) {
-      console.log(`鉁?骞垮憡杩囨护: 绉婚櫎 ${adSegmentCount} 涓箍鍛婄墖娈礰);
+      console.log(`鉁?M3U8骞垮憡杩囨护: 绉婚櫎 ${adSegmentCount} 涓箍鍛婄墖娈礰);
     }
 
     return filteredLines.join('\n');
@@ -1583,28 +1313,28 @@ function PlayPageClient() {
     if (danmuOperationTimeoutRef.current) {
       clearTimeout(danmuOperationTimeoutRef.current);
     }
-
+    
     // 绔嬪嵆鏇存柊UI鐘舵€侊紙纭繚鍝嶅簲鎬э級
     externalDanmuEnabledRef.current = nextState;
     setExternalDanmuEnabled(nextState);
-
+    
     // 鍚屾淇濆瓨鍒發ocalStorage锛堝揩閫熸搷浣滐級
     try {
       localStorage.setItem('enable_external_danmu', String(nextState));
     } catch (e) {
       console.warn('localStorage璁剧疆澶辫触:', e);
     }
-
+    
     // 闃叉姈澶勭悊寮瑰箷鏁版嵁鎿嶄綔锛堥伩鍏嶉绻佸垏鎹㈡椂鐨勬€ц兘闂锛?     danmuOperationTimeoutRef.current = setTimeout(async () => {
       try {
         if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
           const plugin = artPlayerRef.current.plugins.artplayerPluginDanmuku;
-
+          
           if (nextState) {
             // 寮€鍚脊骞曪細浣跨敤鏇存俯鍜岀殑鍔犺浇鏂瑰紡
             console.log('馃殌 浼樺寲鍚庡紑鍚閮ㄥ脊骞?..');
-
+            
             // 浣跨敤requestIdleCallback浼樺寲鎬ц兘锛堝鏋滃彲鐢級
             const loadDanmu = async () => {
               const externalDanmu = await loadExternalDanmu();
@@ -1613,13 +1343,13 @@ function PlayPageClient() {
                 plugin.load(externalDanmu);
                 plugin.show();
                 console.log('鉁?澶栭儴寮瑰箷宸蹭紭鍖栧姞杞?', externalDanmu.length, '鏉?);
-
+                
                 if (artPlayerRef.current && externalDanmu.length > 0) {
                   artPlayerRef.current.notice.show = `宸插姞杞?${externalDanmu.length} 鏉″脊骞昤;
                 }
               }
             };
-
+            
             // 浣跨敤 requestIdleCallback 鎴?setTimeout 鏉ョ‘淇濅笉闃诲涓荤嚎绋?             if (typeof requestIdleCallback !== 'undefined') {
               requestIdleCallback(loadDanmu, { timeout: 1000 });
@@ -1632,7 +1362,7 @@ function PlayPageClient() {
             plugin.load(); // 涓嶄紶鍙傛暟锛岀湡姝ｆ竻绌哄脊骞?             plugin.hide();
             console.log('鉁?澶栭儴寮瑰箷宸插叧闂?);
-
+            
             if (artPlayerRef.current) {
               artPlayerRef.current.notice.show = '澶栭儴寮瑰箷宸插叧闂?;
             }
@@ -1650,14 +1380,14 @@ function PlayPageClient() {
       console.log('澶栭儴寮瑰箷寮€鍏冲凡鍏抽棴');
       return [];
     }
-
+    
     // 鐢熸垚褰撳墠璇锋眰鐨勫敮涓€鏍囪瘑
     const currentVideoTitle = videoTitle;
-    const currentVideoYear = videoYear;
+    const currentVideoYear = videoYear; 
     const currentVideoDoubanId = videoDoubanId;
     const currentEpisodeNum = currentEpisodeIndex + 1;
     const requestKey = `${currentVideoTitle}_${currentVideoYear}_${currentVideoDoubanId}_${currentEpisodeNum}`;
-
+    
     // 馃殌 浼樺寲鍔犺浇鐘舵€佹娴嬶細鏇存櫤鑳界殑鍗′綇妫€娴?     const now = Date.now();
     const loadingState = danmuLoadingRef.current as any;
@@ -1687,16 +1417,16 @@ function PlayPageClient() {
       episode: currentEpisodeNum
     } as any;
     lastDanmuLoadKeyRef.current = requestKey;
-
+    
     try {
       const params = new URLSearchParams();
-
+      
       // 浣跨敤褰撳墠鏈€鏂扮殑state鍊艰€屼笉鏄痳ef鍊?       const currentVideoTitle = videoTitle;
-      const currentVideoYear = videoYear;
+      const currentVideoYear = videoYear; 
       const currentVideoDoubanId = videoDoubanId;
       const currentEpisodeNum = currentEpisodeIndex + 1;
-
+      
       if (currentVideoDoubanId && currentVideoDoubanId > 0) {
         params.append('douban_id', currentVideoDoubanId.toString());
       }
@@ -1718,7 +1448,7 @@ function PlayPageClient() {
       // 鐢熸垚缂撳瓨閿紙浣跨敤state鍊肩‘淇濆噯纭€э級
       const cacheKey = `${currentVideoTitle}_${currentVideoYear}_${currentVideoDoubanId}_${currentEpisodeNum}`;
       const now = Date.now();
-
+      
       console.log('馃攽 寮瑰箷缂撳瓨璋冭瘯淇℃伅:');
       console.log('- 缂撳瓨閿?', cacheKey);
       console.log('- 褰撳墠鏃堕棿:', now);
@@ -1726,7 +1456,7 @@ function PlayPageClient() {
       console.log('- 瑙嗛骞翠唤:', currentVideoYear);
       console.log('- 璞嗙摚ID:', currentVideoDoubanId);
       console.log('- 闆嗘暟:', currentEpisodeNum);
-
+      
       // 妫€鏌ョ紦瀛?       console.log('馃攳 妫€鏌ュ脊骞曠紦瀛?', cacheKey);
       const cached = await getDanmuCacheItem(cacheKey);
@@ -1736,7 +1466,7 @@ function PlayPageClient() {
         console.log('- 鏃堕棿宸?', now - cached.timestamp, 'ms');
         console.log('- 缂撳瓨鏈夋晥鏈?', DANMU_CACHE_DURATION * 1000, 'ms');
         console.log('- 鏄惁杩囨湡:', (now - cached.timestamp) >= (DANMU_CACHE_DURATION * 1000));
-
+        
         if ((now - cached.timestamp) < (DANMU_CACHE_DURATION * 1000)) {
           console.log('鉁?浣跨敤寮瑰箷缂撳瓨鏁版嵁锛岀紦瀛橀敭:', cacheKey);
           console.log('馃搳 缂撳瓨寮瑰箷鏁伴噺:', cached.data.length);
@@ -1749,7 +1479,7 @@ function PlayPageClient() {
       console.log('寮€濮嬭幏鍙栧閮ㄥ脊骞曪紝鍙傛暟:', params.toString());
       const response = await fetch(`/api/danmu-external?${params}`);
       console.log('寮瑰箷API鍝嶅簲鐘舵€?', response.status, response.statusText);
-
+      
       if (!response.ok) {
         const errorText = await response.text();
         console.error('寮瑰箷API璇锋眰澶辫触:', response.status, errorText);
@@ -1759,19 +1489,19 @@ function PlayPageClient() {
       const data = await response.json();
       console.log('澶栭儴寮瑰箷API杩斿洖鏁版嵁:', data);
       console.log('澶栭儴寮瑰箷鍔犺浇鎴愬姛:', data.total || 0, '鏉?);
-
+      
       const finalDanmu = data.danmu || [];
       console.log('鏈€缁堝脊骞曟暟鎹?', finalDanmu.length, '鏉?);
-
+      
       // 缂撳瓨缁撴灉
       console.log('馃捑 淇濆瓨寮瑰箷鍒扮粺涓€瀛樺偍:');
       console.log('- 缂撳瓨閿?', cacheKey);
       console.log('- 寮瑰箷鏁伴噺:', finalDanmu.length);
       console.log('- 淇濆瓨鏃堕棿:', now);
-
+      
       // 淇濆瓨鍒扮粺涓€瀛樺偍
       await setDanmuCacheItem(cacheKey, finalDanmu);
-
+      
       return finalDanmu;
     } catch (error) {
       console.error('鍔犺浇澶栭儴寮瑰箷澶辫触:', error);
@@ -1827,7 +1557,7 @@ function PlayPageClient() {
         isStop: artPlayerRef.current.plugins.artplayerPluginDanmuku.isStop,
         option: artPlayerRef.current.plugins.artplayerPluginDanmuku.option
       };
-
+      
       // 浣跨敤闃叉姈澶勭悊寮瑰箷閲嶆柊鍔犺浇
       episodeSwitchTimeoutRef.current = setTimeout(async () => {
         try {
@@ -1836,25 +1566,25 @@ function PlayPageClient() {
             console.warn('鈿狅笍 闆嗘暟鍒囨崲鍚庡脊骞曟彃浠朵笉瀛樺湪锛岃烦杩囧脊骞曞姞杞?);
             return;
           }
-
+          
           const externalDanmu = await loadExternalDanmu(); // 杩欓噷浼氭鏌ュ紑鍏崇姸鎬?           console.log('馃攧 闆嗘暟鍙樺寲鍚庡閮ㄥ脊骞曞姞杞界粨鏋?', externalDanmu);
-
+          
           // 鍐嶆纭鎻掍欢鐘舵€?           if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
             const plugin = artPlayerRef.current.plugins.artplayerPluginDanmuku;
-
+            
             if (externalDanmu.length > 0) {
               console.log('鉁?鍚戞挱鏀惧櫒鎻掍欢閲嶆柊鍔犺浇寮瑰箷鏁版嵁:', externalDanmu.length, '鏉?);
               plugin.load(externalDanmu);
-
+              
               // 鎭㈠寮瑰箷鎻掍欢鐨勭姸鎬?               if (danmuPluginStateRef.current) {
                 if (!danmuPluginStateRef.current.isHide) {
                   plugin.show();
                 }
               }
-
+              
               if (artPlayerRef.current) {
                 artPlayerRef.current.notice.show = `宸插姞杞?${externalDanmu.length} 鏉″脊骞昤;
               }
@@ -1877,66 +1607,6 @@ function PlayPageClient() {
     }
   }, [detail, currentEpisodeIndex]);
 
-  // 鍒锋柊鎼滅储婧?- 缁勪欢绾у埆鐨勫嚱鏁?-  const refreshSources = useCallback(async () => {
-    setSourceSearchLoading(true);
-    setSourceSearchError(null);
-    try {
-      console.log('鎵嬪姩鍒锋柊鎼滅储婧?..');
-      const query = searchTitle || videoTitle;
-      if (!query) {
-        throw new Error('缂哄皯鎼滅储鏍囬');
-      }
-
-      // 浣跨敤鏅鸿兘鎼滅储鍙樹綋鑾峰彇鍏ㄩ儴婧愪俊鎭?-      const searchVariants = generateSearchVariants(query.trim());
-      const allResults: SearchResult[] = [];
-      let bestResults: SearchResult[] = [];
-
-      // 渚濇灏濊瘯姣忎釜鎼滅储鍙樹綋
-      for (const variant of searchVariants) {
-        const response = await fetch(
-          `/api/search?q=${encodeURIComponent(variant)}`
-        );
-        if (!response.ok) continue;
-
-        const data = await response.json();
-        if (data.results && data.results.length > 0) {
-          allResults.push(...data.results);
-
-          const filteredResults = data.results.filter(
-            (result: SearchResult) => {
-              const queryTitle = videoTitle.replaceAll(' ', '').toLowerCase();
-              const resultTitle = result.title.replaceAll(' ', '').toLowerCase();
-              const titleMatch = resultTitle.includes(queryTitle) || queryTitle.includes(resultTitle);
-              const yearMatch = videoYear ? result.year.toLowerCase() === videoYear.toLowerCase() : true;
-              return titleMatch && yearMatch;
-            }
-          );
-
-          if (filteredResults.length > 0) {
-            bestResults = filteredResults;
-            break;
-          }
-        }
-      }
-
-      const finalResults = bestResults.length > 0 ? bestResults : allResults;
-      setAvailableSources(finalResults);
-
-      if (finalResults.length === 0) {
-        setSourceSearchError('鏈壘鍒板尮閰嶇粨鏋?);
-      } else {
-        console.log(`鍒锋柊鎴愬姛锛屾壘鍒?${finalResults.length} 涓挱鏀炬簮`);
-      }
-    } catch (err) {
-      console.error('鍒锋柊鎼滅储婧愬け璐?', err);
-      setSourceSearchError(err instanceof Error ? err.message : '鍒锋柊澶辫触');
-    } finally {
-      setSourceSearchLoading(false);
-    }
-  }, [searchTitle, videoTitle, videoYear]);
-
   // 杩涘叆椤甸潰鏃剁洿鎺ヨ幏鍙栧叏閮ㄦ簮淇℃伅
   useEffect(() => {
     const fetchSourceDetail = async (
@@ -1976,10 +1646,10 @@ function PlayPageClient() {
         console.log('寮€濮嬫櫤鑳芥悳绱紝鍘熷鏌ヨ:', query);
         const searchVariants = generateSearchVariants(query.trim());
         console.log('鐢熸垚鐨勬悳绱㈠彉浣?', searchVariants);
-
+        
         const allResults: SearchResult[] = [];
         let bestResults: SearchResult[] = [];
-
+        
         // 渚濇灏濊瘯姣忎釜鎼滅储鍙樹綋锛岄噰鐢ㄦ棭鏈熼€€鍑虹瓥鐣?         for (const variant of searchVariants) {
           console.log('灏濊瘯鎼滅储鍙樹綋:', variant);
@@ -2024,7 +1694,7 @@ function PlayPageClient() {
                   : true;
                 const typeMatch = searchType
                   ? (searchType === 'tv' && result.episodes.length > 1) ||
-                  (searchType === 'movie' && result.episodes.length === 1)
+                    (searchType === 'movie' && result.episodes.length === 1)
                   : true;
 
                 return titleMatch && yearMatch && typeMatch;
@@ -2038,7 +1708,7 @@ function PlayPageClient() {
             }
           }
         }
-
+        
         // 鏅鸿兘鍖归厤锛氳嫳鏂囨爣棰樹弗鏍煎尮閰嶏紝涓枃鏍囬瀹芥澗鍖归厤
         let finalResults = bestResults;
 
@@ -2078,7 +1748,7 @@ function PlayPageClient() {
                   titleWord.includes(queryWord) || queryWord.includes(titleWord) ||
                   // 鍏佽閮ㄥ垎鐩镐技锛堝gumball vs gum锛?                   (queryWord.length > 4 && titleWord.length > 4 &&
-                    queryWord.substring(0, 4) === titleWord.substring(0, 4))
+                   queryWord.substring(0, 4) === titleWord.substring(0, 4))
                 )
               );
 
@@ -2106,7 +1776,7 @@ function PlayPageClient() {
               const commonChars = Array.from(normalizedQuery).filter(char => normalizedTitle.includes(char)).length;
               const similarity = commonChars / normalizedQuery.length;
               if (similarity >= 0.5) {
-                console.log(`涓枃鐩镐技鍖归厤 (${(similarity * 100).toFixed(1)}%): "${result.title}"`);
+                console.log(`涓枃鐩镐技鍖归厤 (${(similarity*100).toFixed(1)}%): "${result.title}"`);
                 return true;
               }
               return false;
@@ -2125,7 +1795,7 @@ function PlayPageClient() {
             finalResults = [];
           }
         }
-
+          
         console.log(`鏅鸿兘鎼滅储瀹屾垚锛屾渶缁堣繑鍥?${finalResults.length} 涓粨鏋渀);
         setAvailableSources(finalResults);
         return finalResults;
@@ -2495,7 +2165,7 @@ function PlayPageClient() {
     return () => {
       document.removeEventListener('keydown', handleKeyboardShortcuts);
     };
-  }, [showEpisodePopup]);
+  }, []);
 
   // 馃殌 缁勪欢鍗歌浇鏃舵竻鐞嗘墍鏈夊畾鏃跺櫒鍜岀姸鎬?   useEffect(() => {
@@ -2572,13 +2242,6 @@ function PlayPageClient() {
     )
       return;
 
-    // ESC 閿叧闂€夐泦娴眰
-    if (e.key === 'Escape' && showEpisodePopup) {
-      setShowEpisodePopup(false);
-      e.preventDefault();
-      return;
-    }
-
     // Alt + 宸︾澶?= 涓婁竴闆?     if (e.altKey && e.key === 'ArrowLeft') {
       if (detailRef.current && currentEpisodeIndexRef.current > 0) {
@@ -2883,596 +2546,574 @@ function PlayPageClient() {
         return;
       }
 
-      // 纭繚閫夐泦绱㈠紩鏈夋晥
-      if (
-        !detail ||
-        !detail.episodes ||
-        currentEpisodeIndex >= detail.episodes.length ||
-        currentEpisodeIndex < 0
-      ) {
-        setError(`閫夐泦绱㈠紩鏃犳晥锛屽綋鍓嶅叡 ${totalEpisodes} 闆哷);
-        return;
-      }
+    // 纭繚閫夐泦绱㈠紩鏈夋晥
+    if (
+      !detail ||
+      !detail.episodes ||
+      currentEpisodeIndex >= detail.episodes.length ||
+      currentEpisodeIndex < 0
+    ) {
+      setError(`閫夐泦绱㈠紩鏃犳晥锛屽綋鍓嶅叡 ${totalEpisodes} 闆哷);
+      return;
+    }
 
-      if (!videoUrl) {
-        setError('瑙嗛鍦板潃鏃犳晥');
-        return;
-      }
-      console.log(videoUrl);
-
-      // 妫€娴嬬Щ鍔ㄨ澶囧拰娴忚鍣ㄧ被鍨?- 浣跨敤缁熶竴鐨勫叏灞€妫€娴嬬粨鏋?-      const isSafari = /^(?:(?!chrome|android).)*safari/i.test(userAgent);
-      const isIOS = isIOSGlobal;
-      const isIOS13 = isIOS13Global;
-      const isMobile = isMobileGlobal;
-      const isWebKit = isSafari || isIOS;
-      // Chrome娴忚鍣ㄦ娴?- 鍙湁鐪熸鐨凜hrome鎵嶆敮鎸丆hromecast
-      // 鎺掗櫎鍚勭鍘傚晢娴忚鍣紝鍗充娇瀹冧滑鐨刄A鍖呭惈Chrome瀛楁牱
-      const isChrome = /Chrome/i.test(userAgent) &&
-        !/Edg/i.test(userAgent) &&      // 鎺掗櫎Edge
-        !/OPR/i.test(userAgent) &&      // 鎺掗櫎Opera
-        !/SamsungBrowser/i.test(userAgent) && // 鎺掗櫎涓夋槦娴忚鍣?-        !/OPPO/i.test(userAgent) &&     // 鎺掗櫎OPPO娴忚鍣?-        !/OppoBrowser/i.test(userAgent) && // 鎺掗櫎OppoBrowser
-        !/HeyTapBrowser/i.test(userAgent) && // 鎺掗櫎HeyTapBrowser (OPPO鏂扮増娴忚鍣?
-        !/OnePlus/i.test(userAgent) &&  // 鎺掗櫎OnePlus娴忚鍣?-        !/Xiaomi/i.test(userAgent) &&   // 鎺掗櫎灏忕背娴忚鍣?-        !/MIUI/i.test(userAgent) &&     // 鎺掗櫎MIUI娴忚鍣?-        !/Huawei/i.test(userAgent) &&   // 鎺掗櫎鍗庝负娴忚鍣?-        !/Vivo/i.test(userAgent) &&     // 鎺掗櫎Vivo娴忚鍣?-        !/UCBrowser/i.test(userAgent) && // 鎺掗櫎UC娴忚鍣?-        !/QQBrowser/i.test(userAgent) && // 鎺掗櫎QQ娴忚鍣?-        !/Baidu/i.test(userAgent) &&    // 鎺掗櫎鐧惧害娴忚鍣?-        !/SogouMobileBrowser/i.test(userAgent); // 鎺掗櫎鎼滅嫍娴忚鍣?-
-      // 璋冭瘯淇℃伅锛氳緭鍑鸿澶囨娴嬬粨鏋滃拰鎶曞睆绛栫暐
-      console.log('馃攳 璁惧妫€娴嬬粨鏋?', {
-        userAgent,
-        isIOS,
-        isSafari,
-        isMobile,
-        isWebKit,
-        isChrome,
-        'AirPlay鎸夐挳': isIOS || isSafari ? '鉁?鏄剧ず' : '鉂?闅愯棌',
-        'Chromecast鎸夐挳': isChrome && !isIOS ? '鉁?鏄剧ず' : '鉂?闅愯棌',
-        '鎶曞睆绛栫暐': isIOS || isSafari ? '馃崕 AirPlay (WebKit)' : isChrome ? '馃摵 Chromecast (Cast API)' : '鉂?涓嶆敮鎸佹姇灞?
-      });
+    if (!videoUrl) {
+      setError('瑙嗛鍦板潃鏃犳晥');
+      return;
+    }
+    console.log(videoUrl);
 
-      // 馃殌 浼樺寲杩炵画鍒囨崲锛氶槻鎶栨満鍒?+ 璧勬簮绠＄悊
-      if (artPlayerRef.current && !loading) {
-        try {
-          // 娓呴櫎涔嬪墠鐨勫垏鎹㈠畾鏃跺櫒
-          if (sourceSwitchTimeoutRef.current) {
-            clearTimeout(sourceSwitchTimeoutRef.current);
-            sourceSwitchTimeoutRef.current = null;
-          }
+    // 妫€娴嬬Щ鍔ㄨ澶囧拰娴忚鍣ㄧ被鍨?- 浣跨敤缁熶竴鐨勫叏灞€妫€娴嬬粨鏋?+    const isSafari = /^(?:(?!chrome|android).)*safari/i.test(userAgent);
+    const isIOS = isIOSGlobal;
+    const isIOS13 = isIOS13Global;
+    const isMobile = isMobileGlobal;
+    const isWebKit = isSafari || isIOS;
+    // Chrome娴忚鍣ㄦ娴?- 鍙湁鐪熸鐨凜hrome鎵嶆敮鎸丆hromecast
+    // 鎺掗櫎鍚勭鍘傚晢娴忚鍣紝鍗充娇瀹冧滑鐨刄A鍖呭惈Chrome瀛楁牱
+    const isChrome = /Chrome/i.test(userAgent) && 
+                    !/Edg/i.test(userAgent) &&      // 鎺掗櫎Edge
+                    !/OPR/i.test(userAgent) &&      // 鎺掗櫎Opera
+                    !/SamsungBrowser/i.test(userAgent) && // 鎺掗櫎涓夋槦娴忚鍣?+                    !/OPPO/i.test(userAgent) &&     // 鎺掗櫎OPPO娴忚鍣?+                    !/OppoBrowser/i.test(userAgent) && // 鎺掗櫎OppoBrowser
+                    !/HeyTapBrowser/i.test(userAgent) && // 鎺掗櫎HeyTapBrowser (OPPO鏂扮増娴忚鍣?
+                    !/OnePlus/i.test(userAgent) &&  // 鎺掗櫎OnePlus娴忚鍣?+                    !/Xiaomi/i.test(userAgent) &&   // 鎺掗櫎灏忕背娴忚鍣?+                    !/MIUI/i.test(userAgent) &&     // 鎺掗櫎MIUI娴忚鍣?+                    !/Huawei/i.test(userAgent) &&   // 鎺掗櫎鍗庝负娴忚鍣?+                    !/Vivo/i.test(userAgent) &&     // 鎺掗櫎Vivo娴忚鍣?+                    !/UCBrowser/i.test(userAgent) && // 鎺掗櫎UC娴忚鍣?+                    !/QQBrowser/i.test(userAgent) && // 鎺掗櫎QQ娴忚鍣?+                    !/Baidu/i.test(userAgent) &&    // 鎺掗櫎鐧惧害娴忚鍣?+                    !/SogouMobileBrowser/i.test(userAgent); // 鎺掗櫎鎼滅嫍娴忚鍣?+
+    // 璋冭瘯淇℃伅锛氳緭鍑鸿澶囨娴嬬粨鏋滃拰鎶曞睆绛栫暐
+    console.log('馃攳 璁惧妫€娴嬬粨鏋?', {
+      userAgent,
+      isIOS,
+      isSafari,
+      isMobile,
+      isWebKit,
+      isChrome,
+      'AirPlay鎸夐挳': isIOS || isSafari ? '鉁?鏄剧ず' : '鉂?闅愯棌',
+      'Chromecast鎸夐挳': isChrome && !isIOS ? '鉁?鏄剧ず' : '鉂?闅愯棌',
+      '鎶曞睆绛栫暐': isIOS || isSafari ? '馃崕 AirPlay (WebKit)' : isChrome ? '馃摵 Chromecast (Cast API)' : '鉂?涓嶆敮鎸佹姇灞?
+    });
 
-          // 濡傛灉鏈夋鍦ㄨ繘琛岀殑鍒囨崲锛屽厛鍙栨秷
-          if (switchPromiseRef.current) {
-            console.log('鈴革笍 鍙栨秷鍓嶄竴涓垏鎹㈡搷浣滐紝寮€濮嬫柊鐨勫垏鎹?);
-            // ArtPlayer娌℃湁鎻愪緵鍙栨秷鏈哄埗锛屼絾鎴戜滑鍙互蹇界暐鏃х殑缁撴灉
-            switchPromiseRef.current = null;
-          }
+    // 馃殌 浼樺寲杩炵画鍒囨崲锛氶槻鎶栨満鍒?+ 璧勬簮绠＄悊
+    if (artPlayerRef.current && !loading) {
+      try {
+        // 娓呴櫎涔嬪墠鐨勫垏鎹㈠畾鏃跺櫒
+        if (sourceSwitchTimeoutRef.current) {
+          clearTimeout(sourceSwitchTimeoutRef.current);
+          sourceSwitchTimeoutRef.current = null;
+        }
 
-          // 淇濆瓨寮瑰箷鐘舵€?-          if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
-            danmuPluginStateRef.current = {
-              isHide: artPlayerRef.current.plugins.artplayerPluginDanmuku.isHide,
-              isStop: artPlayerRef.current.plugins.artplayerPluginDanmuku.isStop,
-              option: artPlayerRef.current.plugins.artplayerPluginDanmuku.option
-            };
-          }
+        // 濡傛灉鏈夋鍦ㄨ繘琛岀殑鍒囨崲锛屽厛鍙栨秷
+        if (switchPromiseRef.current) {
+          console.log('鈴革笍 鍙栨秷鍓嶄竴涓垏鎹㈡搷浣滐紝寮€濮嬫柊鐨勫垏鎹?);
+          // ArtPlayer娌℃湁鎻愪緵鍙栨秷鏈哄埗锛屼絾鎴戜滑鍙互蹇界暐鏃х殑缁撴灉
+          switchPromiseRef.current = null;
+        }
+
+        // 淇濆瓨寮瑰箷鐘舵€?+        if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
+          danmuPluginStateRef.current = {
+            isHide: artPlayerRef.current.plugins.artplayerPluginDanmuku.isHide,
+            isStop: artPlayerRef.current.plugins.artplayerPluginDanmuku.isStop,
+            option: artPlayerRef.current.plugins.artplayerPluginDanmuku.option
+          };
+        }
 
-          // 馃殌 鍏抽敭淇锛氬尯鍒嗘崲婧愬拰鍒囨崲闆嗘暟
-          const isEpisodeChange = isEpisodeChangingRef.current;
-          const currentTime = artPlayerRef.current.currentTime || 0;
+        // 馃殌 鍏抽敭淇锛氬尯鍒嗘崲婧愬拰鍒囨崲闆嗘暟
+        const isEpisodeChange = isEpisodeChangingRef.current;
+        const currentTime = artPlayerRef.current.currentTime || 0;
 
-          let switchPromise: Promise<any>;
-          if (isEpisodeChange) {
-            console.log(`馃幆 寮€濮嬪垏鎹㈤泦鏁? ${videoUrl} (閲嶇疆鎾斁鏃堕棿鍒?)`);
-            // 鍒囨崲闆嗘暟鏃堕噸缃挱鏀炬椂闂村埌0
-            switchPromise = artPlayerRef.current.switchUrl(videoUrl);
-          } else {
-            console.log(`馃幆 寮€濮嬪垏鎹㈡簮: ${videoUrl} (淇濇寔杩涘害: ${currentTime.toFixed(2)}s)`);
-            // 鎹㈡簮鏃朵繚鎸佹挱鏀捐繘搴?-            switchPromise = artPlayerRef.current.switchQuality(videoUrl);
-          }
+        let switchPromise: Promise<any>;
+        if (isEpisodeChange) {
+          console.log(`馃幆 寮€濮嬪垏鎹㈤泦鏁? ${videoUrl} (閲嶇疆鎾斁鏃堕棿鍒?)`);
+          // 鍒囨崲闆嗘暟鏃堕噸缃挱鏀炬椂闂村埌0
+          switchPromise = artPlayerRef.current.switchUrl(videoUrl);
+        } else {
+          console.log(`馃幆 寮€濮嬪垏鎹㈡簮: ${videoUrl} (淇濇寔杩涘害: ${currentTime.toFixed(2)}s)`);
+          // 鎹㈡簮鏃朵繚鎸佹挱鏀捐繘搴?+          switchPromise = artPlayerRef.current.switchQuality(videoUrl);
+        }
 
-          // 鍒涘缓鍒囨崲Promise
-          switchPromise = switchPromise.then(() => {
-            // 鍙湁褰撳墠Promise杩樻槸娲昏穬鐨勬墠鎵ц鍚庣画鎿嶄綔
-            if (switchPromiseRef.current === switchPromise) {
-              artPlayerRef.current.title = `${videoTitle} - 绗?{currentEpisodeIndex + 1}闆哷;
-              artPlayerRef.current.poster = videoCover;
-              console.log('鉁?婧愬垏鎹㈠畬鎴?);
-
-              // 馃敟 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑
-              if (isEpisodeChange) {
-                // 馃攽 鍏抽敭淇锛氬垏鎹㈤泦鏁板悗鏄惧紡閲嶇疆鎾斁鏃堕棿涓?0锛岀‘淇濈墖澶磋嚜鍔ㄨ烦杩囪兘瑙﹀彂
-                artPlayerRef.current.currentTime = 0;
-                console.log('馃幆 闆嗘暟鍒囨崲瀹屾垚锛岄噸缃挱鏀炬椂闂翠负 0');
-                isEpisodeChangingRef.current = false;
-              }
+        // 鍒涘缓鍒囨崲Promise
+        switchPromise = switchPromise.then(() => {
+          // 鍙湁褰撳墠Promise杩樻槸娲昏穬鐨勬墠鎵ц鍚庣画鎿嶄綔
+          if (switchPromiseRef.current === switchPromise) {
+            artPlayerRef.current.title = `${videoTitle} - 绗?{currentEpisodeIndex + 1}闆哷;
+            artPlayerRef.current.poster = videoCover;
+            console.log('鉁?婧愬垏鎹㈠畬鎴?);
+
+            // 馃敟 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑
+            if (isEpisodeChange) {
+              // 馃攽 鍏抽敭淇锛氬垏鎹㈤泦鏁板悗鏄惧紡閲嶇疆鎾斁鏃堕棿涓?0锛岀‘淇濈墖澶磋嚜鍔ㄨ烦杩囪兘瑙﹀彂
+              artPlayerRef.current.currentTime = 0;
+              console.log('馃幆 闆嗘暟鍒囨崲瀹屾垚锛岄噸缃挱鏀炬椂闂翠负 0');
+              isEpisodeChangingRef.current = false;
             }
-          }).catch((error: any) => {
-            if (switchPromiseRef.current === switchPromise) {
-              console.warn('鈿狅笍 婧愬垏鎹㈠け璐ワ紝灏嗛噸寤烘挱鏀惧櫒:', error);
-              // 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑
-              if (isEpisodeChange) {
-                isEpisodeChangingRef.current = false;
-              }
-              throw error; // 璁╁灞俢atch澶勭悊
+          }
+        }).catch((error: any) => {
+          if (switchPromiseRef.current === switchPromise) {
+            console.warn('鈿狅笍 婧愬垏鎹㈠け璐ワ紝灏嗛噸寤烘挱鏀惧櫒:', error);
+            // 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑
+            if (isEpisodeChange) {
+              isEpisodeChangingRef.current = false;
             }
-          });
-
-          switchPromiseRef.current = switchPromise;
-          await switchPromise;
-
-          if (artPlayerRef.current?.video) {
-            ensureVideoSource(
-              artPlayerRef.current.video as HTMLVideoElement,
-              videoUrl
-            );
+            throw error; // 璁╁灞俢atch澶勭悊
           }
+        });
 
-          // 馃殌 绉婚櫎鍘熸湁鐨?setTimeout 寮瑰箷鍔犺浇閫昏緫锛屼氦鐢?useEffect 缁熶竴浼樺寲澶勭悊
-
-          console.log('浣跨敤switch鏂规硶鎴愬姛鍒囨崲瑙嗛');
-          return;
-        } catch (error) {
-          console.warn('Switch鏂规硶澶辫触锛屽皢閲嶅缓鎾斁鍣?', error);
-          // 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑
-          isEpisodeChangingRef.current = false;
-          // 濡傛灉switch澶辫触锛屾竻鐞嗘挱鏀惧櫒骞堕噸鏂板垱寤?-          cleanupPlayer();
+        switchPromiseRef.current = switchPromise;
+        await switchPromise;
+        
+        if (artPlayerRef.current?.video) {
+          ensureVideoSource(
+            artPlayerRef.current.video as HTMLVideoElement,
+            videoUrl
+          );
         }
-      }
-      if (artPlayerRef.current) {
+        
+        // 馃殌 绉婚櫎鍘熸湁鐨?setTimeout 寮瑰箷鍔犺浇閫昏緫锛屼氦鐢?useEffect 缁熶竴浼樺寲澶勭悊
+        
+        console.log('浣跨敤switch鏂规硶鎴愬姛鍒囨崲瑙嗛');
+        return;
+      } catch (error) {
+        console.warn('Switch鏂规硶澶辫触锛屽皢閲嶅缓鎾斁鍣?', error);
+        // 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑
+        isEpisodeChangingRef.current = false;
+        // 濡傛灉switch澶辫触锛屾竻鐞嗘挱鏀惧櫒骞堕噸鏂板垱寤?         cleanupPlayer();
       }
+    }
+    if (artPlayerRef.current) {
+      cleanupPlayer();
+    }
 
-      // 纭繚 DOM 瀹瑰櫒瀹屽叏娓呯┖锛岄伩鍏嶅瀹炰緥鍐茬獊
-      if (artRef.current) {
-        artRef.current.innerHTML = '';
-      }
-
-      try {
-        // 浣跨敤鍔ㄦ€佸鍏ョ殑 Artplayer
-        const Artplayer = (window as any).DynamicArtplayer;
-        const artplayerPluginDanmuku = (window as any).DynamicArtplayerPluginDanmuku;
-
-        // 鍒涘缓鏂扮殑鎾斁鍣ㄥ疄渚?-        Artplayer.PLAYBACK_RATE = [0.5, 0.75, 1, 1.25, 1.5, 2, 3];
-        Artplayer.USE_RAF = false;
-        Artplayer.FULLSCREEN_WEB_IN_BODY = true;
-        // 閲嶆柊鍚敤5.3.0鍐呭瓨浼樺寲鍔熻兘锛屼絾浣跨敤false鍙傛暟閬垮厤娓呯┖DOM
-        Artplayer.REMOVE_SRC_WHEN_DESTROY = true;
-
-        artPlayerRef.current = new Artplayer({
-          container: artRef.current,
-          url: videoUrl,
-          poster: videoCover,
-          volume: 0.7,
-          isLive: false,
-          // iOS璁惧闇€瑕侀潤闊虫墠鑳借嚜鍔ㄦ挱鏀撅紝鍙傝€傾rtPlayer婧愮爜澶勭悊
-          muted: isIOS || isSafari,
-          autoplay: true,
-          pip: true,
-          autoSize: false,
-          autoMini: false,
-          screenshot: false,
-          setting: true,
-          loop: false,
-          flip: false,
-          playbackRate: true,
-          aspectRatio: false,
-          fullscreen: true,
-          fullscreenWeb: true,
-          subtitleOffset: false,
-          miniProgressBar: false,
-          mutex: true,
-          playsInline: true,
-          autoPlayback: false,
-          theme: '#22c55e',
-          lang: 'zh-cn',
-          hotkey: false,
-          fastForward: true,
-          autoOrientation: true,
-          lock: true,
-          // AirPlay 浠呭湪鏀寔 WebKit API 鐨勬祻瑙堝櫒涓惎鐢?-          // 涓昏鏄?Safari (妗岄潰鍜岀Щ鍔ㄧ) 鍜?iOS 涓婄殑鍏朵粬娴忚鍣?-          airplay: isIOS || isSafari,
-          moreVideoAttr: {
-            crossOrigin: 'anonymous',
-          },
-          // HLS 鏀寔閰嶇疆
-          customType: {
-            m3u8: function (video: HTMLVideoElement, url: string) {
-              if (!Hls) {
-                console.error('HLS.js 鏈姞杞?);
-                return;
-              }
+    // 纭繚 DOM 瀹瑰櫒瀹屽叏娓呯┖锛岄伩鍏嶅瀹炰緥鍐茬獊
+    if (artRef.current) {
+      artRef.current.innerHTML = '';
+    }
 
-              if (video.hls) {
-                video.hls.destroy();
-              }
+    try {
+      // 浣跨敤鍔ㄦ€佸鍏ョ殑 Artplayer
+      const Artplayer = (window as any).DynamicArtplayer;
+      const artplayerPluginDanmuku = (window as any).DynamicArtplayerPluginDanmuku;
+      
+      // 鍒涘缓鏂扮殑鎾斁鍣ㄥ疄渚?+      Artplayer.PLAYBACK_RATE = [0.5, 0.75, 1, 1.25, 1.5, 2, 3];
+      Artplayer.USE_RAF = false;
+      Artplayer.FULLSCREEN_WEB_IN_BODY = true;
+      // 閲嶆柊鍚敤5.3.0鍐呭瓨浼樺寲鍔熻兘锛屼絾浣跨敤false鍙傛暟閬垮厤娓呯┖DOM
+      Artplayer.REMOVE_SRC_WHEN_DESTROY = true;
+
+      artPlayerRef.current = new Artplayer({
+        container: artRef.current,
+        url: videoUrl,
+        poster: videoCover,
+        volume: 0.7,
+        isLive: false,
+        // iOS璁惧闇€瑕侀潤闊虫墠鑳借嚜鍔ㄦ挱鏀撅紝鍙傝€傾rtPlayer婧愮爜澶勭悊
+        muted: isIOS || isSafari,
+        autoplay: true,
+        pip: true,
+        autoSize: false,
+        autoMini: false,
+        screenshot: false,
+        setting: true,
+        loop: false,
+        flip: false,
+        playbackRate: true,
+        aspectRatio: false,
+        fullscreen: true,
+        fullscreenWeb: true,
+        subtitleOffset: false,
+        miniProgressBar: false,
+        mutex: true,
+        playsInline: true,
+        autoPlayback: false,
+        theme: '#22c55e',
+        lang: 'zh-cn',
+        hotkey: false,
+        fastForward: true,
+        autoOrientation: true,
+        lock: true,
+        // AirPlay 浠呭湪鏀寔 WebKit API 鐨勬祻瑙堝櫒涓惎鐢?+        // 涓昏鏄?Safari (妗岄潰鍜岀Щ鍔ㄧ) 鍜?iOS 涓婄殑鍏朵粬娴忚鍣?+        airplay: isIOS || isSafari,
+        moreVideoAttr: {
+          crossOrigin: 'anonymous',
+        },
+        // HLS 鏀寔閰嶇疆
+        customType: {
+          m3u8: function (video: HTMLVideoElement, url: string) {
+            if (!Hls) {
+              console.error('HLS.js 鏈姞杞?);
+              return;
+            }
 
-              // 鍦ㄥ嚱鏁板唴閮ㄩ噸鏂版娴媔OS13+璁惧
-              const localIsIOS13 = isIOS13;
-
-              // 馃殌 鏍规嵁 HLS.js 瀹樻柟婧愮爜鐨勬渶浣冲疄璺甸厤缃?-              const hls = new Hls({
-                debug: false,
-                enableWorker: true,
-                // 鍙傝€?HLS.js config.ts锛氱Щ鍔ㄨ澶囧叧闂綆寤惰繜妯″紡浠ヨ妭鐪佽祫婧?-                lowLatencyMode: !isMobile,
-
-                // 馃幆 瀹樻柟鎺ㄨ崘鐨勭紦鍐茬瓥鐣?- iOS13+ 鐗瑰埆浼樺寲
-                /* 缂撳啿闀垮害閰嶇疆 - 鍙傝€?hlsDefaultConfig */
-                maxBufferLength: isMobile
-                  ? (localIsIOS13 ? 8 : isIOS ? 10 : 15)  // iOS13+: 8s, iOS: 10s, Android: 15s
-                  : 30, // 妗岄潰榛樿30s
-                backBufferLength: isMobile
-                  ? (localIsIOS13 ? 5 : isIOS ? 8 : 10)   // iOS13+鏇翠繚瀹?-                  : Infinity, // 妗岄潰浣跨敤鏃犻檺鍥為€€缂撳啿
-
-                /* 缂撳啿澶у皬閰嶇疆 - 鍩轰簬瀹樻柟 maxBufferSize */
-                maxBufferSize: isMobile
-                  ? (localIsIOS13 ? 20 * 1000 * 1000 : isIOS ? 30 * 1000 * 1000 : 40 * 1000 * 1000) // iOS13+: 20MB, iOS: 30MB, Android: 40MB
-                  : 60 * 1000 * 1000, // 妗岄潰: 60MB (瀹樻柟榛樿)
-
-                /* 缃戠粶鍔犺浇浼樺寲 - 鍙傝€?defaultLoadPolicy */
-                maxLoadingDelay: isMobile ? (localIsIOS13 ? 2 : 3) : 4, // iOS13+璁惧鏇村揩瓒呮椂
-                maxBufferHole: isMobile ? (localIsIOS13 ? 0.05 : 0.1) : 0.1, // 鍑忓皯缂撳啿娲炲蹇嶅害
-
-                /* Fragment绠＄悊 - 鍙傝€冨畼鏂归厤缃?*/
-                liveDurationInfinity: false, // 閬垮厤鏃犻檺缂撳啿 (瀹樻柟榛樿false)
-                liveBackBufferLength: isMobile ? (localIsIOS13 ? 3 : 5) : null, // 宸插簾寮冿紝淇濇寔鍏煎
-
-                /* 楂樼骇浼樺寲閰嶇疆 - 鍙傝€?StreamControllerConfig */
-                maxMaxBufferLength: isMobile ? (localIsIOS13 ? 60 : 120) : 600, // 鏈€澶х紦鍐查暱搴﹂檺鍒?-                maxFragLookUpTolerance: isMobile ? 0.1 : 0.25, // 鐗囨鏌ユ壘瀹瑰繊搴?-
-                /* ABR浼樺寲 - 鍙傝€?ABRControllerConfig */
-                abrEwmaFastLive: isMobile ? 2 : 3, // 绉诲姩绔洿蹇殑鐮佺巼鍒囨崲
-                abrEwmaSlowLive: isMobile ? 6 : 9,
-                abrBandWidthFactor: isMobile ? 0.8 : 0.95, // 绉诲姩绔洿淇濆畧鐨勫甫瀹戒及璁?-
-                /* 鍚姩浼樺寲 */
-                startFragPrefetch: !isMobile, // 绉诲姩绔叧闂鍙栦互鑺傜渷璧勬簮
-                testBandwidth: !localIsIOS13, // iOS13+鍏抽棴甯﹀娴嬭瘯浠ュ揩閫熷惎鍔?-
-                /* Loader閰嶇疆 - 鍙傝€冨畼鏂?fragLoadPolicy */
-                fragLoadPolicy: {
-                  default: {
-                    maxTimeToFirstByteMs: isMobile ? 6000 : 10000,
-                    maxLoadTimeMs: isMobile ? 60000 : 120000,
-                    timeoutRetry: {
-                      maxNumRetry: isMobile ? 2 : 4,
-                      retryDelayMs: 0,
-                      maxRetryDelayMs: 0,
-                    },
-                    errorRetry: {
-                      maxNumRetry: isMobile ? 3 : 6,
-                      retryDelayMs: 1000,
-                      maxRetryDelayMs: isMobile ? 4000 : 8000,
-                    },
+            if (video.hls) {
+              video.hls.destroy();
+            }
+            
+            // 鍦ㄥ嚱鏁板唴閮ㄩ噸鏂版娴媔OS13+璁惧
+            const localIsIOS13 = isIOS13;
+            
+            // 馃殌 鏍规嵁 HLS.js 瀹樻柟婧愮爜鐨勬渶浣冲疄璺甸厤缃?+            const hls = new Hls({
+              debug: false,
+              enableWorker: true,
+              // 鍙傝€?HLS.js config.ts锛氱Щ鍔ㄨ澶囧叧闂綆寤惰繜妯″紡浠ヨ妭鐪佽祫婧?+              lowLatencyMode: !isMobile,
+              
+              // 馃幆 瀹樻柟鎺ㄨ崘鐨勭紦鍐茬瓥鐣?- iOS13+ 鐗瑰埆浼樺寲
+              /* 缂撳啿闀垮害閰嶇疆 - 鍙傝€?hlsDefaultConfig */
+              maxBufferLength: isMobile 
+                ? (localIsIOS13 ? 8 : isIOS ? 10 : 15)  // iOS13+: 8s, iOS: 10s, Android: 15s
+                : 30, // 妗岄潰榛樿30s
+              backBufferLength: isMobile 
+                ? (localIsIOS13 ? 5 : isIOS ? 8 : 10)   // iOS13+鏇翠繚瀹?+                : Infinity, // 妗岄潰浣跨敤鏃犻檺鍥為€€缂撳啿
+
+              /* 缂撳啿澶у皬閰嶇疆 - 鍩轰簬瀹樻柟 maxBufferSize */
+              maxBufferSize: isMobile 
+                ? (localIsIOS13 ? 20 * 1000 * 1000 : isIOS ? 30 * 1000 * 1000 : 40 * 1000 * 1000) // iOS13+: 20MB, iOS: 30MB, Android: 40MB
+                : 60 * 1000 * 1000, // 妗岄潰: 60MB (瀹樻柟榛樿)
+
+              /* 缃戠粶鍔犺浇浼樺寲 - 鍙傝€?defaultLoadPolicy */
+              maxLoadingDelay: isMobile ? (localIsIOS13 ? 2 : 3) : 4, // iOS13+璁惧鏇村揩瓒呮椂
+              maxBufferHole: isMobile ? (localIsIOS13 ? 0.05 : 0.1) : 0.1, // 鍑忓皯缂撳啿娲炲蹇嶅害
+              
+              /* Fragment绠＄悊 - 鍙傝€冨畼鏂归厤缃?*/
+              liveDurationInfinity: false, // 閬垮厤鏃犻檺缂撳啿 (瀹樻柟榛樿false)
+              liveBackBufferLength: isMobile ? (localIsIOS13 ? 3 : 5) : null, // 宸插簾寮冿紝淇濇寔鍏煎
+
+              /* 楂樼骇浼樺寲閰嶇疆 - 鍙傝€?StreamControllerConfig */
+              maxMaxBufferLength: isMobile ? (localIsIOS13 ? 60 : 120) : 600, // 鏈€澶х紦鍐查暱搴﹂檺鍒?+              maxFragLookUpTolerance: isMobile ? 0.1 : 0.25, // 鐗囨鏌ユ壘瀹瑰繊搴?+              
+              /* ABR浼樺寲 - 鍙傝€?ABRControllerConfig */
+              abrEwmaFastLive: isMobile ? 2 : 3, // 绉诲姩绔洿蹇殑鐮佺巼鍒囨崲
+              abrEwmaSlowLive: isMobile ? 6 : 9,
+              abrBandWidthFactor: isMobile ? 0.8 : 0.95, // 绉诲姩绔洿淇濆畧鐨勫甫瀹戒及璁?+              
+              /* 鍚姩浼樺寲 */
+              startFragPrefetch: !isMobile, // 绉诲姩绔叧闂鍙栦互鑺傜渷璧勬簮
+              testBandwidth: !localIsIOS13, // iOS13+鍏抽棴甯﹀娴嬭瘯浠ュ揩閫熷惎鍔?+              
+              /* Loader閰嶇疆 - 鍙傝€冨畼鏂?fragLoadPolicy */
+              fragLoadPolicy: {
+                default: {
+                  maxTimeToFirstByteMs: isMobile ? 6000 : 10000,
+                  maxLoadTimeMs: isMobile ? 60000 : 120000,
+                  timeoutRetry: {
+                    maxNumRetry: isMobile ? 2 : 4,
+                    retryDelayMs: 0,
+                    maxRetryDelayMs: 0,
+                  },
+                  errorRetry: {
+                    maxNumRetry: isMobile ? 3 : 6,
+                    retryDelayMs: 1000,
+                    maxRetryDelayMs: isMobile ? 4000 : 8000,
                   },
                 },
+              },
 
-                /* 鑷畾涔塴oader */
-                loader: blockAdEnabledRef.current
-                  ? CustomHlsJsLoader
-                  : Hls.DefaultConfig.loader,
-              });
+              /* 鑷畾涔塴oader */
+              loader: blockAdEnabledRef.current
+                ? CustomHlsJsLoader
+                : Hls.DefaultConfig.loader,
+            });
 
-              hls.loadSource(url);
-              hls.attachMedia(video);
-              video.hls = hls;
+            hls.loadSource(url);
+            hls.attachMedia(video);
+            video.hls = hls;
 
-              ensureVideoSource(video, url);
+            ensureVideoSource(video, url);
 
-              hls.on(Hls.Events.ERROR, function (event: any, data: any) {
-                console.error('HLS Error:', event, data);
+            hls.on(Hls.Events.ERROR, function (event: any, data: any) {
+              console.error('HLS Error:', event, data);
 
-                // v1.6.13 澧炲己锛氬鐞嗙墖娈佃В鏋愰敊璇紙閽堝initPTS淇锛?-                if (data.details === Hls.ErrorDetails.FRAG_PARSING_ERROR) {
-                  console.log('鐗囨瑙ｆ瀽閿欒锛屽皾璇曢噸鏂板姞杞?..');
-                  // 閲嶆柊寮€濮嬪姞杞斤紝鍒╃敤v1.6.13鐨刬nitPTS淇
-                  hls.startLoad();
-                  return;
-                }
+              // v1.6.13 澧炲己锛氬鐞嗙墖娈佃В鏋愰敊璇紙閽堝initPTS淇锛?+              if (data.details === Hls.ErrorDetails.FRAG_PARSING_ERROR) {
+                console.log('鐗囨瑙ｆ瀽閿欒锛屽皾璇曢噸鏂板姞杞?..');
+                // 閲嶆柊寮€濮嬪姞杞斤紝鍒╃敤v1.6.13鐨刬nitPTS淇
+                hls.startLoad();
+                return;
+              }
 
-                // v1.6.13 澧炲己锛氬鐞嗘椂闂存埑鐩稿叧閿欒锛堢洿鎾洖鎼滀慨澶嶏級
-                if (data.details === Hls.ErrorDetails.BUFFER_APPEND_ERROR &&
+              // v1.6.13 澧炲己锛氬鐞嗘椂闂存埑鐩稿叧閿欒锛堢洿鎾洖鎼滀慨澶嶏級
+              if (data.details === Hls.ErrorDetails.BUFFER_APPEND_ERROR &&
                   data.err && data.err.message &&
                   data.err.message.includes('timestamp')) {
-                  console.log('鏃堕棿鎴抽敊璇紝娓呯悊缂撳啿鍖哄苟閲嶆柊鍔犺浇...');
-                  try {
-                    // 娓呯悊缂撳啿鍖哄悗閲嶆柊寮€濮嬶紝鍒╃敤v1.6.13鐨勬椂闂存埑鍖呰淇
-                    const currentTime = video.currentTime;
-                    hls.trigger(Hls.Events.BUFFER_RESET, undefined);
-                    hls.startLoad(currentTime);
-                  } catch (e) {
-                    console.warn('缂撳啿鍖洪噸缃け璐?', e);
-                    hls.startLoad();
-                  }
-                  return;
+                console.log('鏃堕棿鎴抽敊璇紝娓呯悊缂撳啿鍖哄苟閲嶆柊鍔犺浇...');
+                try {
+                  // 娓呯悊缂撳啿鍖哄悗閲嶆柊寮€濮嬶紝鍒╃敤v1.6.13鐨勬椂闂存埑鍖呰淇
+                  const currentTime = video.currentTime;
+                  hls.trigger(Hls.Events.BUFFER_RESET, undefined);
+                  hls.startLoad(currentTime);
+                } catch (e) {
+                  console.warn('缂撳啿鍖洪噸缃け璐?', e);
+                  hls.startLoad();
                 }
+                return;
+              }
 
-                if (data.fatal) {
-                  switch (data.type) {
-                    case Hls.ErrorTypes.NETWORK_ERROR:
-                      console.log('缃戠粶閿欒锛屽皾璇曟仮澶?..');
-                      hls.startLoad();
-                      break;
-                    case Hls.ErrorTypes.MEDIA_ERROR:
-                      console.log('濯掍綋閿欒锛屽皾璇曟仮澶?..');
-                      hls.recoverMediaError();
-                      break;
-                    default:
-                      console.log('鏃犳硶鎭㈠鐨勯敊璇?);
-                      hls.destroy();
-                      break;
-                  }
+              if (data.fatal) {
+                switch (data.type) {
+                  case Hls.ErrorTypes.NETWORK_ERROR:
+                    console.log('缃戠粶閿欒锛屽皾璇曟仮澶?..');
+                    hls.startLoad();
+                    break;
+                  case Hls.ErrorTypes.MEDIA_ERROR:
+                    console.log('濯掍綋閿欒锛屽皾璇曟仮澶?..');
+                    hls.recoverMediaError();
+                    break;
+                  default:
+                    console.log('鏃犳硶鎭㈠鐨勯敊璇?);
+                    hls.destroy();
+                    break;
                 }
-              });
-            },
-          },
-          icons: {
-            loading:
-              '<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDUwIDUwIj48cGF0aCBkPSJNMjUuMjUxIDYuNDYxYy0xMC4zMTggMC0xOC42ODMgOC4zNjUtMTguNjgzIDE4LjY4M2g0LjA2OGMwLTguMDcgNi41NDUtMTQuNjE1IDE0LjYxNS0xNC42MTVWNi40NjF6IiBmaWxsPSIjMDA5Njg4Ij48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIGF0dHJpYnV0ZVR5cGU9IlhNTCIgZHVyPSIxcyIgZnJvbT0iMCAyNSAyNSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHRvPSIzNjAgMjUgMjUiIHR5cGU9InJvdGF0ZSIvPjwvcGF0aD48L3N2Zz4=">',
+              }
+            });
           },
-          settings: [
-            {
-              html: '鍘诲箍鍛?,
-              icon: '<text x="50%" y="50%" font-size="20" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#ffffff">AD</text>',
-              tooltip: blockAdEnabled ? '宸插紑鍚? : '宸插叧闂?,
-              onClick() {
-                const newVal = !blockAdEnabled;
-                try {
-                  localStorage.setItem('enable_blockad', String(newVal));
-                  if (artPlayerRef.current) {
-                    resumeTimeRef.current = artPlayerRef.current.currentTime;
-                    if (artPlayerRef.current.video.hls) {
-                      artPlayerRef.current.video.hls.destroy();
-                    }
-                    artPlayerRef.current.destroy(false);
-                    artPlayerRef.current = null;
+        },
+        icons: {
+          loading:
+            '<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDUwIDUwIj48cGF0aCBkPSJNMjUuMjUxIDYuNDYxYy0xMC4zMTggMC0xOC42ODMgOC4zNjUtMTguNjgzIDE4LjY4M2g0LjA2OGMwLTguMDcgNi41NDUtMTQuNjE1IDE0LjYxNS0xNC42MTVWNi40NjF6IiBmaWxsPSIjMDA5Njg4Ij48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIGF0dHJpYnV0ZVR5cGU9IlhNTCIgZHVyPSIxcyIgZnJvbT0iMCAyNSAyNSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHRvPSIzNjAgMjUgMjUiIHR5cGU9InJvdGF0ZSIvPjwvcGF0aD48L3N2Zz4=">',
+        },
+        settings: [
+          {
+            html: '鍘诲箍鍛?,
+            icon: '<text x="50%" y="50%" font-size="20" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#ffffff">AD</text>',
+            tooltip: blockAdEnabled ? '宸插紑鍚? : '宸插叧闂?,
+            onClick() {
+              const newVal = !blockAdEnabled;
+              try {
+                localStorage.setItem('enable_blockad', String(newVal));
+                if (artPlayerRef.current) {
+                  resumeTimeRef.current = artPlayerRef.current.currentTime;
+                  if (artPlayerRef.current.video.hls) {
+                    artPlayerRef.current.video.hls.destroy();
                   }
-                  setBlockAdEnabled(newVal);
-                } catch (_) {
-                  // ignore
+                  artPlayerRef.current.destroy(false);
+                  artPlayerRef.current = null;
                 }
-                return newVal ? '褰撳墠寮€鍚? : '褰撳墠鍏抽棴';
-              },
-            },
-            {
-              name: '澶栭儴寮瑰箷',
-              html: '澶栭儴寮瑰箷',
-              icon: '<text x="50%" y="50%" font-size="14" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#ffffff">澶?/text>',
-              tooltip: externalDanmuEnabled ? '澶栭儴寮瑰箷宸插紑鍚? : '澶栭儴寮瑰箷宸插叧闂?,
-              switch: externalDanmuEnabled,
-              onSwitch: function (item: any) {
-                const nextState = !item.switch;
-
-                // 馃殌 浣跨敤浼樺寲鍚庣殑寮瑰箷鎿嶄綔澶勭悊鍑芥暟
-                handleDanmuOperationOptimized(nextState);
-
-                // 鏇存柊tooltip鏄剧ず
-                item.tooltip = nextState ? '澶栭儴寮瑰箷宸插紑鍚? : '澶栭儴寮瑰箷宸插叧闂?;
-
-                return nextState; // 绔嬪嵆杩斿洖鏂扮姸鎬?-              },
+                setBlockAdEnabled(newVal);
+              } catch (_) {
+                // ignore
+              }
+              return newVal ? '褰撳墠寮€鍚? : '褰撳墠鍏抽棴';
             },
-            {
-              html: '璺宠繃璁剧疆',
-              icon: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/></svg>',
-              tooltip: '璁剧疆鐗囧ご鐗囧熬璺宠繃',
-              onClick() {
-                setIsSkipSettingOpen(true);
-                return '鎵撳紑璺宠繃璁剧疆闈㈡澘';
-              },
+          },
+          {
+            name: '澶栭儴寮瑰箷',
+            html: '澶栭儴寮瑰箷',
+            icon: '<text x="50%" y="50%" font-size="14" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#ffffff">澶?/text>',
+            tooltip: externalDanmuEnabled ? '澶栭儴寮瑰箷宸插紑鍚? : '澶栭儴寮瑰箷宸插叧闂?,
+            switch: externalDanmuEnabled,
+            onSwitch: function (item: any) {
+              const nextState = !item.switch;
+              
+              // 馃殌 浣跨敤浼樺寲鍚庣殑寮瑰箷鎿嶄綔澶勭悊鍑芥暟
+              handleDanmuOperationOptimized(nextState);
+              
+              // 鏇存柊tooltip鏄剧ず
+              item.tooltip = nextState ? '澶栭儴寮瑰箷宸插紑鍚? : '澶栭儴寮瑰箷宸插叧闂?;
+              
+              return nextState; // 绔嬪嵆杩斿洖鏂扮姸鎬?             },
-          ],
-          // 鎺у埗鏍忛厤缃?-          controls: [
-            {
-              position: 'left',
-              index: 13,
-              html: '<i class="art-icon flex"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" fill="currentColor"/></svg></i>',
-              tooltip: '鎾斁涓嬩竴闆?,
-              click: function () {
-                handleNextEpisode();
-              },
+          },
+        ],
+        // 鎺у埗鏍忛厤缃?+        controls: [
+          {
+            position: 'left',
+            index: 13,
+            html: '<i class="art-icon flex"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" fill="currentColor"/></svg></i>',
+            tooltip: '鎾斁涓嬩竴闆?,
+            click: function () {
+              handleNextEpisode();
             },
-            // 馃殌 绠€鍗曞脊骞曞彂閫佹寜閽紙浠匴eb绔樉绀猴級
-            ...(isMobile ? [] : [{
-              position: 'right',
-              index: 10,
-              html: '寮?,
-              tooltip: '鍙戦€佸脊骞?,
-              click: function () {
-                if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
-                  // 鎵嬪姩寮瑰嚭杈撳叆妗嗗彂閫佸脊骞?-                  const text = prompt('璇疯緭鍏ュ脊骞曞唴瀹?, '');
-                  if (text && text.trim()) {
-                    artPlayerRef.current.plugins.artplayerPluginDanmuku.emit({
-                      text: text.trim(),
-                      time: artPlayerRef.current.currentTime,
-                      color: '#FFFFFF',
-                      mode: 0,
-                    });
-                  }
+          },
+          // 馃殌 绠€鍗曞脊骞曞彂閫佹寜閽紙浠匴eb绔樉绀猴級
+          ...(isMobile ? [] : [{
+            position: 'right',
+            html: '寮?,
+            tooltip: '鍙戦€佸脊骞?,
+            click: function () {
+              if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
+                // 鎵嬪姩寮瑰嚭杈撳叆妗嗗彂閫佸脊骞?+                const text = prompt('璇疯緭鍏ュ脊骞曞唴瀹?, '');
+                if (text && text.trim()) {
+                  artPlayerRef.current.plugins.artplayerPluginDanmuku.emit({
+                    text: text.trim(),
+                    time: artPlayerRef.current.currentTime,
+                    color: '#FFFFFF',
+                    mode: 0,
+                  });
                 }
-              },
-            }]),
-            // 馃殌 閫夐泦鑿滃崟鎸夐挳锛堜粎鍦ㄥ叏灞?缃戦〉鍏ㄥ睆/闅愯棌閫夐泦闈㈡澘鏃舵樉绀猴級
-            {
-              name: 'episodeSelector',
-              position: 'right',
-              index: 12,
-              html: '<i class="art-icon episode-selector-btn"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></i>',
-              tooltip: '閫夐泦鎹㈡簮',
-              style: { display: 'none' }, // 榛樿闅愯棌
-              click: function () {
-                setShowEpisodePopup(!showEpisodePopup);
-              },
-            },
-          ],
-          // 馃殌 鎬ц兘浼樺寲鐨勫脊骞曟彃浠堕厤缃?- 淇濇寔寮瑰箷鏁伴噺锛屼紭鍖栨覆鏌撴€ц兘
-          plugins: [
-            artplayerPluginDanmuku((() => {
-              // 馃幆 璁惧鎬ц兘妫€娴?-              const getDevicePerformance = () => {
-                const hardwareConcurrency = navigator.hardwareConcurrency || 2
-                const memory = (performance as any).memory?.jsHeapSizeLimit || 0
-
-                // 绠€鍗曟€ц兘璇勫垎锛?-1锛?-                let score = 0
-                score += Math.min(hardwareConcurrency / 4, 1) * 0.5 // CPU鏍稿績鏁版潈閲?-                score += Math.min(memory / (1024 * 1024 * 1024), 1) * 0.3 // 鍐呭瓨鏉冮噸
-                score += (isMobile ? 0.2 : 0.5) * 0.2 // 璁惧绫诲瀷鏉冮噸
-
-                if (score > 0.7) return 'high'
-                if (score > 0.4) return 'medium'
-                return 'low'
               }
+            },
+          }]),
+        ],
+        // 馃殌 鎬ц兘浼樺寲鐨勫脊骞曟彃浠堕厤缃?- 淇濇寔寮瑰箷鏁伴噺锛屼紭鍖栨覆鏌撴€ц兘
+        plugins: [
+          artplayerPluginDanmuku((() => {
+            // 馃幆 璁惧鎬ц兘妫€娴?+            const getDevicePerformance = () => {
+              const hardwareConcurrency = navigator.hardwareConcurrency || 2
+              const memory = (performance as any).memory?.jsHeapSizeLimit || 0
+              
+              // 绠€鍗曟€ц兘璇勫垎锛?-1锛?+              let score = 0
+              score += Math.min(hardwareConcurrency / 4, 1) * 0.5 // CPU鏍稿績鏁版潈閲?+              score += Math.min(memory / (1024 * 1024 * 1024), 1) * 0.3 // 鍐呭瓨鏉冮噸
+              score += (isMobile ? 0.2 : 0.5) * 0.2 // 璁惧绫诲瀷鏉冮噸
+              
+              if (score > 0.7) return 'high'
+              if (score > 0.4) return 'medium' 
+              return 'low'
+            }
+            
+            const devicePerformance = getDevicePerformance()
+            console.log(`馃幆 璁惧鎬ц兘绛夌骇: ${devicePerformance}`)
+            
+            // 馃殌 婵€杩涙€ц兘浼樺寲锛氶拡瀵瑰ぇ閲忓脊骞曠殑娓叉煋绛栫暐
+            const getOptimizedConfig = () => {
+              const baseConfig = {
+                danmuku: [], // 鍒濆涓虹┖鏁扮粍锛屽悗缁€氳繃load鏂规硶鍔犺浇
+                speed: parseInt(localStorage.getItem('danmaku_speed') || '6'),
+                opacity: parseFloat(localStorage.getItem('danmaku_opacity') || '0.8'),
+                fontSize: parseInt(localStorage.getItem('danmaku_fontSize') || '25'),
+                color: '#FFFFFF',
+                mode: 0 as const,
+                modes: JSON.parse(localStorage.getItem('danmaku_modes') || '[0, 1, 2]') as Array<0 | 1 | 2>,
+                margin: JSON.parse(localStorage.getItem('danmaku_margin') || '[10, "75%"]') as [number | `${number}%`, number | `${number}%`],
+                visible: localStorage.getItem('danmaku_visible') !== 'false',
+                emitter: false,
+                maxLength: 50,
+                lockTime: 1, // 馃幆 杩涗竴姝ュ噺灏戦攣瀹氭椂闂达紝鎻愬崌杩涘害璺宠浆鍝嶅簲
+                theme: 'dark' as const,
+                width: 300,
+
+                // 馃幆 婵€杩涗紭鍖栭厤缃?- 淇濇寔鍔熻兘瀹屾暣鎬?+                antiOverlap: devicePerformance === 'high', // 鍙湁楂樻€ц兘璁惧寮€鍚槻閲嶅彔锛岄伩鍏嶉噸鍙犺绠?+                synchronousPlayback: true, // 鉁?蹇呴』淇濇寔true锛佺‘淇濆脊骞曚笌瑙嗛鎾斁閫熷害鍚屾
+                heatmap: false, // 鍏抽棴鐑姏鍥撅紝鍑忓皯DOM璁＄畻寮€閿€
+                
+                // 馃 鏅鸿兘杩囨护鍣?- 婵€杩涙€ц兘浼樺寲锛岃繃婊ゅ奖鍝嶆€ц兘鐨勫脊骞?+                filter: (danmu: any) => {
+                  // 鍩虹楠岃瘉
+                  if (!danmu.text || !danmu.text.trim()) return false
+
+                  const text = danmu.text.trim();
+
+                  // 馃敟 婵€杩涢暱搴﹂檺鍒讹紝鍑忓皯DOM娓叉煋璐熸媴
+                  if (text.length > 50) return false // 浠?00鏀逛负50锛屾洿婵€杩?+                  if (text.length < 2) return false  // 杩囩煭寮瑰箷閫氬父鏃犳剰涔?+
+                  // 馃敟 婵€杩涚壒娈婂瓧绗﹁繃婊わ紝閬垮厤澶嶆潅娓叉煋
+                  const specialCharCount = (text.match(/[^\u4e00-\u9fa5a-zA-Z0-9\s.,!?锛涳紝銆傦紒锛焆/g) || []).length
+                  if (specialCharCount > 5) return false // 浠?0鏀逛负5锛屾洿涓ユ牸
+
+                  // 馃敟 杩囨护绾暟瀛楁垨绾鍙峰脊骞曪紝鍑忓皯鏃犳剰涔夋覆鏌?+                  if (/^\d+$/.test(text)) return false
+                  if (/^[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(text)) return false
+
+                  // 馃敟 杩囨护甯歌浣庤川閲忓脊骞曪紝鎻愬崌鏁翠綋璐ㄩ噺
+                  const lowQualityPatterns = [
+                    /^666+$/, /^濂?$/, /^鍝?$/, /^鍟?$/,
+                    /^[!锛?銆傦紵?]+$/, /^鐗?$/, /^寮?$/
+                  ];
+                  if (lowQualityPatterns.some(pattern => pattern.test(text))) return false
+
+                  return true
+                },
+                
+                // 馃殌 浼樺寲鐨勫脊骞曟樉绀哄墠妫€鏌ワ紙鎹㈡簮鏃舵€ц兘浼樺寲锛?+                beforeVisible: (danmu: any) => {
+                  return new Promise<boolean>((resolve) => {
+                    // 鎹㈡簮鏈熼棿蹇€熸嫆缁濆脊骞曟樉绀猴紝鍑忓皯澶勭悊寮€閿€
+                    if (isSourceChangingRef.current) {
+                      resolve(false);
+                      return;
+                    }
 
-              const devicePerformance = getDevicePerformance()
-              console.log(`馃幆 璁惧鎬ц兘绛夌骇: ${devicePerformance}`)
-
-              // 馃殌 婵€杩涙€ц兘浼樺寲锛氶拡瀵瑰ぇ閲忓脊骞曠殑娓叉煋绛栫暐
-              const getOptimizedConfig = () => {
-                const baseConfig = {
-                  danmuku: [], // 鍒濆涓虹┖鏁扮粍锛屽悗缁€氳繃load鏂规硶鍔犺浇
-                  speed: parseInt(localStorage.getItem('danmaku_speed') || '6'),
-                  opacity: parseFloat(localStorage.getItem('danmaku_opacity') || '0.8'),
-                  fontSize: parseInt(localStorage.getItem('danmaku_fontSize') || '25'),
-                  color: '#FFFFFF',
-                  mode: 0 as const,
-                  modes: JSON.parse(localStorage.getItem('danmaku_modes') || '[0, 1, 2]') as Array<0 | 1 | 2>,
-                  margin: JSON.parse(localStorage.getItem('danmaku_margin') || '[10, "75%"]') as [number | `${number}%`, number | `${number}%`],
-                  visible: localStorage.getItem('danmaku_visible') !== 'false',
-                  emitter: false,
-                  maxLength: 50,
-                  lockTime: 1, // 馃幆 杩涗竴姝ュ噺灏戦攣瀹氭椂闂达紝鎻愬崌杩涘害璺宠浆鍝嶅簲
-                  theme: 'dark' as const,
-                  width: 300,
-
-                  // 馃幆 婵€杩涗紭鍖栭厤缃?- 淇濇寔鍔熻兘瀹屾暣鎬?-                  antiOverlap: devicePerformance === 'high', // 鍙湁楂樻€ц兘璁惧寮€鍚槻閲嶅彔锛岄伩鍏嶉噸鍙犺绠?-                  synchronousPlayback: true, // 鉁?蹇呴』淇濇寔true锛佺‘淇濆脊骞曚笌瑙嗛鎾斁閫熷害鍚屾
-                  heatmap: false, // 鍏抽棴鐑姏鍥撅紝鍑忓皯DOM璁＄畻寮€閿€
-
-                  // 馃 鏅鸿兘杩囨护鍣?- 婵€杩涙€ц兘浼樺寲锛岃繃婊ゅ奖鍝嶆€ц兘鐨勫脊骞?-                  filter: (danmu: any) => {
-                    // 鍩虹楠岃瘉
-                    if (!danmu.text || !danmu.text.trim()) return false
-
-                    const text = danmu.text.trim();
-
-                    // 馃敟 婵€杩涢暱搴﹂檺鍒讹紝鍑忓皯DOM娓叉煋璐熸媴
-                    if (text.length > 50) return false // 浠?00鏀逛负50锛屾洿婵€杩?-                    if (text.length < 2) return false  // 杩囩煭寮瑰箷閫氬父鏃犳剰涔?-
-                    // 馃敟 婵€杩涚壒娈婂瓧绗﹁繃婊わ紝閬垮厤澶嶆潅娓叉煋
-                    const specialCharCount = (text.match(/[^\u4e00-\u9fa5a-zA-Z0-9\s.,!?锛涳紝銆傦紒锛焆/g) || []).length
-                    if (specialCharCount > 5) return false // 浠?0鏀逛负5锛屾洿涓ユ牸
-
-                    // 馃敟 杩囨护绾暟瀛楁垨绾鍙峰脊骞曪紝鍑忓皯鏃犳剰涔夋覆鏌?-                    if (/^\d+$/.test(text)) return false
-                    if (/^[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]+$/.test(text)) return false
-
-                    // 馃敟 杩囨护甯歌浣庤川閲忓脊骞曪紝鎻愬崌鏁翠綋璐ㄩ噺
-                    const lowQualityPatterns = [
-                      /^666+$/, /^濂?$/, /^鍝?$/, /^鍟?$/,
-                      /^[!锛?銆傦紵?]+$/, /^鐗?$/, /^寮?$/
-                    ];
-                    if (lowQualityPatterns.some(pattern => pattern.test(text))) return false
-
-                    return true
-                  },
-
-                  // 馃殌 浼樺寲鐨勫脊骞曟樉绀哄墠妫€鏌ワ紙鎹㈡簮鏃舵€ц兘浼樺寲锛?-                  beforeVisible: (danmu: any) => {
-                    return new Promise<boolean>((resolve) => {
-                      // 鎹㈡簮鏈熼棿蹇€熸嫆缁濆脊骞曟樉绀猴紝鍑忓皯澶勭悊寮€閿€
-                      if (isSourceChangingRef.current) {
-                        resolve(false);
+                    // 馃幆 鍔ㄦ€佸脊骞曞瘑搴︽帶鍒?- 鏍规嵁褰撳墠灞忓箷涓婄殑寮瑰箷鏁伴噺鍐冲畾鏄惁鏄剧ず
+                    const currentVisibleCount = document.querySelectorAll('.art-danmuku [data-state="emit"]').length;
+                    const maxConcurrentDanmu = devicePerformance === 'high' ? 60 :
+                                             devicePerformance === 'medium' ? 40 : 25;
+
+                    if (currentVisibleCount >= maxConcurrentDanmu) {
+                      // 馃敟 褰撳脊骞曞瘑搴﹁繃楂樻椂锛岄殢鏈轰涪寮冮儴鍒嗗脊骞曪紝淇濇寔娴佺晠鎬?+                      const dropRate = devicePerformance === 'high' ? 0.1 :
+                                      devicePerformance === 'medium' ? 0.3 : 0.5;
+                      if (Math.random() < dropRate) {
+                        resolve(false); // 涓㈠純褰撳墠寮瑰箷
                         return;
                       }
+                    }
 
-                      // 馃幆 鍔ㄦ€佸脊骞曞瘑搴︽帶鍒?- 鏍规嵁褰撳墠灞忓箷涓婄殑寮瑰箷鏁伴噺鍐冲畾鏄惁鏄剧ず
-                      const currentVisibleCount = document.querySelectorAll('.art-danmuku [data-state="emit"]').length;
-                      const maxConcurrentDanmu = devicePerformance === 'high' ? 60 :
-                        devicePerformance === 'medium' ? 40 : 25;
-
-                      if (currentVisibleCount >= maxConcurrentDanmu) {
-                        // 馃敟 褰撳脊骞曞瘑搴﹁繃楂樻椂锛岄殢鏈轰涪寮冮儴鍒嗗脊骞曪紝淇濇寔娴佺晠鎬?-                        const dropRate = devicePerformance === 'high' ? 0.1 :
-                          devicePerformance === 'medium' ? 0.3 : 0.5;
-                        if (Math.random() < dropRate) {
-                          resolve(false); // 涓㈠純褰撳墠寮瑰箷
-                          return;
-                        }
-                      }
-
-                      // 馃幆 纭欢鍔犻€熶紭鍖?-                      if (danmu.$ref && danmu.mode === 0) {
-                        danmu.$ref.style.willChange = 'transform';
-                        danmu.$ref.style.backfaceVisibility = 'hidden';
+                    // 馃幆 纭欢鍔犻€熶紭鍖?+                    if (danmu.$ref && danmu.mode === 0) {
+                      danmu.$ref.style.willChange = 'transform';
+                      danmu.$ref.style.backfaceVisibility = 'hidden';
 
-                        // 浣庢€ц兘璁惧棰濆浼樺寲
-                        if (devicePerformance === 'low') {
-                          danmu.$ref.style.transform = 'translateZ(0)'; // 寮哄埗纭欢鍔犻€?-                          danmu.$ref.classList.add('art-danmuku-optimized');
-                        }
+                      // 浣庢€ц兘璁惧棰濆浼樺寲
+                      if (devicePerformance === 'low') {
+                        danmu.$ref.style.transform = 'translateZ(0)'; // 寮哄埗纭欢鍔犻€?+                        danmu.$ref.classList.add('art-danmuku-optimized');
                       }
-
-                      resolve(true);
-                    });
-                  },
-                }
-
-                // 鏍规嵁璁惧鎬ц兘璋冩暣鏍稿績閰嶇疆
-                switch (devicePerformance) {
-                  case 'high': // 楂樻€ц兘璁惧 - 瀹屾暣鍔熻兘
-                    return {
-                      ...baseConfig,
-                      antiOverlap: true, // 寮€鍚槻閲嶅彔
-                      synchronousPlayback: true, // 淇濇寔寮瑰箷涓庤棰戞挱鏀鹃€熷害鍚屾
-                      useWorker: true, // v5.2.0: 鍚敤Web Worker浼樺寲
-                    }
-
-                  case 'medium': // 涓瓑鎬ц兘璁惧 - 閫傚害浼樺寲
-                    return {
-                      ...baseConfig,
-                      antiOverlap: !isMobile, // 绉诲姩绔叧闂槻閲嶅彔
-                      synchronousPlayback: true, // 淇濇寔鍚屾鎾斁浠ョ‘淇濅綋楠屼竴鑷?-                      useWorker: true, // v5.2.0: 涓瓑璁惧涔熷惎鐢╓orker
                     }
 
-                  case 'low': // 浣庢€ц兘璁惧 - 骞宠　浼樺寲
-                    return {
-                      ...baseConfig,
-                      antiOverlap: false, // 鍏抽棴澶嶆潅鐨勯槻閲嶅彔绠楁硶
-                      synchronousPlayback: true, // 淇濇寔鍚屾浠ョ‘淇濅綋楠岋紝璁＄畻閲忎笉澶?-                      useWorker: true, // 寮€鍚疻orker鍑忓皯涓荤嚎绋嬭礋鎷?-                      maxLength: 30, // v5.2.0浼樺寲: 鍑忓皯寮瑰箷鏁伴噺鏄叧閿紭鍖?-                    }
-                }
+                    resolve(true);
+                  });
+                },
               }
-
-              const config = getOptimizedConfig()
-
-              // 馃帹 涓轰綆鎬ц兘璁惧娣诲姞CSS纭欢鍔犻€熸牱寮?-              if (devicePerformance === 'low') {
-                // 鍒涘缓CSS鍔ㄧ敾鏍峰紡锛堢‖浠跺姞閫燂級
-                if (!document.getElementById('danmaku-performance-css')) {
-                  const style = document.createElement('style')
-                  style.id = 'danmaku-performance-css'
-                  style.textContent = `
+              
+              // 鏍规嵁璁惧鎬ц兘璋冩暣鏍稿績閰嶇疆
+              switch (devicePerformance) {
+                case 'high': // 楂樻€ц兘璁惧 - 瀹屾暣鍔熻兘
+                  return {
+                    ...baseConfig,
+                    antiOverlap: true, // 寮€鍚槻閲嶅彔
+                    synchronousPlayback: true, // 淇濇寔寮瑰箷涓庤棰戞挱鏀鹃€熷害鍚屾
+                    useWorker: true, // v5.2.0: 鍚敤Web Worker浼樺寲
+                  }
+                
+                case 'medium': // 涓瓑鎬ц兘璁惧 - 閫傚害浼樺寲
+                  return {
+                    ...baseConfig,
+                    antiOverlap: !isMobile, // 绉诲姩绔叧闂槻閲嶅彔
+                    synchronousPlayback: true, // 淇濇寔鍚屾鎾斁浠ョ‘淇濅綋楠屼竴鑷?+                    useWorker: true, // v5.2.0: 涓瓑璁惧涔熷惎鐢╓orker
+                  }
+                
+                case 'low': // 浣庢€ц兘璁惧 - 骞宠　浼樺寲
+                  return {
+                    ...baseConfig,
+                    antiOverlap: false, // 鍏抽棴澶嶆潅鐨勯槻閲嶅彔绠楁硶
+                    synchronousPlayback: true, // 淇濇寔鍚屾浠ョ‘淇濅綋楠岋紝璁＄畻閲忎笉澶?+                    useWorker: true, // 寮€鍚疻orker鍑忓皯涓荤嚎绋嬭礋鎷?+                    maxLength: 30, // v5.2.0浼樺寲: 鍑忓皯寮瑰箷鏁伴噺鏄叧閿紭鍖?+                  }
+              }
+            }
+            
+            const config = getOptimizedConfig()
+            
+            // 馃帹 涓轰綆鎬ц兘璁惧娣诲姞CSS纭欢鍔犻€熸牱寮?+            if (devicePerformance === 'low') {
+              // 鍒涘缓CSS鍔ㄧ敾鏍峰紡锛堢‖浠跺姞閫燂級
+              if (!document.getElementById('danmaku-performance-css')) {
+                const style = document.createElement('style')
+                style.id = 'danmaku-performance-css'
+                style.textContent = `
                   /* 馃殌 纭欢鍔犻€熺殑寮瑰箷浼樺寲 */
                   .art-danmuku-optimized {
                     will-change: transform !important;
@@ -3481,87 +3122,67 @@ function PlayPageClient() {
                     transition: transform linear !important;
                   }
                 `
-                  document.head.appendChild(style)
-                  console.log('馃帹 宸插姞杞紺SS纭欢鍔犻€熶紭鍖?)
-                }
+                document.head.appendChild(style)
+                console.log('馃帹 宸插姞杞紺SS纭欢鍔犻€熶紭鍖?)
               }
-
-              return config
-            })()),
-            // Chromecast 鎻掍欢鍔犺浇绛栫暐锛?-            // 鍙湪 Chrome 娴忚鍣ㄤ腑鏄剧ず Chromecast锛堟帓闄?iOS Chrome锛?-            // Safari 鍜?iOS锛氫笉鏄剧ず Chromecast锛堢敤鍘熺敓 AirPlay锛?-            // 鍏朵粬娴忚鍣細涓嶆樉绀?Chromecast锛堜笉鏀寔 Cast API锛?-            ...(isChrome && !isIOS ? [
-              artplayerPluginChromecast({
-                onStateChange: (state) => {
-                  console.log('Chromecast state changed:', state);
-                },
-                onCastAvailable: (available) => {
-                  console.log('Chromecast available:', available);
-                },
-                onCastStart: () => {
-                  console.log('Chromecast started');
-                },
-                onError: (error) => {
-                  console.error('Chromecast error:', error);
-                }
-              })
-            ] : []),
-          ],
-        });
-
-        // 鐩戝惉鍏ㄥ睆鐘舵€佸彉鍖?-        artPlayerRef.current.on('fullscreen', (isFullscreenNow: boolean) => {
-          console.log('Fullscreen state changed:', isFullscreenNow);
-          setIsFullscreen(isFullscreenNow);
-
-          // 鏇存柊 Portal 瀹瑰櫒锛氬叏灞忔椂浣跨敤鎾斁鍣ㄥ鍣紝闈炲叏灞忔椂浣跨敤 body
-          if (isFullscreenNow) {
-            // 鍏ㄥ睆鏃讹紝浣跨敤 ArtPlayer 鐨勫鍣ㄥ厓绱?-            const fullscreenElement = document.fullscreenElement ||
-              (document as any).webkitFullscreenElement ||
-              (document as any).mozFullScreenElement;
-            if (fullscreenElement) {
-              setPortalContainer(fullscreenElement as HTMLElement);
             }
-          } else {
-            // 闈炲叏灞忔椂锛屼娇鐢?body
-            setPortalContainer(document.body);
-          }
-        });
-
-        // 鐩戝惉鎾斁鍣ㄤ簨浠?-        artPlayerRef.current.on('ready', async () => {
-          setError(null);
-
-          // iOS璁惧鑷姩鎾斁浼樺寲锛氬鏋滄槸闈欓煶鍚姩鐨勶紝鍦ㄥ紑濮嬫挱鏀惧悗鎭㈠闊抽噺
-          if ((isIOS || isSafari) && artPlayerRef.current.muted) {
-            console.log('iOS璁惧闈欓煶鑷姩鎾斁锛屽噯澶囧湪鎾斁寮€濮嬪悗鎭㈠闊抽噺');
-
-            const handleFirstPlay = () => {
-              setTimeout(() => {
-                if (artPlayerRef.current && artPlayerRef.current.muted) {
-                  artPlayerRef.current.muted = false;
-                  artPlayerRef.current.volume = lastVolumeRef.current || 0.7;
-                  console.log('iOS璁惧宸叉仮澶嶉煶閲?', artPlayerRef.current.volume);
-                }
-              }, 500); // 寤惰繜500ms纭繚鎾斁绋冲畾
+            
+            return config
+          })()),
+          // Chromecast 鎻掍欢鍔犺浇绛栫暐锛?+          // 鍙湪 Chrome 娴忚鍣ㄤ腑鏄剧ず Chromecast锛堟帓闄?iOS Chrome锛?+          // Safari 鍜?iOS锛氫笉鏄剧ず Chromecast锛堢敤鍘熺敓 AirPlay锛?+          // 鍏朵粬娴忚鍣細涓嶆樉绀?Chromecast锛堜笉鏀寔 Cast API锛?+          ...(isChrome && !isIOS ? [
+            artplayerPluginChromecast({
+              onStateChange: (state) => {
+                console.log('Chromecast state changed:', state);
+              },
+              onCastAvailable: (available) => {
+                console.log('Chromecast available:', available);
+              },
+              onCastStart: () => {
+                console.log('Chromecast started');
+              },
+              onError: (error) => {
+                console.error('Chromecast error:', error);
+              }
+            })
+          ] : []),
+        ],
+      });
 
-              // 鍙墽琛屼竴娆?-              artPlayerRef.current.off('video:play', handleFirstPlay);
-            };
+      // 鐩戝惉鎾斁鍣ㄤ簨浠?+      artPlayerRef.current.on('ready', async () => {
+        setError(null);
 
-            artPlayerRef.current.on('video:play', handleFirstPlay);
-          }
+        // iOS璁惧鑷姩鎾斁浼樺寲锛氬鏋滄槸闈欓煶鍚姩鐨勶紝鍦ㄥ紑濮嬫挱鏀惧悗鎭㈠闊抽噺
+        if ((isIOS || isSafari) && artPlayerRef.current.muted) {
+          console.log('iOS璁惧闈欓煶鑷姩鎾斁锛屽噯澶囧湪鎾斁寮€濮嬪悗鎭㈠闊抽噺');
+          
+          const handleFirstPlay = () => {
+            setTimeout(() => {
+              if (artPlayerRef.current && artPlayerRef.current.muted) {
+                artPlayerRef.current.muted = false;
+                artPlayerRef.current.volume = lastVolumeRef.current || 0.7;
+                console.log('iOS璁惧宸叉仮澶嶉煶閲?', artPlayerRef.current.volume);
+              }
+            }, 500); // 寤惰繜500ms纭繚鎾斁绋冲畾
+            
+            // 鍙墽琛屼竴娆?+            artPlayerRef.current.off('video:play', handleFirstPlay);
+          };
+          
+          artPlayerRef.current.on('video:play', handleFirstPlay);
+        }
 
-          // 娣诲姞寮瑰箷鎻掍欢鎸夐挳閫夋嫨鎬ч殣钘廋SS
-          const optimizeDanmukuControlsCSS = () => {
-            if (document.getElementById('danmuku-controls-optimize')) return;
+        // 娣诲姞寮瑰箷鎻掍欢鎸夐挳閫夋嫨鎬ч殣钘廋SS
+        const optimizeDanmukuControlsCSS = () => {
+          if (document.getElementById('danmuku-controls-optimize')) return;
 
-            const style = document.createElement('style');
-            style.id = 'danmuku-controls-optimize';
-            style.textContent = `
+          const style = document.createElement('style');
+          style.id = 'danmuku-controls-optimize';
+          style.textContent = `
             /* 闅愯棌寮瑰箷寮€鍏虫寜閽拰鍙戝皠鍣?*/
             .artplayer-plugin-danmuku .apd-toggle {
               display: none !important;
@@ -3607,27 +3228,27 @@ function PlayPageClient() {
               pointer-events: auto !important;
             }
           `;
-            document.head.appendChild(style);
-          };
-
-          // 搴旂敤CSS浼樺寲
-          optimizeDanmukuControlsCSS();
-
-          // 绮剧‘瑙ｅ喅寮瑰箷鑿滃崟涓庤繘搴︽潯鎷栨嫿鍐茬獊 - 鍩轰簬ArtPlayer鍘熺敓鎷栨嫿閫昏緫
-          const fixDanmakuProgressConflict = () => {
-            let isDraggingProgress = false;
-
-            setTimeout(() => {
-              const progressControl = document.querySelector('.art-control-progress') as HTMLElement;
-              if (!progressControl) return;
-
-              // 娣诲姞绮剧‘鐨凜SS鎺у埗
-              const addPrecisionCSS = () => {
-                if (document.getElementById('danmaku-drag-fix')) return;
-
-                const style = document.createElement('style');
-                style.id = 'danmaku-drag-fix';
-                style.textContent = `
+          document.head.appendChild(style);
+        };
+        
+        // 搴旂敤CSS浼樺寲
+        optimizeDanmukuControlsCSS();
+
+        // 绮剧‘瑙ｅ喅寮瑰箷鑿滃崟涓庤繘搴︽潯鎷栨嫿鍐茬獊 - 鍩轰簬ArtPlayer鍘熺敓鎷栨嫿閫昏緫
+        const fixDanmakuProgressConflict = () => {
+          let isDraggingProgress = false;
+          
+          setTimeout(() => {
+            const progressControl = document.querySelector('.art-control-progress') as HTMLElement;
+            if (!progressControl) return;
+            
+            // 娣诲姞绮剧‘鐨凜SS鎺у埗
+            const addPrecisionCSS = () => {
+              if (document.getElementById('danmaku-drag-fix')) return;
+              
+              const style = document.createElement('style');
+              style.id = 'danmaku-drag-fix';
+              style.textContent = `
                 /* 馃敡 淇闀挎椂闂存挱鏀惧悗寮瑰箷鑿滃崟hover澶辨晥闂 */
 
                 /* 纭繚鎺у埗鍏冪礌鏈韩鍙互鎺ユ敹榧犳爣浜嬩欢锛屾仮澶嶅師鐢焗over鏈哄埗 */
@@ -3661,773 +3282,616 @@ function PlayPageClient() {
                   pointer-events: auto !important;
                 }
               `;
-                document.head.appendChild(style);
-              };
-
-              // 绮剧‘妯℃嫙ArtPlayer鐨勬嫋鎷芥娴嬮€昏緫
-              const handleProgressMouseDown = (event: MouseEvent) => {
-                // 鍙湁宸﹂敭鎵嶅紑濮嬫嫋鎷芥娴?-                if (event.button === 0) {
-                  isDraggingProgress = true;
-                  const artplayer = document.querySelector('.artplayer') as HTMLElement;
-                  if (artplayer) {
-                    artplayer.setAttribute('data-dragging', 'true');
-                  }
-                }
-              };
-
-              // 鐩戝惉document鐨刴ousemove锛屼笌ArtPlayer淇濇寔涓€鑷?-              const handleDocumentMouseMove = () => {
-                // 濡傛灉姝ｅ湪鎷栨嫿锛岀‘淇濆脊骞曡彍鍗曡闅愯棌
-                if (isDraggingProgress) {
-                  const panels = document.querySelectorAll('.artplayer-plugin-danmuku .apd-config-panel, .artplayer-plugin-danmuku .apd-style-panel') as NodeListOf<HTMLElement>;
-                  panels.forEach(panel => {
-                    if (panel.style.opacity !== '0') {
-                      panel.style.opacity = '0';
-                      panel.style.pointerEvents = 'none';
-                    }
-                  });
+              document.head.appendChild(style);
+            };
+            
+            // 绮剧‘妯℃嫙ArtPlayer鐨勬嫋鎷芥娴嬮€昏緫
+            const handleProgressMouseDown = (event: MouseEvent) => {
+              // 鍙湁宸﹂敭鎵嶅紑濮嬫嫋鎷芥娴?+              if (event.button === 0) {
+                isDraggingProgress = true;
+                const artplayer = document.querySelector('.artplayer') as HTMLElement;
+                if (artplayer) {
+                  artplayer.setAttribute('data-dragging', 'true');
                 }
-              };
-
-              // mouseup鏃剁珛鍗虫仮澶?- 涓嶢rtPlayer閫昏緫瀹屽叏鍚屾
-              const handleDocumentMouseUp = () => {
-                if (isDraggingProgress) {
-                  isDraggingProgress = false;
-                  const artplayer = document.querySelector('.artplayer') as HTMLElement;
-                  if (artplayer) {
-                    artplayer.removeAttribute('data-dragging');
+              }
+            };
+            
+            // 鐩戝惉document鐨刴ousemove锛屼笌ArtPlayer淇濇寔涓€鑷?+            const handleDocumentMouseMove = () => {
+              // 濡傛灉姝ｅ湪鎷栨嫿锛岀‘淇濆脊骞曡彍鍗曡闅愯棌
+              if (isDraggingProgress) {
+                const panels = document.querySelectorAll('.artplayer-plugin-danmuku .apd-config-panel, .artplayer-plugin-danmuku .apd-style-panel') as NodeListOf<HTMLElement>;
+                panels.forEach(panel => {
+                  if (panel.style.opacity !== '0') {
+                    panel.style.opacity = '0';
+                    panel.style.pointerEvents = 'none';
                   }
-                  // 绔嬪嵆鎭㈠锛屼笉浣跨敤寤惰繜
-                }
-              };
-
-              // 缁戝畾浜嬩欢 - 涓嶢rtPlayer浣跨敤鐩稿悓鐨勪簨浠剁粦瀹氭柟寮?-              progressControl.addEventListener('mousedown', handleProgressMouseDown);
-              document.addEventListener('mousemove', handleDocumentMouseMove);
-              document.addEventListener('mouseup', handleDocumentMouseUp);
-
-              // 搴旂敤CSS
-              addPrecisionCSS();
-
-              // 馃攧 娣诲姞瀹氭湡閲嶇疆鏈哄埗锛岄槻姝㈤暱鏃堕棿鎾斁鍚庣姸鎬佹薄鏌?-              const danmakuResetInterval = setInterval(() => {
-                if (!artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
-                  clearInterval(danmakuResetInterval);
-                  return;
-                }
-
-                try {
-                  // 閲嶇疆寮瑰箷鎺т欢鍜岄潰鏉跨姸鎬?-                  const controls = document.querySelectorAll('.artplayer-plugin-danmuku .apd-config, .artplayer-plugin-danmuku .apd-style') as NodeListOf<HTMLElement>;
-                  const panels = document.querySelectorAll('.artplayer-plugin-danmuku .apd-config-panel, .artplayer-plugin-danmuku .apd-style-panel') as NodeListOf<HTMLElement>;
-
-                  // 寮哄埗閲嶇疆鎺у埗鍏冪礌鐨勪簨浠舵帴鏀惰兘鍔?-                  controls.forEach(control => {
-                    if (control.style.pointerEvents === 'none') {
-                      control.style.pointerEvents = 'auto';
-                    }
-                  });
-
-                  // 閲嶇疆闈㈡澘鐘舵€侊紝浣嗕笉褰卞搷褰撳墠hover鐘舵€?-                  panels.forEach(panel => {
-                    if (!panel.matches(':hover') && panel.style.opacity === '0') {
-                      panel.style.opacity = '';
-                      panel.style.pointerEvents = '';
-                      panel.style.visibility = '';
-                    }
-                  });
-
-                  console.log('馃攧 寮瑰箷鑿滃崟hover鐘舵€佸凡閲嶇疆');
-                } catch (error) {
-                  console.warn('寮瑰箷鐘舵€侀噸缃け璐?', error);
-                }
-              }, 300000); // 姣?鍒嗛挓閲嶇疆涓€娆?-
-              // 馃殌 绔嬪嵆鎭㈠hover鐘舵€侊紙淇褰撳墠鍙兘宸插瓨鍦ㄧ殑闂锛?-              const immediateRestore = () => {
-                const controls = document.querySelectorAll('.artplayer-plugin-danmuku .apd-config, .artplayer-plugin-danmuku .apd-style') as NodeListOf<HTMLElement>;
-                controls.forEach(control => {
-                  control.style.pointerEvents = 'auto';
                 });
-                console.log('馃殌 寮瑰箷鑿滃崟hover鐘舵€佸凡绔嬪嵆鎭㈠');
-              };
-
-              // 绔嬪嵆鎵ц涓€娆℃仮澶?-              setTimeout(immediateRestore, 100);
-
-            }, 1500); // 绛夊緟寮瑰箷鎻掍欢鍔犺浇
-          };
-
-          // 鍚敤绮剧‘淇
-          fixDanmakuProgressConflict();
-
-          // 绉诲姩绔脊骞曢厤缃寜閽偣鍑诲垏鎹㈡敮鎸?- 鍩轰簬ArtPlayer璁剧疆鎸夐挳鍘熺悊
-          const addMobileDanmakuToggle = () => {
-            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
-
-            setTimeout(() => {
-              const configButton = document.querySelector('.artplayer-plugin-danmuku .apd-config');
-              const configPanel = document.querySelector('.artplayer-plugin-danmuku .apd-config-panel');
-
-              if (!configButton || !configPanel) {
-                console.warn('寮瑰箷閰嶇疆鎸夐挳鎴栭潰鏉挎湭鎵惧埌');
-                return;
               }
+            };
+            
+            // mouseup鏃剁珛鍗虫仮澶?- 涓嶢rtPlayer閫昏緫瀹屽叏鍚屾
+            const handleDocumentMouseUp = () => {
+              if (isDraggingProgress) {
+                isDraggingProgress = false;
+                const artplayer = document.querySelector('.artplayer') as HTMLElement;
+                if (artplayer) {
+                  artplayer.removeAttribute('data-dragging');
+                }
+                // 绔嬪嵆鎭㈠锛屼笉浣跨敤寤惰繜
+              }
+            };
+            
+            // 缁戝畾浜嬩欢 - 涓嶢rtPlayer浣跨敤鐩稿悓鐨勪簨浠剁粦瀹氭柟寮?+            progressControl.addEventListener('mousedown', handleProgressMouseDown);
+            document.addEventListener('mousemove', handleDocumentMouseMove);
+            document.addEventListener('mouseup', handleDocumentMouseUp);
+            
+            // 搴旂敤CSS
+            addPrecisionCSS();
 
-              console.log('璁惧绫诲瀷:', isMobile ? '绉诲姩绔? : '妗岄潰绔?);
-
-              // 妗岄潰绔細绠€鍖栧鐞嗭紝渚濊禆CSS hover锛岀Щ闄ゅ鏉傜殑JavaScript浜嬩欢
-              if (!isMobile) {
-                console.log('妗岄潰绔細浣跨敤CSS鍘熺敓hover锛岄伩鍏岼avaScript浜嬩欢鍐茬獊');
+            // 馃攧 娣诲姞瀹氭湡閲嶇疆鏈哄埗锛岄槻姝㈤暱鏃堕棿鎾斁鍚庣姸鎬佹薄鏌?+            const danmakuResetInterval = setInterval(() => {
+              if (!artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
+                clearInterval(danmakuResetInterval);
                 return;
               }
 
-              if (isMobile) {
-                // 绉诲姩绔細娣诲姞鐐瑰嚮鍒囨崲鏀寔 + 鎸佷箙浣嶇疆淇
-                console.log('涓虹Щ鍔ㄧ娣诲姞寮瑰箷閰嶇疆鎸夐挳鐐瑰嚮鍒囨崲鍔熻兘');
-
-                let isConfigVisible = false;
-
-                // 寮瑰箷闈㈡澘浣嶇疆淇鍑芥暟 - 绠€鍖栫増鏈?-                const adjustPanelPosition = () => {
-                  const player = document.querySelector('.artplayer');
-                  if (!player || !configButton || !configPanel) return;
-
-                  try {
-                    const panelElement = configPanel as HTMLElement;
-
-                    // 濮嬬粓娓呴櫎鍐呰仈鏍峰紡锛屼娇鐢–SS榛樿瀹氫綅
-                    panelElement.style.left = '';
-                    panelElement.style.right = '';
-                    panelElement.style.transform = '';
-
-                    console.log('寮瑰箷闈㈡澘锛氫娇鐢–SS榛樿瀹氫綅锛岃嚜鍔ㄩ€傞厤灞忓箷鏂瑰悜');
-                  } catch (error) {
-                    console.warn('寮瑰箷闈㈡澘浣嶇疆璋冩暣澶辫触:', error);
-                  }
-                };
-
-                // 娣诲姞鐐瑰嚮浜嬩欢鐩戝惉鍣?-                configButton.addEventListener('click', (e) => {
-                  e.preventDefault();
-                  e.stopPropagation();
-
-                  isConfigVisible = !isConfigVisible;
+              try {
+                // 閲嶇疆寮瑰箷鎺т欢鍜岄潰鏉跨姸鎬?+                const controls = document.querySelectorAll('.artplayer-plugin-danmuku .apd-config, .artplayer-plugin-danmuku .apd-style') as NodeListOf<HTMLElement>;
+                const panels = document.querySelectorAll('.artplayer-plugin-danmuku .apd-config-panel, .artplayer-plugin-danmuku .apd-style-panel') as NodeListOf<HTMLElement>;
 
-                  if (isConfigVisible) {
-                    (configPanel as HTMLElement).style.display = 'block';
-                    // 鏄剧ず鍚庣珛鍗宠皟鏁翠綅缃?-                    setTimeout(adjustPanelPosition, 10);
-                    console.log('绉诲姩绔脊骞曢厤缃潰鏉匡細鏄剧ず');
-                  } else {
-                    (configPanel as HTMLElement).style.display = 'none';
-                    console.log('绉诲姩绔脊骞曢厤缃潰鏉匡細闅愯棌');
+                // 寮哄埗閲嶇疆鎺у埗鍏冪礌鐨勪簨浠舵帴鏀惰兘鍔?+                controls.forEach(control => {
+                  if (control.style.pointerEvents === 'none') {
+                    control.style.pointerEvents = 'auto';
                   }
                 });
 
-                // 鐩戝惉ArtPlayer鐨剅esize浜嬩欢
-                if (artPlayerRef.current) {
-                  artPlayerRef.current.on('resize', () => {
-                    if (isConfigVisible) {
-                      console.log('妫€娴嬪埌ArtPlayer resize浜嬩欢锛岄噸鏂拌皟鏁村脊骞曢潰鏉夸綅缃?);
-                      setTimeout(adjustPanelPosition, 50); // 鐭殏寤惰繜纭繚resize瀹屾垚
-                    }
-                  });
-                  console.log('宸茬洃鍚珹rtPlayer resize浜嬩欢锛屽疄鐜拌嚜鍔ㄩ€傞厤');
-                }
-
-                // 棰濆鐩戝惉灞忓箷鏂瑰悜鍙樺寲浜嬩欢锛岀‘淇濆畬鍏ㄨ嚜鍔ㄩ€傞厤
-                const handleOrientationChange = () => {
-                  if (isConfigVisible) {
-                    console.log('妫€娴嬪埌灞忓箷鏂瑰悜鍙樺寲锛岄噸鏂拌皟鏁村脊骞曢潰鏉夸綅缃?);
-                    setTimeout(adjustPanelPosition, 100); // 绋嶉暱寤惰繜绛夊緟鏂瑰悜鍙樺寲瀹屾垚
-                  }
-                };
-
-                window.addEventListener('orientationchange', handleOrientationChange);
-                window.addEventListener('resize', handleOrientationChange);
-
-                // 娓呯悊鍑芥暟
-                const _cleanup = () => {
-                  window.removeEventListener('orientationchange', handleOrientationChange);
-                  window.removeEventListener('resize', handleOrientationChange);
-                };
-
-                // 鐐瑰嚮鍏朵粬鍦版柟鑷姩闅愯棌
-                document.addEventListener('click', (e) => {
-                  if (isConfigVisible &&
-                    !configButton.contains(e.target as Node) &&
-                    !configPanel.contains(e.target as Node)) {
-                    isConfigVisible = false;
-                    (configPanel as HTMLElement).style.display = 'none';
-                    console.log('鐐瑰嚮澶栭儴鍖哄煙锛岄殣钘忓脊骞曢厤缃潰鏉?);
+                // 閲嶇疆闈㈡澘鐘舵€侊紝浣嗕笉褰卞搷褰撳墠hover鐘舵€?+                panels.forEach(panel => {
+                  if (!panel.matches(':hover') && panel.style.opacity === '0') {
+                    panel.style.opacity = '';
+                    panel.style.pointerEvents = '';
+                    panel.style.visibility = '';
                   }
                 });
 
-                console.log('绉诲姩绔脊骞曢厤缃垏鎹㈠姛鑳藉凡婵€娲?);
-              }
-            }, 2000); // 寤惰繜2绉掔‘淇濆脊骞曟彃浠跺畬鍏ㄥ垵濮嬪寲
-          };
-
-          // 鍚敤绉诲姩绔脊骞曢厤缃垏鎹?-          addMobileDanmakuToggle();
-
-          // 鎾斁鍣ㄥ氨缁悗锛屽姞杞藉閮ㄥ脊骞曟暟鎹?-          console.log('鎾斁鍣ㄥ凡灏辩华锛屽紑濮嬪姞杞藉閮ㄥ脊骞?);
-          setTimeout(async () => {
-            try {
-              const externalDanmu = await loadExternalDanmu(); // 杩欓噷浼氭鏌ュ紑鍏崇姸鎬?-              console.log('澶栭儴寮瑰箷鍔犺浇缁撴灉:', externalDanmu);
-
-              if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
-                if (externalDanmu.length > 0) {
-                  console.log('鍚戞挱鏀惧櫒鎻掍欢鍔犺浇寮瑰箷鏁版嵁:', externalDanmu.length, '鏉?);
-                  artPlayerRef.current.plugins.artplayerPluginDanmuku.load(externalDanmu);
-                  artPlayerRef.current.notice.show = `宸插姞杞?${externalDanmu.length} 鏉″脊骞昤;
-                } else {
-                  console.log('娌℃湁寮瑰箷鏁版嵁鍙姞杞?);
-                  artPlayerRef.current.notice.show = '鏆傛棤寮瑰箷鏁版嵁';
-                }
-              } else {
-                console.error('寮瑰箷鎻掍欢鏈壘鍒?);
+                console.log('馃攧 寮瑰箷鑿滃崟hover鐘舵€佸凡閲嶇疆');
+              } catch (error) {
+                console.warn('寮瑰箷鐘舵€侀噸缃け璐?', error);
               }
-            } catch (error) {
-              console.error('鍔犺浇澶栭儴寮瑰箷澶辫触:', error);
-            }
-          }, 1000); // 寤惰繜1绉掔‘淇濇彃浠跺畬鍏ㄥ垵濮嬪寲
+            }, 300000); // 姣?鍒嗛挓閲嶇疆涓€娆? 
-          // 鐩戝惉寮瑰箷鎻掍欢鐨勬樉绀?闅愯棌浜嬩欢锛岃嚜鍔ㄤ繚瀛樼姸鎬佸埌localStorage
-          artPlayerRef.current.on('artplayerPluginDanmuku:show', () => {
-            localStorage.setItem('danmaku_visible', 'true');
-            console.log('寮瑰箷鏄剧ず鐘舵€佸凡淇濆瓨');
-          });
+            // 馃殌 绔嬪嵆鎭㈠hover鐘舵€侊紙淇褰撳墠鍙兘宸插瓨鍦ㄧ殑闂锛?+            const immediateRestore = () => {
+              const controls = document.querySelectorAll('.artplayer-plugin-danmuku .apd-config, .artplayer-plugin-danmuku .apd-style') as NodeListOf<HTMLElement>;
+              controls.forEach(control => {
+                control.style.pointerEvents = 'auto';
+              });
+              console.log('馃殌 寮瑰箷鑿滃崟hover鐘舵€佸凡绔嬪嵆鎭㈠');
+            };
 
-          artPlayerRef.current.on('artplayerPluginDanmuku:hide', () => {
-            localStorage.setItem('danmaku_visible', 'false');
-            console.log('寮瑰箷闅愯棌鐘舵€佸凡淇濆瓨');
-          });
+            // 绔嬪嵆鎵ц涓€娆℃仮澶?+            setTimeout(immediateRestore, 100);
 
-          // 鐩戝惉寮瑰箷鎻掍欢鐨勯厤缃彉鏇翠簨浠讹紝鑷姩淇濆瓨鎵€鏈夎缃埌localStorage
-          artPlayerRef.current.on('artplayerPluginDanmuku:config', (option: any) => {
-            try {
-              // 淇濆瓨鎵€鏈夊脊骞曢厤缃埌localStorage
-              if (typeof option.fontSize !== 'undefined') {
-                localStorage.setItem('danmaku_fontSize', option.fontSize.toString());
-              }
-              if (typeof option.opacity !== 'undefined') {
-                localStorage.setItem('danmaku_opacity', option.opacity.toString());
-              }
-              if (typeof option.speed !== 'undefined') {
-                localStorage.setItem('danmaku_speed', option.speed.toString());
-              }
-              if (typeof option.margin !== 'undefined') {
-                localStorage.setItem('danmaku_margin', JSON.stringify(option.margin));
-              }
-              if (typeof option.modes !== 'undefined') {
-                localStorage.setItem('danmaku_modes', JSON.stringify(option.modes));
-              }
-              if (typeof option.antiOverlap !== 'undefined') {
-                localStorage.setItem('danmaku_antiOverlap', option.antiOverlap.toString());
-              }
-              if (typeof option.visible !== 'undefined') {
-                localStorage.setItem('danmaku_visible', option.visible.toString());
-              }
-              console.log('寮瑰箷閰嶇疆宸茶嚜鍔ㄤ繚瀛?', option);
-            } catch (error) {
-              console.error('淇濆瓨寮瑰箷閰嶇疆澶辫触:', error);
-            }
-          });
+          }, 1500); // 绛夊緟寮瑰箷鎻掍欢鍔犺浇
+        };
 
-          // ============================================================================
-          // 瑙嗛鎾斁鍣ㄦ偓娴箍鍛婂睆钄界郴缁?-          // ============================================================================
-
-          // 娣诲姞CSS鏉ラ殣钘忓父瑙佺殑鎮诞骞垮憡鍏冪礌
-          const adBlockerStyles = document.createElement('style');
-          adBlockerStyles.id = 'video-ad-blocker-styles';
-          adBlockerStyles.textContent = `
-          /* 灞忚斀鎾斁鍣ㄥ唴鐨勬偓娴箍鍛?*/
-          .art-video-player .ad-overlay,
-          .art-video-player .video-ad,
-          .art-video-player .player-ad,
-          .art-video-player [class*="ad-banner"],
-          .art-video-player [class*="ad-overlay"],
-          .art-video-player [class*="advertisement"],
-          .art-video-player [id*="ad-banner"],
-          .art-video-player [id*="ad-overlay"],
-          .art-video-player iframe[src*="doubleclick"],
-          .art-video-player iframe[src*="googlesyndication"],
-          .art-video-player iframe[src*="/ad/"],
-          .art-video-player iframe[src*="/ads/"],
-          .art-video-player div[style*="z-index: 999"],
-          .art-video-player div[style*="z-index: 9999"] {
-            display: none !important;
-            visibility: hidden !important;
-            opacity: 0 !important;
-            pointer-events: none !important;
-          }
+        // 鍚敤绮剧‘淇
+        fixDanmakuProgressConflict();
 
-          /* 灞忚斀鏆傚仠鏃剁殑骞垮憡 */
-          .art-video-player .pause-ad,
-          .art-video-player .pause-overlay,
-          .art-video-player [class*="pause-ad"] {
-            display: none !important;
-          }
-        `;
+        // 绉诲姩绔脊骞曢厤缃寜閽偣鍑诲垏鎹㈡敮鎸?- 鍩轰簬ArtPlayer璁剧疆鎸夐挳鍘熺悊
+        const addMobileDanmakuToggle = () => {
+          const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
 
-          // 娣诲姞鏍峰紡鍒伴〉闈?-          if (!document.getElementById('video-ad-blocker-styles')) {
-            document.head.appendChild(adBlockerStyles);
-            console.log('鉁?鎾斁鍣ㄥ箍鍛婂睆钄紺SS宸插姞杞?);
-          }
+          setTimeout(() => {
+            const configButton = document.querySelector('.artplayer-plugin-danmuku .apd-config');
+            const configPanel = document.querySelector('.artplayer-plugin-danmuku .apd-config-panel');
 
-          // 娣诲姞鍏ㄥ睆妯″紡閫夐泦闈㈡澘鏍峰紡
-          const fullscreenEpisodeStyles = document.createElement('style');
-          fullscreenEpisodeStyles.id = 'fullscreen-episode-selector-styles';
-          fullscreenEpisodeStyles.textContent = `
-            /* 纭繚鍏ㄥ睆妯″紡涓嬮€夐泦寮瑰嚭闈㈡澘鏄剧ず鍦ㄦ渶涓婂眰 */
-            .art-video-player:fullscreen,
-            .art-video-player:-webkit-full-screen,
-            .art-video-player:-moz-full-screen,
-            .art-video-player:-ms-fullscreen {
-              position: relative;
+            if (!configButton || !configPanel) {
+              console.warn('寮瑰箷閰嶇疆鎸夐挳鎴栭潰鏉挎湭鎵惧埌');
+              return;
             }
-            
-            /* 鍏ㄥ睆瀹瑰櫒鍐呯殑Portal鍏冪礌搴旇鏈夋渶楂樺眰绾?*/
-            .art-video-player:fullscreen > div[style*="z-index"],
-            .art-video-player:-webkit-full-screen > div[style*="z-index"],
-            .art-video-player:-moz-full-screen > div[style*="z-index"],
-            .art-video-player:-ms-fullscreen > div[style*="z-index"] {
-              z-index: 2147483647 !important;
-              position: fixed !important;
-            }
-            
-            /* 纭繚瑙嗛鍏冪礌涓嶄細閬尅寮瑰嚭灞?*/
-            .art-video-player:fullscreen video,
-            .art-video-player:-webkit-full-screen video {
-              position: relative;
-              z-index: 1;
-            }
-          `;
-          
-          if (!document.getElementById('fullscreen-episode-selector-styles')) {
-            document.head.appendChild(fullscreenEpisodeStyles);
-            console.log('鉁?鍏ㄥ睆閫夐泦闈㈡澘CSS宸插姞杞?);
-          }
 
-          // 鐩戞帶骞剁Щ闄ゅ姩鎬佹彃鍏ョ殑骞垮憡鍏冪礌
-          const removeOverlayAds = () => {
-            if (!artRef.current) return;
-
-            const adSelectors = [
-              '[class*="ad-overlay"]',
-              '[class*="ad-banner"]',
-              '[class*="advertisement"]',
-              '[id*="ad-banner"]',
-              '[id*="ad-overlay"]',
-              'iframe[src*="doubleclick"]',
-              'iframe[src*="googlesyndication"]',
-              'iframe[src*="/ad/"]',
-              'iframe[src*="/ads/"]',
-              '.pause-ad',
-              '.video-ad',
-              '.player-ad'
-            ];
-
-            let removedCount = 0;
-            adSelectors.forEach(selector => {
-              const elements = artRef.current?.querySelectorAll(selector);
-              elements?.forEach(el => {
-                if (el && el.parentNode) {
-                  el.remove();
-                  removedCount++;
-                }
-              });
-            });
+            console.log('璁惧绫诲瀷:', isMobile ? '绉诲姩绔? : '妗岄潰绔?);
 
-            if (removedCount > 0) {
-              console.log(`鉁?绉婚櫎浜?${removedCount} 涓偓娴箍鍛婂厓绱燻);
+            // 妗岄潰绔細绠€鍖栧鐞嗭紝渚濊禆CSS hover锛岀Щ闄ゅ鏉傜殑JavaScript浜嬩欢
+            if (!isMobile) {
+              console.log('妗岄潰绔細浣跨敤CSS鍘熺敓hover锛岄伩鍏岼avaScript浜嬩欢鍐茬獊');
+              return;
             }
-          };
-
-          // 鍒濆妫€鏌?-          setTimeout(removeOverlayAds, 1000);
-
-          // 瀹氭湡妫€鏌ワ紙姣?绉掞級
-          const adBlockerInterval = setInterval(removeOverlayAds, 5000);
+            
+            if (isMobile) {
+              // 绉诲姩绔細娣诲姞鐐瑰嚮鍒囨崲鏀寔 + 鎸佷箙浣嶇疆淇
+              console.log('涓虹Щ鍔ㄧ娣诲姞寮瑰箷閰嶇疆鎸夐挳鐐瑰嚮鍒囨崲鍔熻兘');
+              
+              let isConfigVisible = false;
+              
+              // 寮瑰箷闈㈡澘浣嶇疆淇鍑芥暟 - 绠€鍖栫増鏈?+              const adjustPanelPosition = () => {
+                const player = document.querySelector('.artplayer');
+                if (!player || !configButton || !configPanel) return;
 
-          // 浣跨敤MutationObserver鐩戝惉DOM鍙樺寲
-          if (artRef.current) {
-            const observer = new MutationObserver((mutations) => {
-              let hasAdLikeElements = false;
+                try {
+                  const panelElement = configPanel as HTMLElement;
 
-              mutations.forEach((mutation) => {
-                mutation.addedNodes.forEach((node) => {
-                  if (node.nodeType === 1) { // Element node
-                    const element = node as Element;
-                    const className = element.className?.toString().toLowerCase() || '';
-                    const id = element.id?.toLowerCase() || '';
+                  // 濮嬬粓娓呴櫎鍐呰仈鏍峰紡锛屼娇鐢–SS榛樿瀹氫綅
+                  panelElement.style.left = '';
+                  panelElement.style.right = '';
+                  panelElement.style.transform = '';
 
-                    // 妫€娴嬫槸鍚︽槸骞垮憡鐩稿叧鍏冪礌
-                    if (className.includes('ad') || id.includes('ad') ||
-                      element.tagName === 'IFRAME') {
-                      hasAdLikeElements = true;
-                    }
+                  console.log('寮瑰箷闈㈡澘锛氫娇鐢–SS榛樿瀹氫綅锛岃嚜鍔ㄩ€傞厤灞忓箷鏂瑰悜');
+                } catch (error) {
+                  console.warn('寮瑰箷闈㈡澘浣嶇疆璋冩暣澶辫触:', error);
+                }
+              };
+              
+              // 娣诲姞鐐瑰嚮浜嬩欢鐩戝惉鍣?+              configButton.addEventListener('click', (e) => {
+                e.preventDefault();
+                e.stopPropagation();
+                
+                isConfigVisible = !isConfigVisible;
+                
+                if (isConfigVisible) {
+                  (configPanel as HTMLElement).style.display = 'block';
+                  // 鏄剧ず鍚庣珛鍗宠皟鏁翠綅缃?+                  setTimeout(adjustPanelPosition, 10);
+                  console.log('绉诲姩绔脊骞曢厤缃潰鏉匡細鏄剧ず');
+                } else {
+                  (configPanel as HTMLElement).style.display = 'none';
+                  console.log('绉诲姩绔脊骞曢厤缃潰鏉匡細闅愯棌');
+                }
+              });
+              
+              // 鐩戝惉ArtPlayer鐨剅esize浜嬩欢
+              if (artPlayerRef.current) {
+                artPlayerRef.current.on('resize', () => {
+                  if (isConfigVisible) {
+                    console.log('妫€娴嬪埌ArtPlayer resize浜嬩欢锛岄噸鏂拌皟鏁村脊骞曢潰鏉夸綅缃?);
+                    setTimeout(adjustPanelPosition, 50); // 鐭殏寤惰繜纭繚resize瀹屾垚
                   }
                 });
-              });
-
-              if (hasAdLikeElements) {
-                removeOverlayAds();
+                console.log('宸茬洃鍚珹rtPlayer resize浜嬩欢锛屽疄鐜拌嚜鍔ㄩ€傞厤');
               }
-            });
-
-            observer.observe(artRef.current, {
-              childList: true,
-              subtree: true
-            });
+              
+              // 棰濆鐩戝惉灞忓箷鏂瑰悜鍙樺寲浜嬩欢锛岀‘淇濆畬鍏ㄨ嚜鍔ㄩ€傞厤
+              const handleOrientationChange = () => {
+                if (isConfigVisible) {
+                  console.log('妫€娴嬪埌灞忓箷鏂瑰悜鍙樺寲锛岄噸鏂拌皟鏁村脊骞曢潰鏉夸綅缃?);
+                  setTimeout(adjustPanelPosition, 100); // 绋嶉暱寤惰繜绛夊緟鏂瑰悜鍙樺寲瀹屾垚
+                }
+              };
 
-            // 娓呯悊鍑芥暟
-            artPlayerRef.current.on('destroy', () => {
-              observer.disconnect();
-              clearInterval(adBlockerInterval);
-              console.log('骞垮憡灞忚斀鐩戝惉宸插仠姝?);
-            });
-          }
+              window.addEventListener('orientationchange', handleOrientationChange);
+              window.addEventListener('resize', handleOrientationChange);
 
-          // 鐩戝惉鎾斁杩涘害璺宠浆锛屼紭鍖栧脊骞曢噸缃紙鍑忓皯闂儊锛?-          artPlayerRef.current.on('seek', () => {
-            if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
-              // 娓呴櫎涔嬪墠鐨勯噸缃鏃跺櫒
-              if (seekResetTimeoutRef.current) {
-                clearTimeout(seekResetTimeoutRef.current);
-              }
+              // 娓呯悊鍑芥暟
+              const _cleanup = () => {
+                window.removeEventListener('orientationchange', handleOrientationChange);
+                window.removeEventListener('resize', handleOrientationChange);
+              };
 
-              // 澧炲姞寤惰繜骞跺彧鍦ㄩ潪鎷栨嫿鐘舵€佷笅閲嶇疆锛屽噺灏戝揩杩涙椂鐨勯棯鐑?-              seekResetTimeoutRef.current = setTimeout(() => {
-                if (!isDraggingProgressRef.current && artPlayerRef.current?.plugins?.artplayerPluginDanmuku && !artPlayerRef.current.seeking) {
-                  artPlayerRef.current.plugins.artplayerPluginDanmuku.reset();
-                  console.log('杩涘害璺宠浆锛屽脊骞曞凡閲嶇疆');
+              // 鐐瑰嚮鍏朵粬鍦版柟鑷姩闅愯棌
+              document.addEventListener('click', (e) => {
+                if (isConfigVisible &&
+                    !configButton.contains(e.target as Node) &&
+                    !configPanel.contains(e.target as Node)) {
+                  isConfigVisible = false;
+                  (configPanel as HTMLElement).style.display = 'none';
+                  console.log('鐐瑰嚮澶栭儴鍖哄煙锛岄殣钘忓脊骞曢厤缃潰鏉?);
                 }
-              }, 500); // 澧炲姞鍒?00ms寤惰繜锛屽噺灏戦绻侀噸缃鑷寸殑闂儊
-            }
-          });
+              });
 
-          // 鐩戝惉鎷栨嫿鐘舵€?- v5.2.0浼樺寲: 鍦ㄦ嫋鎷芥湡闂存殏鍋滃脊骞曟洿鏂颁互鍑忓皯闂儊
-          artPlayerRef.current.on('video:seeking', () => {
-            isDraggingProgressRef.current = true;
-            // v5.2.0鏂板: 鎷栨嫿鏃堕殣钘忓脊骞曪紝鍑忓皯CPU鍗犵敤鍜岄棯鐑?-            // 鍙湁鍦ㄥ閮ㄥ脊骞曞紑鍚笖褰撳墠鏄剧ず鏃舵墠闅愯棌
-            if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku &&
-              externalDanmuEnabledRef.current &&
-              !artPlayerRef.current.plugins.artplayerPluginDanmuku.isHide) {
-              artPlayerRef.current.plugins.artplayerPluginDanmuku.hide();
+              console.log('绉诲姩绔脊骞曢厤缃垏鎹㈠姛鑳藉凡婵€娲?);
             }
-          });
-
-          artPlayerRef.current.on('video:seeked', () => {
-            isDraggingProgressRef.current = false;
-            // v5.2.0浼樺寲: 鎷栨嫿缁撴潫鍚庢牴鎹閮ㄥ脊骞曞紑鍏崇姸鎬佸喅瀹氭槸鍚︽仮澶嶅脊骞曟樉绀?+          }, 2000); // 寤惰繜2绉掔‘淇濆脊骞曟彃浠跺畬鍏ㄥ垵濮嬪寲
+        };
+        
+        // 鍚敤绉诲姩绔脊骞曢厤缃垏鎹?+        addMobileDanmakuToggle();
+
+        // 鎾斁鍣ㄥ氨缁悗锛屽姞杞藉閮ㄥ脊骞曟暟鎹?+        console.log('鎾斁鍣ㄥ凡灏辩华锛屽紑濮嬪姞杞藉閮ㄥ脊骞?);
+        setTimeout(async () => {
+          try {
+            const externalDanmu = await loadExternalDanmu(); // 杩欓噷浼氭鏌ュ紑鍏崇姸鎬?+            console.log('澶栭儴寮瑰箷鍔犺浇缁撴灉:', externalDanmu);
+            
             if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
-              // 鍙湁鍦ㄥ閮ㄥ脊骞曞紑鍚椂鎵嶆仮澶嶆樉绀?-              if (externalDanmuEnabledRef.current) {
-                artPlayerRef.current.plugins.artplayerPluginDanmuku.show(); // 鍏堟仮澶嶆樉绀?-                setTimeout(() => {
-                  // 寤惰繜閲嶇疆浠ョ‘淇濇挱鏀剧姸鎬佺ǔ瀹?-                  if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
-                    artPlayerRef.current.plugins.artplayerPluginDanmuku.reset();
-                    console.log('鎷栨嫿缁撴潫锛屽脊骞曞凡閲嶇疆');
-                  }
-                }, 100);
+              if (externalDanmu.length > 0) {
+                console.log('鍚戞挱鏀惧櫒鎻掍欢鍔犺浇寮瑰箷鏁版嵁:', externalDanmu.length, '鏉?);
+                artPlayerRef.current.plugins.artplayerPluginDanmuku.load(externalDanmu);
+                artPlayerRef.current.notice.show = `宸插姞杞?${externalDanmu.length} 鏉″脊骞昤;
               } else {
-                // 澶栭儴寮瑰箷鍏抽棴鏃讹紝纭繚淇濇寔闅愯棌鐘舵€?-                artPlayerRef.current.plugins.artplayerPluginDanmuku.hide();
-                console.log('鎷栨嫿缁撴潫锛屽閮ㄥ脊骞曞凡鍏抽棴锛屼繚鎸侀殣钘忕姸鎬?);
+                console.log('娌℃湁寮瑰箷鏁版嵁鍙姞杞?);
+                artPlayerRef.current.notice.show = '鏆傛棤寮瑰箷鏁版嵁';
               }
+            } else {
+              console.error('寮瑰箷鎻掍欢鏈壘鍒?);
             }
-          });
+          } catch (error) {
+            console.error('鍔犺浇澶栭儴寮瑰箷澶辫触:', error);
+          }
+        }, 1000); // 寤惰繜1绉掔‘淇濇彃浠跺畬鍏ㄥ垵濮嬪寲
 
-          // 鐩戝惉鎾斁鍣ㄧ獥鍙ｅ昂瀵稿彉鍖栵紝瑙﹀彂寮瑰箷閲嶇疆锛堝弻閲嶄繚闅滐級
-          artPlayerRef.current.on('resize', () => {
-            // 娓呴櫎涔嬪墠鐨勯噸缃鏃跺櫒
-            if (resizeResetTimeoutRef.current) {
-              clearTimeout(resizeResetTimeoutRef.current);
+        // 鐩戝惉寮瑰箷鎻掍欢鐨勬樉绀?闅愯棌浜嬩欢锛岃嚜鍔ㄤ繚瀛樼姸鎬佸埌localStorage
+        artPlayerRef.current.on('artplayerPluginDanmuku:show', () => {
+          localStorage.setItem('danmaku_visible', 'true');
+          console.log('寮瑰箷鏄剧ず鐘舵€佸凡淇濆瓨');
+        });
+        
+        artPlayerRef.current.on('artplayerPluginDanmuku:hide', () => {
+          localStorage.setItem('danmaku_visible', 'false');
+          console.log('寮瑰箷闅愯棌鐘舵€佸凡淇濆瓨');
+        });
+
+        // 鐩戝惉寮瑰箷鎻掍欢鐨勯厤缃彉鏇翠簨浠讹紝鑷姩淇濆瓨鎵€鏈夎缃埌localStorage
+        artPlayerRef.current.on('artplayerPluginDanmuku:config', (option: any) => {
+          try {
+            // 淇濆瓨鎵€鏈夊脊骞曢厤缃埌localStorage
+            if (typeof option.fontSize !== 'undefined') {
+              localStorage.setItem('danmaku_fontSize', option.fontSize.toString());
+            }
+            if (typeof option.opacity !== 'undefined') {
+              localStorage.setItem('danmaku_opacity', option.opacity.toString());
+            }
+            if (typeof option.speed !== 'undefined') {
+              localStorage.setItem('danmaku_speed', option.speed.toString());
+            }
+            if (typeof option.margin !== 'undefined') {
+              localStorage.setItem('danmaku_margin', JSON.stringify(option.margin));
             }
+            if (typeof option.modes !== 'undefined') {
+              localStorage.setItem('danmaku_modes', JSON.stringify(option.modes));
+            }
+            if (typeof option.antiOverlap !== 'undefined') {
+              localStorage.setItem('danmaku_antiOverlap', option.antiOverlap.toString());
+            }
+            if (typeof option.visible !== 'undefined') {
+              localStorage.setItem('danmaku_visible', option.visible.toString());
+            }
+            console.log('寮瑰箷閰嶇疆宸茶嚜鍔ㄤ繚瀛?', option);
+          } catch (error) {
+            console.error('淇濆瓨寮瑰箷閰嶇疆澶辫触:', error);
+          }
+        });
 
-            // 寤惰繜閲嶇疆寮瑰箷锛岄伩鍏嶈繛缁Е鍙戯紙鍏ㄥ睆鍒囨崲浼樺寲锛?-            resizeResetTimeoutRef.current = setTimeout(() => {
-              if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
+        // 鐩戝惉鎾斁杩涘害璺宠浆锛屼紭鍖栧脊骞曢噸缃紙鍑忓皯闂儊锛?+        artPlayerRef.current.on('seek', () => {
+          if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
+            // 娓呴櫎涔嬪墠鐨勯噸缃鏃跺櫒
+            if (seekResetTimeoutRef.current) {
+              clearTimeout(seekResetTimeoutRef.current);
+            }
+            
+            // 澧炲姞寤惰繜骞跺彧鍦ㄩ潪鎷栨嫿鐘舵€佷笅閲嶇疆锛屽噺灏戝揩杩涙椂鐨勯棯鐑?+            seekResetTimeoutRef.current = setTimeout(() => {
+              if (!isDraggingProgressRef.current && artPlayerRef.current?.plugins?.artplayerPluginDanmuku && !artPlayerRef.current.seeking) {
                 artPlayerRef.current.plugins.artplayerPluginDanmuku.reset();
-                console.log('绐楀彛灏哄鍙樺寲锛屽脊骞曞凡閲嶇疆锛堥槻鎶栦紭鍖栵級');
+                console.log('杩涘害璺宠浆锛屽脊骞曞凡閲嶇疆');
               }
-            }, 300); // 300ms闃叉姈锛屽噺灏戝叏灞忓垏鎹㈡椂鐨勫崱椤?-          });
-
-          // 鎾斁鍣ㄥ氨缁悗锛屽鏋滄鍦ㄦ挱鏀惧垯璇锋眰 Wake Lock
-          if (artPlayerRef.current && !artPlayerRef.current.paused) {
-            requestWakeLock();
+            }, 500); // 澧炲姞鍒?00ms寤惰繜锛屽噺灏戦绻侀噸缃鑷寸殑闂儊
           }
         });
 
-        // 鐩戝惉鎾斁鐘舵€佸彉鍖栵紝鎺у埗 Wake Lock
-        artPlayerRef.current.on('play', () => {
-          requestWakeLock();
+        // 鐩戝惉鎷栨嫿鐘舵€?- v5.2.0浼樺寲: 鍦ㄦ嫋鎷芥湡闂存殏鍋滃脊骞曟洿鏂颁互鍑忓皯闂儊
+        artPlayerRef.current.on('video:seeking', () => {
+          isDraggingProgressRef.current = true;
+          // v5.2.0鏂板: 鎷栨嫿鏃堕殣钘忓脊骞曪紝鍑忓皯CPU鍗犵敤鍜岄棯鐑?+          // 鍙湁鍦ㄥ閮ㄥ脊骞曞紑鍚笖褰撳墠鏄剧ず鏃舵墠闅愯棌
+          if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku && 
+              externalDanmuEnabledRef.current && 
+              !artPlayerRef.current.plugins.artplayerPluginDanmuku.isHide) {
+            artPlayerRef.current.plugins.artplayerPluginDanmuku.hide();
+          }
         });
 
-        artPlayerRef.current.on('pause', () => {
-          releaseWakeLock();
-          // 馃敟 鍏抽敭淇锛氭殏鍋滄椂涔熸鏌ユ槸鍚﹀湪鐗囧熬锛岄伩鍏嶄繚瀛橀敊璇殑杩涘害
-          const currentTime = artPlayerRef.current?.currentTime || 0;
-          const duration = artPlayerRef.current?.duration || 0;
-          const remainingTime = duration - currentTime;
-          const isNearEnd = duration > 0 && remainingTime < 180; // 鏈€鍚?鍒嗛挓
-
-          if (!isNearEnd) {
-            saveCurrentPlayProgress();
+        artPlayerRef.current.on('video:seeked', () => {
+          isDraggingProgressRef.current = false;
+          // v5.2.0浼樺寲: 鎷栨嫿缁撴潫鍚庢牴鎹閮ㄥ脊骞曞紑鍏崇姸鎬佸喅瀹氭槸鍚︽仮澶嶅脊骞曟樉绀?+          if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
+            // 鍙湁鍦ㄥ閮ㄥ脊骞曞紑鍚椂鎵嶆仮澶嶆樉绀?+            if (externalDanmuEnabledRef.current) {
+              artPlayerRef.current.plugins.artplayerPluginDanmuku.show(); // 鍏堟仮澶嶆樉绀?+              setTimeout(() => {
+                // 寤惰繜閲嶇疆浠ョ‘淇濇挱鏀剧姸鎬佺ǔ瀹?+                if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
+                  artPlayerRef.current.plugins.artplayerPluginDanmuku.reset();
+                  console.log('鎷栨嫿缁撴潫锛屽脊骞曞凡閲嶇疆');
+                }
+              }, 100);
+            } else {
+              // 澶栭儴寮瑰箷鍏抽棴鏃讹紝纭繚淇濇寔闅愯棌鐘舵€?+              artPlayerRef.current.plugins.artplayerPluginDanmuku.hide();
+              console.log('鎷栨嫿缁撴潫锛屽閮ㄥ脊骞曞凡鍏抽棴锛屼繚鎸侀殣钘忕姸鎬?);
+            }
           }
         });
 
-        artPlayerRef.current.on('video:ended', () => {
-          releaseWakeLock();
+        // 鐩戝惉鎾斁鍣ㄧ獥鍙ｅ昂瀵稿彉鍖栵紝瑙﹀彂寮瑰箷閲嶇疆锛堝弻閲嶄繚闅滐級
+        artPlayerRef.current.on('resize', () => {
+          // 娓呴櫎涔嬪墠鐨勯噸缃鏃跺櫒
+          if (resizeResetTimeoutRef.current) {
+            clearTimeout(resizeResetTimeoutRef.current);
+          }
+          
+          // 寤惰繜閲嶇疆寮瑰箷锛岄伩鍏嶈繛缁Е鍙戯紙鍏ㄥ睆鍒囨崲浼樺寲锛?+          resizeResetTimeoutRef.current = setTimeout(() => {
+            if (artPlayerRef.current?.plugins?.artplayerPluginDanmuku) {
+              artPlayerRef.current.plugins.artplayerPluginDanmuku.reset();
+              console.log('绐楀彛灏哄鍙樺寲锛屽脊骞曞凡閲嶇疆锛堥槻鎶栦紭鍖栵級');
+            }
+          }, 300); // 300ms闃叉姈锛屽噺灏戝叏灞忓垏鎹㈡椂鐨勫崱椤?         });
 
-        // 濡傛灉鎾斁鍣ㄥ垵濮嬪寲鏃跺凡缁忓湪鎾斁鐘舵€侊紝鍒欒姹?Wake Lock
+        // 鎾斁鍣ㄥ氨缁悗锛屽鏋滄鍦ㄦ挱鏀惧垯璇锋眰 Wake Lock
         if (artPlayerRef.current && !artPlayerRef.current.paused) {
           requestWakeLock();
         }
+      });
 
-        artPlayerRef.current.on('video:volumechange', () => {
-          lastVolumeRef.current = artPlayerRef.current.volume;
-        });
-        artPlayerRef.current.on('video:ratechange', () => {
-          lastPlaybackRateRef.current = artPlayerRef.current.playbackRate;
-        });
-
-        // 鐩戝惉瑙嗛鍙挱鏀句簨浠讹紝杩欐椂鎭㈠鎾斁杩涘害鏇村彲闈?-        artPlayerRef.current.on('video:canplay', () => {
-          // 馃敟 閲嶇疆 video:ended 澶勭悊鏍囧織锛屽洜涓鸿繖鏄柊瑙嗛
-          videoEndedHandledRef.current = false;
-
-          // 鑻ュ瓨鍦ㄩ渶瑕佹仮澶嶇殑鎾斁杩涘害锛屽垯璺宠浆
-          if (resumeTimeRef.current && resumeTimeRef.current > 0) {
-            try {
-              const duration = artPlayerRef.current.duration || 0;
-              let target = resumeTimeRef.current;
-              if (duration && target >= duration - 2) {
-                target = Math.max(0, duration - 5);
-              }
-              artPlayerRef.current.currentTime = target;
-              console.log('鎴愬姛鎭㈠鎾斁杩涘害鍒?', resumeTimeRef.current);
-            } catch (err) {
-              console.warn('鎭㈠鎾斁杩涘害澶辫触:', err);
-            }
-          }
-          resumeTimeRef.current = null;
-
-          // iOS璁惧鑷姩鎾斁鍥為€€鏈哄埗锛氬鏋滆嚜鍔ㄦ挱鏀惧け璐ワ紝灏濊瘯鐢ㄦ埛浜や簰瑙﹀彂鎾斁
-          if ((isIOS || isSafari) && artPlayerRef.current.paused) {
-            console.log('iOS璁惧妫€娴嬪埌瑙嗛鏈嚜鍔ㄦ挱鏀撅紝鍑嗗浜や簰瑙﹀彂鏈哄埗');
+      // 鐩戝惉鎾斁鐘舵€佸彉鍖栵紝鎺у埗 Wake Lock
+      artPlayerRef.current.on('play', () => {
+        requestWakeLock();
+      });
 
-            const tryAutoPlay = async () => {
-              try {
-                // 澶氶噸灏濊瘯绛栫暐
-                let playAttempts = 0;
-                const maxAttempts = 3;
-
-                const attemptPlay = async (): Promise<boolean> => {
-                  playAttempts++;
-                  console.log(`iOS鑷姩鎾斁灏濊瘯 ${playAttempts}/${maxAttempts}`);
-
-                  try {
-                    await artPlayerRef.current.play();
-                    console.log('iOS璁惧鑷姩鎾斁鎴愬姛');
-                    return true;
-                  } catch (playError: any) {
-                    console.log(`鎾斁灏濊瘯 ${playAttempts} 澶辫触:`, playError.name);
-
-                    // 鏍规嵁閿欒绫诲瀷閲囩敤涓嶅悓绛栫暐
-                    if (playError.name === 'NotAllowedError') {
-                      // 鐢ㄦ埛浜や簰闇€姹傞敊璇?- 鏈€甯歌
-                      if (playAttempts < maxAttempts) {
-                        // 灏濊瘯闄嶄綆闊抽噺鍐嶆挱鏀?-                        artPlayerRef.current.volume = 0.1;
-                        await new Promise(resolve => setTimeout(resolve, 200));
-                        return attemptPlay();
-                      }
-                      return false;
-                    } else if (playError.name === 'AbortError') {
-                      // 鎾斁琚腑鏂?- 绛夊緟鍚庨噸璇?-                      if (playAttempts < maxAttempts) {
-                        await new Promise(resolve => setTimeout(resolve, 500));
-                        return attemptPlay();
-                      }
-                      return false;
-                    }
-                    return false;
-                  }
-                };
+      artPlayerRef.current.on('pause', () => {
+        releaseWakeLock();
+        // 馃敟 鍏抽敭淇锛氭殏鍋滄椂涔熸鏌ユ槸鍚﹀湪鐗囧熬锛岄伩鍏嶄繚瀛橀敊璇殑杩涘害
+        const currentTime = artPlayerRef.current?.currentTime || 0;
+        const duration = artPlayerRef.current?.duration || 0;
+        const remainingTime = duration - currentTime;
+        const isNearEnd = duration > 0 && remainingTime < 180; // 鏈€鍚?鍒嗛挓
+
+        if (!isNearEnd) {
+          saveCurrentPlayProgress();
+        }
+      });
 
-                const success = await attemptPlay();
+      artPlayerRef.current.on('video:ended', () => {
+        releaseWakeLock();
+      });
 
-                if (!success) {
-                  console.log('iOS璁惧闇€瑕佺敤鎴蜂氦浜掓墠鑳芥挱鏀撅紝杩欐槸姝ｅ父鐨勬祻瑙堝櫒琛屼负');
-                  // 鏄剧ず鍙嬪ソ鐨勬挱鏀炬彁绀?-                  if (artPlayerRef.current) {
-                    artPlayerRef.current.notice.show = '杞昏Е鎾斁鎸夐挳寮€濮嬭鐪?;
+      // 濡傛灉鎾斁鍣ㄥ垵濮嬪寲鏃跺凡缁忓湪鎾斁鐘舵€侊紝鍒欒姹?Wake Lock
+      if (artPlayerRef.current && !artPlayerRef.current.paused) {
+        requestWakeLock();
+      }
 
-                    // 娣诲姞涓€娆℃€х偣鍑荤洃鍚櫒鐢ㄤ簬棣栨鎾斁
-                    let hasHandledFirstInteraction = false;
-                    const handleFirstUserInteraction = async () => {
-                      if (hasHandledFirstInteraction) return;
-                      hasHandledFirstInteraction = true;
+      artPlayerRef.current.on('video:volumechange', () => {
+        lastVolumeRef.current = artPlayerRef.current.volume;
+      });
+      artPlayerRef.current.on('video:ratechange', () => {
+        lastPlaybackRateRef.current = artPlayerRef.current.playbackRate;
+      });
 
-                      try {
-                        await artPlayerRef.current.play();
-                        // 棣栨鎴愬姛鎾斁鍚庢仮澶嶆甯搁煶閲?-                        setTimeout(() => {
-                          if (artPlayerRef.current && !artPlayerRef.current.muted) {
-                            artPlayerRef.current.volume = lastVolumeRef.current || 0.7;
-                          }
-                        }, 1000);
-                      } catch (error) {
-                        console.warn('鐢ㄦ埛浜や簰鎾斁澶辫触:', error);
-                      }
+      // 鐩戝惉瑙嗛鍙挱鏀句簨浠讹紝杩欐椂鎭㈠鎾斁杩涘害鏇村彲闈?+      artPlayerRef.current.on('video:canplay', () => {
+        // 馃敟 閲嶇疆 video:ended 澶勭悊鏍囧織锛屽洜涓鸿繖鏄柊瑙嗛
+        videoEndedHandledRef.current = false;
 
-                      // 绉婚櫎鐩戝惉鍣?-                      artPlayerRef.current?.off('video:play', handleFirstUserInteraction);
-                      document.removeEventListener('click', handleFirstUserInteraction);
-                    };
+        // 鑻ュ瓨鍦ㄩ渶瑕佹仮澶嶇殑鎾斁杩涘害锛屽垯璺宠浆
+        if (resumeTimeRef.current && resumeTimeRef.current > 0) {
+          try {
+            const duration = artPlayerRef.current.duration || 0;
+            let target = resumeTimeRef.current;
+            if (duration && target >= duration - 2) {
+              target = Math.max(0, duration - 5);
+            }
+            artPlayerRef.current.currentTime = target;
+            console.log('鎴愬姛鎭㈠鎾斁杩涘害鍒?', resumeTimeRef.current);
+          } catch (err) {
+            console.warn('鎭㈠鎾斁杩涘害澶辫触:', err);
+          }
+        }
+        resumeTimeRef.current = null;
 
-                    // 鐩戝惉鎾斁浜嬩欢鍜岀偣鍑讳簨浠?-                    artPlayerRef.current.on('video:play', handleFirstUserInteraction);
-                    document.addEventListener('click', handleFirstUserInteraction);
+        // iOS璁惧鑷姩鎾斁鍥為€€鏈哄埗锛氬鏋滆嚜鍔ㄦ挱鏀惧け璐ワ紝灏濊瘯鐢ㄦ埛浜や簰瑙﹀彂鎾斁
+        if ((isIOS || isSafari) && artPlayerRef.current.paused) {
+          console.log('iOS璁惧妫€娴嬪埌瑙嗛鏈嚜鍔ㄦ挱鏀撅紝鍑嗗浜や簰瑙﹀彂鏈哄埗');
+          
+          const tryAutoPlay = async () => {
+            try {
+              // 澶氶噸灏濊瘯绛栫暐
+              let playAttempts = 0;
+              const maxAttempts = 3;
+              
+              const attemptPlay = async (): Promise<boolean> => {
+                playAttempts++;
+                console.log(`iOS鑷姩鎾斁灏濊瘯 ${playAttempts}/${maxAttempts}`);
+                
+                try {
+                  await artPlayerRef.current.play();
+                  console.log('iOS璁惧鑷姩鎾斁鎴愬姛');
+                  return true;
+                } catch (playError: any) {
+                  console.log(`鎾斁灏濊瘯 ${playAttempts} 澶辫触:`, playError.name);
+                  
+                  // 鏍规嵁閿欒绫诲瀷閲囩敤涓嶅悓绛栫暐
+                  if (playError.name === 'NotAllowedError') {
+                    // 鐢ㄦ埛浜や簰闇€姹傞敊璇?- 鏈€甯歌
+                    if (playAttempts < maxAttempts) {
+                      // 灏濊瘯闄嶄綆闊抽噺鍐嶆挱鏀?+                      artPlayerRef.current.volume = 0.1;
+                      await new Promise(resolve => setTimeout(resolve, 200));
+                      return attemptPlay();
+                    }
+                    return false;
+                  } else if (playError.name === 'AbortError') {
+                    // 鎾斁琚腑鏂?- 绛夊緟鍚庨噸璇?+                    if (playAttempts < maxAttempts) {
+                      await new Promise(resolve => setTimeout(resolve, 500));
+                      return attemptPlay();
+                    }
+                    return false;
                   }
+                  return false;
+                }
+              };
+              
+              const success = await attemptPlay();
+              
+              if (!success) {
+                console.log('iOS璁惧闇€瑕佺敤鎴蜂氦浜掓墠鑳芥挱鏀撅紝杩欐槸姝ｅ父鐨勬祻瑙堝櫒琛屼负');
+                // 鏄剧ず鍙嬪ソ鐨勬挱鏀炬彁绀?+                if (artPlayerRef.current) {
+                  artPlayerRef.current.notice.show = '杞昏Е鎾斁鎸夐挳寮€濮嬭鐪?;
+                  
+                  // 娣诲姞涓€娆℃€х偣鍑荤洃鍚櫒鐢ㄤ簬棣栨鎾斁
+                  let hasHandledFirstInteraction = false;
+                  const handleFirstUserInteraction = async () => {
+                    if (hasHandledFirstInteraction) return;
+                    hasHandledFirstInteraction = true;
+                    
+                    try {
+                      await artPlayerRef.current.play();
+                      // 棣栨鎴愬姛鎾斁鍚庢仮澶嶆甯搁煶閲?+                      setTimeout(() => {
+                        if (artPlayerRef.current && !artPlayerRef.current.muted) {
+                          artPlayerRef.current.volume = lastVolumeRef.current || 0.7;
+                        }
+                      }, 1000);
+                    } catch (error) {
+                      console.warn('鐢ㄦ埛浜や簰鎾斁澶辫触:', error);
+                    }
+                    
+                    // 绉婚櫎鐩戝惉鍣?+                    artPlayerRef.current?.off('video:play', handleFirstUserInteraction);
+                    document.removeEventListener('click', handleFirstUserInteraction);
+                  };
+                  
+                  // 鐩戝惉鎾斁浜嬩欢鍜岀偣鍑讳簨浠?+                  artPlayerRef.current.on('video:play', handleFirstUserInteraction);
+                  document.addEventListener('click', handleFirstUserInteraction);
                 }
-              } catch (error) {
-                console.warn('鑷姩鎾斁鍥為€€鏈哄埗鎵ц澶辫触:', error);
               }
-            };
-
-            // 寤惰繜灏濊瘯锛岄伩鍏嶄笌杩涘害鎭㈠鍐茬獊
-            setTimeout(tryAutoPlay, 200);
-          }
-
-          setTimeout(() => {
-            if (
-              Math.abs(artPlayerRef.current.volume - lastVolumeRef.current) > 0.01
-            ) {
-              artPlayerRef.current.volume = lastVolumeRef.current;
-            }
-            if (
-              Math.abs(
-                artPlayerRef.current.playbackRate - lastPlaybackRateRef.current
-              ) > 0.01 &&
-              isWebKit
-            ) {
-              artPlayerRef.current.playbackRate = lastPlaybackRateRef.current;
+            } catch (error) {
+              console.warn('鑷姩鎾斁鍥為€€鏈哄埗鎵ц澶辫触:', error);
             }
-            artPlayerRef.current.notice.show = '';
-          }, 0);
-
-          // 闅愯棌鎹㈡簮鍔犺浇鐘舵€?-          setIsVideoLoading(false);
+          };
+          
+          // 寤惰繜灏濊瘯锛岄伩鍏嶄笌杩涘害鎭㈠鍐茬獊
+          setTimeout(tryAutoPlay, 200);
+        }
 
-          // 馃敟 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑锛堟挱鏀惧櫒鎴愬姛鍒涘缓鍚庯級
-          if (isEpisodeChangingRef.current) {
-            isEpisodeChangingRef.current = false;
-            console.log('馃幆 鎾斁鍣ㄥ垱寤哄畬鎴愶紝閲嶇疆闆嗘暟鍒囨崲鏍囪瘑');
+        setTimeout(() => {
+          if (
+            Math.abs(artPlayerRef.current.volume - lastVolumeRef.current) > 0.01
+          ) {
+            artPlayerRef.current.volume = lastVolumeRef.current;
           }
-        });
-
-        // 鐩戝惉鎾斁鍣ㄩ敊璇?-        artPlayerRef.current.on('error', (err: any) => {
-          console.error('鎾斁鍣ㄩ敊璇?', err);
-          if (artPlayerRef.current.currentTime > 0) {
-            return;
+          if (
+            Math.abs(
+              artPlayerRef.current.playbackRate - lastPlaybackRateRef.current
+            ) > 0.01 &&
+            isWebKit
+          ) {
+            artPlayerRef.current.playbackRate = lastPlaybackRateRef.current;
           }
-        });
+          artPlayerRef.current.notice.show = '';
+        }, 0);
 
-        // 鐩戝惉瑙嗛鎾斁缁撴潫浜嬩欢锛岃嚜鍔ㄦ挱鏀句笅涓€闆?-        artPlayerRef.current.on('video:ended', () => {
-          const idx = currentEpisodeIndexRef.current;
+        // 闅愯棌鎹㈡簮鍔犺浇鐘舵€?+        setIsVideoLoading(false);
 
-          // 馃敟 鍏抽敭淇锛氶鍏堟鏌ヨ繖涓?video:ended 浜嬩欢鏄惁宸茬粡琚鐞嗚繃
-          if (videoEndedHandledRef.current) {
-            return;
-          }
+        // 馃敟 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑锛堟挱鏀惧櫒鎴愬姛鍒涘缓鍚庯級
+        if (isEpisodeChangingRef.current) {
+          isEpisodeChangingRef.current = false;
+          console.log('馃幆 鎾斁鍣ㄥ垱寤哄畬鎴愶紝閲嶇疆闆嗘暟鍒囨崲鏍囪瘑');
+        }
+      });
 
-          // 馃攽 妫€鏌ユ槸鍚﹀凡缁忛€氳繃 SkipController 瑙﹀彂浜嗕笅涓€闆嗭紝閬垮厤閲嶅瑙﹀彂
-          if (isSkipControllerTriggeredRef.current) {
-            videoEndedHandledRef.current = true;
-            // 馃敟 鍏抽敭淇锛氬欢杩熼噸缃爣蹇楋紝绛夊緟鏂伴泦鏁板紑濮嬪姞杞?-            setTimeout(() => {
-              isSkipControllerTriggeredRef.current = false;
-            }, 2000);
-            return;
-          }
+      // 鐩戝惉鎾斁鍣ㄩ敊璇?+      artPlayerRef.current.on('error', (err: any) => {
+        console.error('鎾斁鍣ㄩ敊璇?', err);
+        if (artPlayerRef.current.currentTime > 0) {
+          return;
+        }
+      });
 
-          const d = detailRef.current;
-          if (d && d.episodes && idx < d.episodes.length - 1) {
-            videoEndedHandledRef.current = true;
-            setTimeout(() => {
-              setCurrentEpisodeIndex(idx + 1);
-            }, 1000);
-          }
-        });
+      // 鐩戝惉瑙嗛鎾斁缁撴潫浜嬩欢锛岃嚜鍔ㄦ挱鏀句笅涓€闆?+      artPlayerRef.current.on('video:ended', () => {
+        const idx = currentEpisodeIndexRef.current;
 
-        // 鍚堝苟鐨則imeupdate鐩戝惉鍣?- 澶勭悊璺宠繃鐗囧ご鐗囧熬鍜屼繚瀛樿繘搴?-        artPlayerRef.current.on('video:timeupdate', () => {
-          const currentTime = artPlayerRef.current.currentTime || 0;
-          const duration = artPlayerRef.current.duration || 0;
-          const now = performance.now(); // 浣跨敤performance.now()鏇寸簿纭?-
-          // 鏇存柊 SkipController 鎵€闇€鐨勬椂闂翠俊鎭?-          setCurrentPlayTime(currentTime);
-          setVideoDuration(duration);
-
-          // 淇濆瓨鎾斁杩涘害閫昏緫 - 浼樺寲淇濆瓨闂撮殧浠ュ噺灏戠綉缁滃紑閿€
-          const saveNow = Date.now();
-          // 馃敡 浼樺寲锛氬鍔犳挱鏀句腑鐨勪繚瀛橀棿闅旓紝渚濊禆鏆傚仠鏃朵繚瀛樹綔涓轰富瑕佷繚瀛樻椂鏈?-          // upstash: 60绉掑厹搴曚繚瀛橈紝鍏朵粬瀛樺偍: 30绉掑厹搴曚繚瀛?-          // 鐢ㄦ埛鏆傚仠銆佸垏鎹㈤泦鏁般€侀〉闈㈠嵏杞芥椂浼氱珛鍗充繚瀛橈紝鍥犳杈冮暱闂撮殧涓嶅奖鍝嶄綋楠?-          const interval = process.env.NEXT_PUBLIC_STORAGE_TYPE === 'upstash' ? 60000 : 30000;
-
-          // 馃敟 鍏抽敭淇锛氬鏋滃綋鍓嶆挱鏀句綅缃帴杩戣棰戠粨灏撅紙鏈€鍚?鍒嗛挓锛夛紝涓嶄繚瀛樿繘搴?-          // 杩欐槸涓轰簡閬垮厤鑷姩璺宠繃鐗囧熬鏃朵繚瀛樹簡鐗囧熬浣嶇疆鐨勮繘搴︼紝瀵艰嚧"缁х画瑙傜湅"浠庨敊璇綅缃紑濮?-          const remainingTime = duration - currentTime;
-          const isNearEnd = duration > 0 && remainingTime < 180; // 鏈€鍚?鍒嗛挓
-
-          if (saveNow - lastSaveTimeRef.current > interval && !isNearEnd) {
-            saveCurrentPlayProgress();
-            lastSaveTimeRef.current = saveNow;
-          }
-        });
+        // 馃敟 鍏抽敭淇锛氶鍏堟鏌ヨ繖涓?video:ended 浜嬩欢鏄惁宸茬粡琚鐞嗚繃
+        if (videoEndedHandledRef.current) {
+          return;
+        }
 
-        artPlayerRef.current.on('pause', () => {
-          // 馃敟 鍏抽敭淇锛氭殏鍋滄椂涔熸鏌ユ槸鍚﹀湪鐗囧熬锛岄伩鍏嶄繚瀛橀敊璇殑杩涘害
-          const currentTime = artPlayerRef.current?.currentTime || 0;
-          const duration = artPlayerRef.current?.duration || 0;
-          const remainingTime = duration - currentTime;
-          const isNearEnd = duration > 0 && remainingTime < 180; // 鏈€鍚?鍒嗛挓
+        // 馃攽 妫€鏌ユ槸鍚﹀凡缁忛€氳繃 SkipController 瑙﹀彂浜嗕笅涓€闆嗭紝閬垮厤閲嶅瑙﹀彂
+        if (isSkipControllerTriggeredRef.current) {
+          videoEndedHandledRef.current = true;
+          // 馃敟 鍏抽敭淇锛氬欢杩熼噸缃爣蹇楋紝绛夊緟鏂伴泦鏁板紑濮嬪姞杞?+          setTimeout(() => {
+            isSkipControllerTriggeredRef.current = false;
+          }, 2000);
+          return;
+        }
 
-          if (!isNearEnd) {
-            saveCurrentPlayProgress();
-          }
-        });
+        const d = detailRef.current;
+        if (d && d.episodes && idx < d.episodes.length - 1) {
+          videoEndedHandledRef.current = true;
+          setTimeout(() => {
+            setCurrentEpisodeIndex(idx + 1);
+          }, 1000);
+        }
+      });
 
-        if (artPlayerRef.current?.video) {
-          ensureVideoSource(
-            artPlayerRef.current.video as HTMLVideoElement,
-            videoUrl
-          );
+      // 鍚堝苟鐨則imeupdate鐩戝惉鍣?- 澶勭悊璺宠繃鐗囧ご鐗囧熬鍜屼繚瀛樿繘搴?+      artPlayerRef.current.on('video:timeupdate', () => {
+        const currentTime = artPlayerRef.current.currentTime || 0;
+        const duration = artPlayerRef.current.duration || 0;
+        const now = performance.now(); // 浣跨敤performance.now()鏇寸簿纭?+
+        // 鏇存柊 SkipController 鎵€闇€鐨勬椂闂翠俊鎭?+        setCurrentPlayTime(currentTime);
+        setVideoDuration(duration);
+
+        // 淇濆瓨鎾斁杩涘害閫昏緫 - 浼樺寲淇濆瓨闂撮殧浠ュ噺灏戠綉缁滃紑閿€
+        const saveNow = Date.now();
+        // 馃敡 浼樺寲锛氬鍔犳挱鏀句腑鐨勪繚瀛橀棿闅旓紝渚濊禆鏆傚仠鏃朵繚瀛樹綔涓轰富瑕佷繚瀛樻椂鏈?+        // upstash: 60绉掑厹搴曚繚瀛橈紝鍏朵粬瀛樺偍: 30绉掑厹搴曚繚瀛?+        // 鐢ㄦ埛鏆傚仠銆佸垏鎹㈤泦鏁般€侀〉闈㈠嵏杞芥椂浼氱珛鍗充繚瀛橈紝鍥犳杈冮暱闂撮殧涓嶅奖鍝嶄綋楠?+        const interval = process.env.NEXT_PUBLIC_STORAGE_TYPE === 'upstash' ? 60000 : 30000;
+
+        // 馃敟 鍏抽敭淇锛氬鏋滃綋鍓嶆挱鏀句綅缃帴杩戣棰戠粨灏撅紙鏈€鍚?鍒嗛挓锛夛紝涓嶄繚瀛樿繘搴?+        // 杩欐槸涓轰簡閬垮厤鑷姩璺宠繃鐗囧熬鏃朵繚瀛樹簡鐗囧熬浣嶇疆鐨勮繘搴︼紝瀵艰嚧"缁х画瑙傜湅"浠庨敊璇綅缃紑濮?+        const remainingTime = duration - currentTime;
+        const isNearEnd = duration > 0 && remainingTime < 180; // 鏈€鍚?鍒嗛挓
+
+        if (saveNow - lastSaveTimeRef.current > interval && !isNearEnd) {
+          saveCurrentPlayProgress();
+          lastSaveTimeRef.current = saveNow;
         }
-      } catch (err) {
-        console.error('鍒涘缓鎾斁鍣ㄥけ璐?', err);
-        // 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑
-        isEpisodeChangingRef.current = false;
-        setError('鎾斁鍣ㄥ垵濮嬪寲澶辫触');
+      });
+
+      artPlayerRef.current.on('pause', () => {
+        // 馃敟 鍏抽敭淇锛氭殏鍋滄椂涔熸鏌ユ槸鍚﹀湪鐗囧熬锛岄伩鍏嶄繚瀛橀敊璇殑杩涘害
+        const currentTime = artPlayerRef.current?.currentTime || 0;
+        const duration = artPlayerRef.current?.duration || 0;
+        const remainingTime = duration - currentTime;
+        const isNearEnd = duration > 0 && remainingTime < 180; // 鏈€鍚?鍒嗛挓
+
+        if (!isNearEnd) {
+          saveCurrentPlayProgress();
+        }
+      });
+
+      if (artPlayerRef.current?.video) {
+        ensureVideoSource(
+          artPlayerRef.current.video as HTMLVideoElement,
+          videoUrl
+        );
       }
+    } catch (err) {
+      console.error('鍒涘缓鎾斁鍣ㄥけ璐?', err);
+      // 閲嶇疆闆嗘暟鍒囨崲鏍囪瘑
+      isEpisodeChangingRef.current = false;
+      setError('鎾斁鍣ㄥ垵濮嬪寲澶辫触');
+    }
     }; // 缁撴潫 initPlayer 鍑芥暟
 
     // 鍔ㄦ€佸鍏?ArtPlayer 骞跺垵濮嬪寲
@@ -4437,11 +3901,11 @@ function PlayPageClient() {
           import('artplayer'),
           import('artplayer-plugin-danmuku')
         ]);
-
+        
         // 灏嗗鍏ョ殑妯″潡璁剧疆涓哄叏灞€鍙橀噺渚?initPlayer 浣跨敤
         (window as any).DynamicArtplayer = Artplayer;
         (window as any).DynamicArtplayerPluginDanmuku = artplayerPluginDanmuku;
-
+        
         await initPlayer();
       } catch (error) {
         console.error('鍔ㄦ€佸鍏?ArtPlayer 澶辫触:', error);
@@ -4452,46 +3916,6 @@ function PlayPageClient() {
     loadAndInit();
   }, [Hls, videoUrl, loading, blockAdEnabled]);
 
-  // 鎺у埗閫夐泦鎸夐挳鐨勬樉绀?闅愯棌锛氫粎鍦ㄥ叏灞忋€佺綉椤靛叏灞忔垨闅愯棌閫夐泦闈㈡澘鏃舵樉绀?-  useEffect(() => {
-    if (!artPlayerRef.current) return;
-
-    const updateEpisodeSelectorButtonVisibility = () => {
-      const button = document.querySelector('.episode-selector-btn');
-      if (!button) {
-        // 濡傛灉鎸夐挳杩樻湭鍔犺浇锛屽欢杩熼噸璇?-        setTimeout(updateEpisodeSelectorButtonVisibility, 100);
-        return;
-      }
-
-      // 妫€鏌ユ槸鍚︽槸缃戦〉鍏ㄥ睆
-      const isWebFullscreen = artPlayerRef.current?.fullscreenWeb || false;
-
-      // 鏄剧ず鏉′欢锛氬叏灞?OR 缃戦〉鍏ㄥ睆 OR 闅愯棌浜嗛€夐泦闈㈡澘
-      const shouldShow = isFullscreen || isWebFullscreen || isEpisodeSelectorCollapsed;
-
-      const parentElement = button.closest('.art-control') as HTMLElement;
-      if (parentElement) {
-        parentElement.style.display = shouldShow ? '' : 'none';
-      }
-    };
-
-    // 寤惰繜鎵ц锛岀‘淇?DOM 宸插姞杞?-    const timer = setTimeout(updateEpisodeSelectorButtonVisibility, 100);
-
-    // 鐩戝惉鎾斁鍣ㄧ殑缃戦〉鍏ㄥ睆鍙樺寲
-    const handleFullscreenWebChange = () => {
-      updateEpisodeSelectorButtonVisibility();
-    };
-
-    artPlayerRef.current?.on('fullscreenWeb', handleFullscreenWebChange);
-
-    return () => {
-      clearTimeout(timer);
-      artPlayerRef.current?.off('fullscreenWeb', handleFullscreenWebChange);
-    };
-  }, [isFullscreen, isEpisodeSelectorCollapsed]);
-
   // 褰撶粍浠跺嵏杞芥椂娓呯悊瀹氭椂鍣ㄣ€乄ake Lock 鍜屾挱鏀惧櫒璧勬簮
   useEffect(() => {
     return () => {
@@ -4504,7 +3928,7 @@ function PlayPageClient() {
       if (seekResetTimeoutRef.current) {
         clearTimeout(seekResetTimeoutRef.current);
       }
-
+      
       // 娓呯悊resize闃叉姈瀹氭椂鍣?       if (resizeResetTimeoutRef.current) {
         clearTimeout(resizeResetTimeoutRef.current);
@@ -4573,8 +3997,8 @@ function PlayPageClient() {
   if (loading) {
     return (
       <PageLayout activePath='/play'>
-        <div className='fixed inset-0 flex items-center justify-center bg-transparent overflow-hidden'>
-          <div className='text-center max-w-xl w-full mx-auto px-6 py-8'>
+        <div className='flex items-center justify-center min-h-screen bg-transparent'>
+          <div className='text-center max-w-md mx-auto px-6'>
             {/* 鍔ㄧ敾褰遍櫌鍥炬爣 */}
             <div className='relative mb-8'>
               <div className='relative mx-auto w-24 h-24 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl shadow-2xl flex items-center justify-center transform hover:scale-105 transition-transform duration-300'>
@@ -4652,100 +4076,6 @@ function PlayPageClient() {
               <p className='text-xl font-semibold text-gray-800 dark:text-gray-200 animate-pulse'>
                 {loadingMessage}
               </p>
-
-              {/* 瀹炴椂娴嬮€熻繘搴?*/}
-              {loadingStage === 'preferring' && speedTestProgress.total > 0 && (
-                <div className='mt-6 w-full max-w-xl mx-auto space-y-4 pb-20'>
-                  {/* 褰撳墠娴嬮€熸簮鍜岃繘搴?*/}
-                  <div className='bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-lg p-4 shadow-lg'>
-                    <div className='flex items-center justify-between mb-2'>
-                      <span className='text-sm font-medium text-gray-600 dark:text-gray-400'>
-                        娴嬮€熻繘搴?-                      </span>
-                      <span className='text-sm font-bold text-green-600 dark:text-green-400'>
-                        {speedTestProgress.current} / {speedTestProgress.total}
-                      </span>
-                    </div>
-
-                    {/* 杩涘害鏉?*/}
-                    <div className='w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden mb-3'>
-                      <div
-                        className='h-full bg-gradient-to-r from-green-500 to-emerald-600 rounded-full transition-all duration-300'
-                        style={{
-                          width: `${(speedTestProgress.current / speedTestProgress.total) * 100}%`,
-                        }}
-                      ></div>
-                    </div>
-
-                    {/* 褰撳墠娴嬮€熸簮 */}
-                    {speedTestProgress.currentSourceName && (
-                      <div className='flex items-center space-x-2'>
-                        <div className='w-2 h-2 bg-green-500 rounded-full animate-pulse'></div>
-                        <span className='text-sm text-gray-700 dark:text-gray-300'>
-                          姝ｅ湪娴嬮€? <span className='font-semibold'>{speedTestProgress.currentSourceName}</span>
-                        </span>
-                      </div>
-                    )}
-                  </div>
-
-                  {/* 娴嬮€熺粨鏋滃垪琛?*/}
-                  {speedTestProgress.results.length > 0 && (
-                    <div className='bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-lg p-4 shadow-lg max-h-[45vh] overflow-y-auto'>
-                      <div className='text-xs font-medium text-gray-600 dark:text-gray-400 mb-3'>
-                        娴嬮€熺粨鏋?-                      </div>
-                      <div className='space-y-2'>
-                        {speedTestProgress.results.map((result, index) => (
-                          <div
-                            key={index}
-                            className={`flex items-center justify-between p-2 rounded-md transition-all duration-200 ${result.status === 'success'
-                              ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800'
-                              : result.status === 'failed'
-                                ? 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800'
-                                : 'bg-gray-50 dark:bg-gray-700/50'
-                              }`}
-                          >
-                            <div className='flex items-center space-x-2 flex-1 min-w-0'>
-                              {result.status === 'success' ? (
-                                <svg className='w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0' fill='currentColor' viewBox='0 0 20 20'>
-                                  <path fillRule='evenodd' d='M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z' clipRule='evenodd' />
-                                </svg>
-                              ) : (
-                                <svg className='w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0' fill='currentColor' viewBox='0 0 20 20'>
-                                  <path fillRule='evenodd' d='M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z' clipRule='evenodd' />
-                                </svg>
-                              )}
-                              <span className='text-xs font-medium text-gray-700 dark:text-gray-300 truncate'>
-                                {result.sourceName}
-                              </span>
-                            </div>
-
-                            {result.status === 'success' && (
-                              <div className='flex items-center space-x-3 text-xs text-gray-600 dark:text-gray-400 flex-shrink-0'>
-                                {result.quality !== '鏈煡' && (
-                                  <span className='font-medium'>{result.quality}</span>
-                                )}
-                                {result.loadSpeed !== '鏈煡' && (
-                                  <span>{result.loadSpeed}</span>
-                                )}
-                                <span className='text-green-600 dark:text-green-400 font-medium'>
-                                  {result.pingTime}ms
-                                </span>
-                              </div>
-                            )}
-
-                            {result.status === 'failed' && (
-                              <span className='text-xs text-red-600 dark:text-red-400 flex-shrink-0'>
-                                娴嬮€熷け璐?-                              </span>
-                            )}
-                          </div>
-                        ))}
-                      </div>
-                    </div>
-                  )}
-                </div>
-              )}
             </div>
           </div>
         </div>
@@ -4979,7 +4309,6 @@ function PlayPageClient() {
                     </div>
                   </div>
                 )}
-
               </div>
             </div>
 
@@ -5018,7 +4347,6 @@ function PlayPageClient() {
                 sourceSearchLoading={sourceSearchLoading}
                 sourceSearchError={sourceSearchError}
                 precomputedVideoInfo={precomputedVideoInfo}
-                onRefreshSources={refreshSources}
               />
             </div>
           </div>
@@ -5115,7 +4443,7 @@ function PlayPageClient() {
                       <div className='h-4 bg-gray-300 rounded w-48'></div>
                     </div>
                   )}
-
+                  
                   {/* Bangumi璇︽儏 */}
                   {bangumiDetails && (
                     <div className='space-y-2 text-sm'>
@@ -5131,10 +4459,11 @@ function PlayPageClient() {
                               {[...Array(5)].map((_, i) => (
                                 <svg
                                   key={i}
-                                  className={`w-4 h-4 transition-all duration-300 ${i < Math.floor(parseFloat(bangumiDetails.rating.score) / 2)
-                                    ? 'text-pink-500 drop-shadow-[0_0_4px_rgba(236,72,153,0.5)] group-hover:scale-110'
-                                    : 'text-gray-300 dark:text-gray-600'
-                                    }`}
+                                  className={`w-4 h-4 transition-all duration-300 ${
+                                    i < Math.floor(parseFloat(bangumiDetails.rating.score) / 2)
+                                      ? 'text-pink-500 drop-shadow-[0_0_4px_rgba(236,72,153,0.5)] group-hover:scale-110'
+                                      : 'text-gray-300 dark:text-gray-600'
+                                  }`}
                                   fill='currentColor'
                                   viewBox='0 0 20 20'
                                   style={{ transitionDelay: `${i * 50}ms` }}
@@ -5169,7 +4498,7 @@ function PlayPageClient() {
                         }
                         return null;
                       })}
-
+                      
                       {/* 鎾嚭鏃ユ湡 */}
                       {bangumiDetails.date && (
                         <div>
@@ -5177,7 +4506,7 @@ function PlayPageClient() {
                           <span className='text-gray-600 dark:text-gray-400'>{bangumiDetails.date}</span>
                         </div>
                       )}
-
+                      
                       {/* 鏍囩淇℃伅 */}
                       <div className='flex flex-wrap gap-2 mt-3'>
                         {bangumiDetails.tags && bangumiDetails.tags.slice(0, 4).map((tag: any, index: number) => (
@@ -5211,10 +4540,11 @@ function PlayPageClient() {
                               {[...Array(5)].map((_, i) => (
                                 <svg
                                   key={i}
-                                  className={`w-4 h-4 transition-all duration-300 ${i < Math.floor(parseFloat(movieDetails.rate) / 2)
-                                    ? 'text-yellow-500 drop-shadow-[0_0_4px_rgba(234,179,8,0.5)] group-hover:scale-110'
-                                    : 'text-gray-300 dark:text-gray-600'
-                                    }`}
+                                  className={`w-4 h-4 transition-all duration-300 ${
+                                    i < Math.floor(parseFloat(movieDetails.rate) / 2)
+                                      ? 'text-yellow-500 drop-shadow-[0_0_4px_rgba(234,179,8,0.5)] group-hover:scale-110'
+                                      : 'text-gray-300 dark:text-gray-600'
+                                  }`}
                                   fill='currentColor'
                                   viewBox='0 0 20 20'
                                   style={{ transitionDelay: `${i * 50}ms` }}
@@ -5236,7 +4566,7 @@ function PlayPageClient() {
                           </span>
                         </div>
                       )}
-
+                      
                       {/* 缂栧墽 */}
                       {movieDetails.screenwriters && movieDetails.screenwriters.length > 0 && (
                         <div>
@@ -5246,7 +4576,7 @@ function PlayPageClient() {
                           </span>
                         </div>
                       )}
-
+                      
                       {/* 涓绘紨 */}
                       {movieDetails.cast && movieDetails.cast.length > 0 && (
                         <div>
@@ -5256,19 +4586,19 @@ function PlayPageClient() {
                           </span>
                         </div>
                       )}
-
+                      
                       {/* 棣栨挱鏃ユ湡 */}
                       {movieDetails.first_aired && (
                         <div>
                           <span className='font-semibold text-gray-700 dark:text-gray-300'>
-                            {movieDetails.episodes ? '棣栨挱' : '涓婃槧'}:
+                            {movieDetails.episodes ? '棣栨挱' : '涓婃槧'}: 
                           </span>
                           <span className='text-gray-600 dark:text-gray-400'>
                             {movieDetails.first_aired}
                           </span>
                         </div>
                       )}
-
+                      
                       {/* 鏍囩淇℃伅 */}
                       <div className='flex flex-wrap gap-2 mt-3'>
                         {movieDetails.countries && movieDetails.countries.slice(0, 2).map((country: string, index: number) => (
@@ -5314,21 +4644,21 @@ function PlayPageClient() {
                     {/* 闆嗘暟淇℃伅 */}
                     {((detail?.source === 'shortdrama' && detail?.episodes && detail.episodes.length > 0) ||
                       (shortdramaDetails?.episodes && shortdramaDetails.episodes.length > 0)) && (
-                        <div className='flex flex-wrap gap-2'>
-                          <span className='relative group bg-gradient-to-r from-blue-500/90 to-indigo-500/90 dark:from-blue-600/90 dark:to-indigo-600/90 text-white px-3 py-1 rounded-full text-xs font-medium shadow-md hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 hover:scale-105'>
-                            <span className='absolute inset-0 bg-gradient-to-r from-blue-400 to-indigo-400 rounded-full opacity-0 group-hover:opacity-20 blur transition-opacity duration-300'></span>
-                            <span className='relative'>鍏眥(shortdramaDetails?.episodes || detail?.episodes)?.length}闆?/span>
-                          </span>
-                          <span className='relative group bg-gradient-to-r from-green-500/90 to-emerald-500/90 dark:from-green-600/90 dark:to-emerald-600/90 text-white px-3 py-1 rounded-full text-xs font-medium shadow-md hover:shadow-lg hover:shadow-green-500/30 transition-all duration-300 hover:scale-105'>
-                            <span className='absolute inset-0 bg-gradient-to-r from-green-400 to-emerald-400 rounded-full opacity-0 group-hover:opacity-20 blur transition-opacity duration-300'></span>
-                            <span className='relative'>鐭墽</span>
-                          </span>
-                          <span className='relative group bg-gradient-to-r from-purple-500/90 to-pink-500/90 dark:from-purple-600/90 dark:to-pink-600/90 text-white px-3 py-1 rounded-full text-xs font-medium shadow-md hover:shadow-lg hover:shadow-purple-500/30 transition-all duration-300 hover:scale-105'>
-                            <span className='absolute inset-0 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full opacity-0 group-hover:opacity-20 blur transition-opacity duration-300'></span>
-                            <span className='relative'>{shortdramaDetails?.year || detail?.year}骞?/span>
-                          </span>
-                        </div>
-                      )}
+                      <div className='flex flex-wrap gap-2'>
+                        <span className='relative group bg-gradient-to-r from-blue-500/90 to-indigo-500/90 dark:from-blue-600/90 dark:to-indigo-600/90 text-white px-3 py-1 rounded-full text-xs font-medium shadow-md hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-300 hover:scale-105'>
+                          <span className='absolute inset-0 bg-gradient-to-r from-blue-400 to-indigo-400 rounded-full opacity-0 group-hover:opacity-20 blur transition-opacity duration-300'></span>
+                          <span className='relative'>鍏眥(shortdramaDetails?.episodes || detail?.episodes)?.length}闆?/span>
+                        </span>
+                        <span className='relative group bg-gradient-to-r from-green-500/90 to-emerald-500/90 dark:from-green-600/90 dark:to-emerald-600/90 text-white px-3 py-1 rounded-full text-xs font-medium shadow-md hover:shadow-lg hover:shadow-green-500/30 transition-all duration-300 hover:scale-105'>
+                          <span className='absolute inset-0 bg-gradient-to-r from-green-400 to-emerald-400 rounded-full opacity-0 group-hover:opacity-20 blur transition-opacity duration-300'></span>
+                          <span className='relative'>鐭墽</span>
+                        </span>
+                        <span className='relative group bg-gradient-to-r from-purple-500/90 to-pink-500/90 dark:from-purple-600/90 dark:to-pink-600/90 text-white px-3 py-1 rounded-full text-xs font-medium shadow-md hover:shadow-lg hover:shadow-purple-500/30 transition-all duration-300 hover:scale-105'>
+                          <span className='absolute inset-0 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full opacity-0 group-hover:opacity-20 blur transition-opacity duration-300'></span>
+                          <span className='relative'>{shortdramaDetails?.year || detail?.year}骞?/span>
+                        </span>
+                      </div>
+                    )}
                   </div>
                 </div>
               )}
@@ -5342,7 +4672,7 @@ function PlayPageClient() {
                   {shortdramaDetails?.desc || bangumiDetails?.summary || detail?.desc}
                 </div>
               )}
-
+              
               {/* 缃戠洏璧勬簮鍖哄煙 */}
               <div id="netdisk-section" className='mt-6'>
                 <div className='border-t border-gray-200 dark:border-gray-700 pt-6'>
@@ -5371,7 +4701,7 @@ function PlayPageClient() {
                       </p>
                     )}
                   </div>
-
+                  
                   <NetDiskSearchResults
                     results={netdiskResults}
                     loading={netdiskLoading}
@@ -5454,10 +4784,11 @@ function PlayPageClient() {
       {/* 杩斿洖椤堕儴鎮诞鎸夐挳 */}
       <button
         onClick={scrollToTop}
-        className={`fixed z-[500] w-12 h-12 rounded-full shadow-lg backdrop-blur-sm transition-all duration-300 ease-in-out flex items-center justify-center group relative overflow-hidden ${showBackToTop
-          ? 'opacity-100 translate-y-0 pointer-events-auto'
-          : 'opacity-0 translate-y-4 pointer-events-none'
-          }`}
+        className={`fixed z-[500] w-12 h-12 rounded-full shadow-lg backdrop-blur-sm transition-all duration-300 ease-in-out flex items-center justify-center group relative overflow-hidden ${
+          showBackToTop
+            ? 'opacity-100 translate-y-0 pointer-events-auto'
+            : 'opacity-0 translate-y-4 pointer-events-none'
+        }`}
         style={{
           position: 'fixed',
           right: '1.5rem',
@@ -5477,66 +4808,6 @@ function PlayPageClient() {
 
         <ChevronUp className='w-6 h-6 text-white relative z-10 transition-all duration-300 group-hover:scale-110 group-hover:-translate-y-1' />
       </button>
-
-      {/* 浣跨敤 Portal 鐨勭粺涓€娴眰 - 鑷姩閫傚簲鍏ㄥ睆鍜岄潪鍏ㄥ睆妯″紡 */}
-      {showEpisodePopup && portalContainer && createPortal(
-        <div
-          className='fixed inset-0 bg-black/50 backdrop-blur-md flex items-center justify-center transition-all duration-300'
-          style={{ 
-            zIndex: 2147483647,
-            position: 'fixed',
-            pointerEvents: 'auto'
-          }}
-          onClick={(e) => {
-            // 鐐瑰嚮鑳屾櫙鍏抽棴娴眰
-            if (e.target === e.currentTarget) {
-              setShowEpisodePopup(false);
-            }
-          }}
-        >
-          <div className='relative w-full h-full max-w-4xl mx-auto p-8 md:p-12' style={{ pointerEvents: 'auto' }}>
-            {/* 鍏抽棴鎸夐挳 - 鏀惧湪鍐呭鍖哄彸涓婅澶栦晶 */}
-            <button
-              onClick={() => setShowEpisodePopup(false)}
-              className='absolute top-6 right-14 z-50 p-2 bg-white/10 hover:bg-white/20 backdrop-blur-xl rounded-full border border-white/30 hover:border-white/50 shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-110 group'
-              title='鍏抽棴 (ESC)'
-              style={{ pointerEvents: 'auto' }}
-            >
-              <svg className='w-5 h-5 text-white group-hover:rotate-90 transition-transform duration-200' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
-                <path strokeLinecap='round' strokeLinejoin='round' strokeWidth={2.5} d='M6 18L18 6M6 6l12 12' />
-              </svg>
-            </button>
-
-            {/* 閫夐泦鍐呭 - 澧炲姞鏇村 padding 閬垮厤 hover 鏀惧ぇ鏃惰瑁佸垏 */}
-            <div className='relative w-full h-full overflow-y-auto px-12' style={{ pointerEvents: 'auto' }}>
-              <EpisodeSelector
-                totalEpisodes={totalEpisodes}
-                episodes_titles={detail?.episodes_titles || []}
-                value={currentEpisodeIndex + 1}
-                onChange={(episodeNumber) => {
-                  handleEpisodeChange(episodeNumber - 1);
-                  setShowEpisodePopup(false);
-                }}
-                onSourceChange={(source, id, title) => {
-                  handleSourceChange(source, id, title);
-                  setShowEpisodePopup(false);
-                }}
-                currentSource={currentSource}
-                currentId={currentId}
-                videoTitle={videoTitle}
-                videoYear={videoYear}
-                availableSources={availableSources}
-                sourceSearchLoading={sourceSearchLoading}
-                sourceSearchError={sourceSearchError}
-                precomputedVideoInfo={precomputedVideoInfo}
-                onRefreshSources={refreshSources}
-                inModal={true}
-              />
-            </div>
-          </div>
-        </div>,
-        portalContainer
-      )}
     </PageLayout>
   );
 }
